import{j as e,T as M,m as _,r as i,i as S,R as I,D as O,S as A,p as $}from"./index-1dX7M82B.js";import{T as R,u as E,A as F}from"./TaskColumn-B-tBp0X6.js";import{m}from"./proxy-IKh-44iE.js";import{A as z,C as H}from"./ConfirmDeleteDialog-BlCcLmEk.js";import{C as L}from"./CustomSelect-f8r9LygF.js";import{D as B}from"./DateSelector-CgO7mwVk.js";function U({tasks:r,categories:a,onComplete:l,currentDate:n,onDismiss:o,onEdit:u}){const h=()=>{const d=a.length,s="grid gap-4 auto-rows-fr grid-cols-1 sm:grid-cols-2";return d===1?`${s} xl:grid-cols-3 xl:h-full`:d===2?`${s} xl:grid-cols-2 xl:h-full`:d===3?`${s} xl:grid-cols-3 xl:h-full`:d>=7?`${s} xl:grid-cols-3 2xl:grid-cols-4`:`${s} xl:grid-cols-3 2xl:grid-cols-4 xl:h-full`};return a.length===0?e.jsxs("div",{className:"flex flex-col items-center justify-center h-full text-brand-neutral-light/70 p-8 text-center bg-brand-neutral-dark/20 rounded-2xl border border-brand-depth border-dashed",children:[e.jsx(M,{className:"opacity-50 mb-2"}),e.jsx("h3",{className:"text-xl font-bold mb-2 text-brand-neutral-light",children:"Witaj w Zadaniach!"}),e.jsxs("p",{className:"max-w-md",children:["Twoja tablica jest pusta. Rozpocznij od stworzenia nowej kategorii klikając przycisk ",e.jsx("strong",{children:'"Filtruj"'}),", a następnie dodaj nowe zadania do tej kategorii przyciskiem ",e.jsx("strong",{children:'"Dodaj"'}),"."]})]}):e.jsx("div",{className:"h-full overflow-y-auto",children:e.jsx("div",{className:h(),children:a.map(d=>{const s=r.filter(c=>c.category_id===d.id),b=a.length===1?"h-full xl:col-span-2":"h-full";return e.jsx("div",{className:b,children:e.jsx(R,{category:d,tasks:s,allCategories:a,onComplete:l,onDismiss:o,onEdit:u,currentDate:n})},d.id)})})})}function P({name:r,isActive:a,isDeleteMode:l,onToggle:n,onDelete:o}){return e.jsxs("div",{className:"flex items-center justify-between p-3 bg-brand-neutral-dark/30 rounded-xl border border-brand-depth/50",children:[e.jsx("div",{className:"flex items-center gap-3",children:e.jsx("span",{className:"font-medium text-sm md:text-base text-brand-neutral-light",children:r})}),e.jsx("div",{className:"flex items-center gap-3",children:l?e.jsx("button",{onClick:o,className:`p-3 h-4 text-brand-negative hover:text-brand-negative/80 transition-colors flex items-center justify-center \r
                    rounded-md hover:bg-brand-negative/10 cursor-pointer`,title:"Delete Category",children:e.jsx(_,{className:"!text-[20px]"})}):e.jsx("button",{onClick:()=>n(!a),className:`relative w-12 h-6 rounded-full transition-colors duration-200 ease-in-out cursor-pointer ${a?"bg-brand-accent-1":"bg-brand-neutral-dark"}`,children:e.jsx(m.div,{initial:!1,animate:{x:a?26:7},className:"absolute top-1 w-4 h-4 rounded-full bg-white shadow-sm"})})})]})}function W({onAdd:r,onCancel:a}){const[l,n]=i.useState(""),o=u=>{u.preventDefault(),l.trim()&&(r(l),n(""))};return e.jsxs("form",{onSubmit:o,className:"mt-2 flex flex-col sm:flex-row gap-2",children:[e.jsx("input",{value:l,onChange:u=>n(u.target.value),placeholder:"Nazwa kategorii...",className:`flex-1 px-4 py-2 bg-brand-neutral-dark/40 border border-brand-depth rounded-xl \r
                       text-brand-neutral-light focus:outline-none focus:border-brand-primary`,autoFocus:!0}),e.jsx("button",{type:"submit",className:`bg-brand-primary px-4 py-2 rounded-xl text-brand-neutral-light font-bold\r
                  hover:bg-brand-primary/80 transition-all cursor-pointer`,children:"Dodaj"}),e.jsx("button",{type:"button",onClick:a,className:`bg-brand-neutral-dark px-4 py-2 rounded-xl text-brand-neutral-light \r
                  hover:bg-brand-neutral-dark/80 transition-all cursor-pointer`,children:"Anuluj"})]})}function Q({isOpen:r,onClose:a,categories:l,onToggleCategory:n,onAddCategory:o,onDeleteCategory:u}){const[h,d]=i.useState(!1),[s,b]=i.useState(!1);return e.jsx(z,{children:r&&e.jsxs(e.Fragment,{children:[e.jsx(m.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},onClick:a,className:"fixed inset-0 bg-brand-neutral-darker/70 backdrop-blur-xs z-55"}),e.jsx(m.div,{initial:{opacity:0,scale:.95,y:20},animate:{opacity:1,scale:1,y:0},exit:{opacity:0,scale:.95,y:20},className:"fixed inset-0 flex items-center justify-center z-55 pointer-events-none",children:e.jsxs("div",{className:`overflow-hidden flex flex-col w-full max-w-lg max-h-[85vh] bg-brand-neutral-darker border border-brand-depth \r
                          rounded-2xl shadow-2xl pointer-events-auto mx-4`,children:[e.jsxs("div",{className:"p-6 border-b border-brand-depth flex justify-between items-center bg-brand-neutral-dark/50",children:[e.jsx("h2",{className:"text-xl font-bold text-brand-neutral-light",children:"Aktywne kategorie"}),e.jsx("button",{onClick:a,className:`text-brand-secondary hover:text-brand-neutral-dark hover:bg-brand-neutral-light/70 rounded-full \r
                  p-1 flex items-center justify-center cursor-pointer transition-all`,children:e.jsx(S,{})})]}),e.jsxs("div",{className:"flex-1 overflow-y-auto p-6 space-y-4",children:[e.jsx("div",{className:"space-y-2",children:l.map(c=>e.jsx(P,{name:c.name,isActive:c.is_active,isDeleteMode:s,onToggle:()=>n(c.id),onDelete:()=>u(c.id)},c.id))}),h?e.jsx(W,{onAdd:c=>{o(c),d(!1)},onCancel:()=>d(!1)}):e.jsx("button",{onClick:()=>d(!0),className:`w-full mt-2  py-2 border border-dashed border-brand-neutral-light/30 rounded-xl\r
                                 text-brand-neutral-light/60 hover:text-brand-neutral-light hover:border-brand-neutral-light/60\r
                                 transition-all cursor-pointer`,children:"+ Dodaj nową kategorię"}),e.jsx("button",{onClick:()=>b(!s),className:"w-full px-4 rounded-lg transition-all duration-200 cursor-pointer text-brand-accent-1 hover:text-brand-accent-1/80 hover:underline",title:s?"Zarządzaj kategoriami":"Usuń kategorie",children:e.jsx("span",{children:s?"Tryb zarządzania":"Tryb usuwania"})})]})]})})]})})}function V({task:r,category:a,onClick:l,onRestore:n,onDelete:o,isExpanded:u}){return e.jsxs(m.div,{layout:!0,onClick:l,className:`relative overflow-hidden p-3 bg-brand-neutral-dark/30 rounded-xl border border-brand-depth/50 cursor-pointer 
              hover:bg-brand-neutral-dark/50 transition-colors
                  ${u?"border-brand-primary/30 bg-brand-neutral-dark/50":""}`,children:[e.jsxs(m.div,{layout:"position",className:"flex items-center justify-between gap-3",children:[e.jsx("div",{className:"flex items-center gap-3 min-w-0 flex-1",children:e.jsxs("div",{className:"flex flex-col min-w-0 flex-1",children:[e.jsx("span",{className:"font-medium text-brand-neutral-light truncate",children:r.description}),e.jsxs("div",{className:"flex items-center gap-2 text-xs text-brand-neutral-light/50",children:[e.jsx("span",{children:a?.name||"Brak kategorii"}),e.jsx("span",{children:"•"}),e.jsx("span",{children:r.completed_at?new Date(r.completed_at).toLocaleDateString():"---"})]})]})}),e.jsxs("div",{className:"text-right flex-shrink-0 flex items-center gap-2",children:[e.jsxs("div",{className:"hidden sm:flex text-xs text-brand-neutral-light/40 flex-col items-end",children:[e.jsx("span",{children:"Termin:"}),e.jsx("span",{children:r.deadline?new Date(r.deadline).toLocaleDateString():"Brak"})]}),e.jsx("button",{onClick:h=>{h.stopPropagation(),n(r.id)},className:`flex items-center justify-center p-1 rounded-full hover:bg-brand-accent-1/20 \r
                    text-brand-neutral-light/60 hover:text-brand-accent-1 \r
                      transition-colors cursor-pointer`,title:"Przywróć zadanie",children:e.jsx(I,{className:"scale-90"})}),e.jsx("button",{onClick:h=>{h.stopPropagation(),o(r.id)},className:`flex items-center justify-center p-1 rounded-full hover:bg-brand-negative/20 \r
                    text-brand-neutral-light/60 hover:text-brand-negative \r
                      transition-colors cursor-pointer`,title:"Usuń zadanie",children:e.jsx(O,{className:"scale-90"})})]})]}),u&&e.jsx(m.div,{layout:"position",initial:{opacity:0,height:0},animate:{opacity:1,height:"auto"},transition:{duration:.3,opacity:{delay:.2}},className:"mt-3 pt-3 border-t border-brand-neutral-light/10",children:e.jsx("p",{className:"text-sm text-brand-neutral-light/80 ",children:r.description})})]})}function Y({isOpen:r,onClose:a,tasks:l,categories:n,onRestore:o,onDelete:u}){const[h,d]=i.useState(null),[s,b]=i.useState(""),[c,C]=i.useState("all"),[f,T]=i.useState(new Date),[j,N]=i.useState(!1),y=i.useRef(null),[p,v]=i.useState(null);i.useEffect(()=>{const t=x=>{y.current&&!y.current.contains(x.target)&&N(!1)};return document.addEventListener("mousedown",t),()=>{document.removeEventListener("mousedown",t)}},[]);const w=i.useMemo(()=>l.filter(t=>{if(!t.is_completed&&!t.is_dismissed||!t.is_dismissed)return!1;const x=t.completed_at?new Date(t.completed_at):null;return!(!x||!(x.getMonth()===f.getMonth()&&x.getFullYear()===f.getFullYear())||c!=="all"&&t.category_id!==c||s&&!t.description.toLowerCase().includes(s.toLowerCase()))}).sort((t,x)=>{const D=t.completed_at?new Date(t.completed_at).getTime():0;return(x.completed_at?new Date(x.completed_at).getTime():0)-D}),[l,f,c,s]),k=t=>{d(x=>x===t?null:t)},g=[{label:"Wszystkie kategorie",value:"all"},...n.map(t=>({label:t.name,value:t.id}))];return e.jsx(z,{children:r&&e.jsxs(e.Fragment,{children:[e.jsx(m.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},onClick:a,className:"fixed inset-0 bg-brand-neutral-darker/70 h-full backdrop-blur-xs z-55"}),e.jsx(m.div,{initial:{opacity:0,scale:.95,y:20},animate:{opacity:1,scale:1,y:0},exit:{opacity:0,scale:.95,y:20},className:"fixed inset-0 flex items-center justify-center z-55 pointer-events-none",children:e.jsxs("div",{className:`overflow-hidden flex flex-col w-full max-w-4xl max-h-[85vh] bg-brand-neutral-darker border border-brand-depth \r
                          rounded-2xl shadow-2xl pointer-events-auto mx-4`,children:[e.jsxs("div",{className:"p-6 border-b border-brand-depth flex justify-between items-center bg-brand-neutral-dark/50",children:[e.jsx("h2",{className:"text-xl font-bold text-brand-neutral-light",children:"Historia zadań"}),e.jsx("button",{onClick:a,className:`text-brand-secondary hover:text-brand-neutral-dark hover:bg-brand-neutral-light/70 rounded-full \r
                  p-1 flex items-center justify-center cursor-pointer transition-all`,children:e.jsx(S,{className:"w-6 h-6"})})]}),e.jsxs("div",{className:"p-4 border-b border-brand-depth/50 bg-brand-neutral-dark/20 flex flex-col md:flex-row gap-4",ref:y,children:[e.jsx("div",{className:"flex-1",children:e.jsxs("div",{className:"relative",children:[e.jsx("div",{className:"absolute inset-y-0 left-0 pl-2 flex items-center pointer-events-none text-brand-neutral-light/50",children:e.jsx(A,{className:"scale-88"})}),e.jsx("input",{type:"text",value:s,onChange:t=>b(t.target.value),placeholder:"Szukaj zadania...",className:`block w-full pl-10 pr-3 py-2.5 border border-brand-depth rounded-lg bg-brand-neutral-dark \r
                                text-brand-neutral-light placeholder-brand-neutral-light/30 focus:outline-none focus:ring-1\r
                                focus:ring-brand-accent-1`})]})}),e.jsx(z,{mode:"wait",children:j?e.jsx(m.div,{initial:{opacity:0,scale:.95},animate:{opacity:1,scale:1},exit:{opacity:0,scale:.95},transition:{duration:.2},children:e.jsx(B,{selectedDate:f,onDateChange:T,format:"month"})},"date-selector"):e.jsxs(m.div,{initial:{opacity:0,scale:.95},animate:{opacity:1,scale:1},exit:{opacity:0,scale:.95},transition:{duration:.2},className:"w-full md:w-77 flex gap-2 items-start relative",children:[e.jsx("div",{className:"flex-1",children:e.jsx(L,{value:c,onChange:C,options:g,placeholder:"Kategoria"})}),e.jsx("button",{onClick:()=>N(!j),className:`p-3 rounded-lg border transition-colors flex items-center justify-center shrink-0
                             ${j?"bg-brand-neutral-dark border-brand-accent-1 text-brand-accent-1":"bg-brand-neutral-dark border-brand-depth text-brand-neutral-light hover:border-brand-neutral-light/30"}`,children:e.jsx($,{})})]},"category-selector")})]}),e.jsx("div",{className:"flex-1 overflow-y-auto md:p-6 p-4 space-y-4",children:w.length===0?e.jsxs("div",{className:"text-center text-brand-neutral-light/40 py-10 flex flex-col items-center gap-2",children:[e.jsx("span",{className:"material-symbols-sharp text-4xl opacity-50",children:"inbox"}),e.jsx("span",{children:"Brak zadań w historii dla wybranych kryteriów."})]}):w.map(t=>e.jsx(V,{task:t,category:n.find(x=>x.id===t.category_id),isExpanded:h===t.id,onClick:()=>k(t.id),onRestore:o,onDelete:x=>v(x)},t.id))}),e.jsx("div",{className:"p-4 border-t border-brand-depth bg-brand-neutral-dark/30 text-center",children:e.jsx("p",{className:"text-xs text-brand-neutral-light/50",children:"Historyczne zadania można przywrócić do listy aktywnych za pomocą przycisku."})})]})}),e.jsx(H,{isOpen:!!p,onClose:()=>v(null),onConfirm:()=>{p&&(u(p),v(null))},title:"Usuń zadanie",description:"Czy na pewno chcesz trwale usunąć to zadanie? Tej operacji nie można cofnąć.",confirmLabel:"Usuń zadanie"})]})})}function Z({currentMode:r,onModeChange:a}){const l=[{id:"active",label:"Nieukończone"},{id:"all",label:"Wszystkie"},{id:"completed",label:"Ukończone"}];return e.jsx("div",{className:"flex w-full sm:w-auto bg-brand-neutral-dark/50 p-1 rounded-xl border border-brand-depth",children:l.map(n=>{const o=r===n.id;return e.jsxs("button",{onClick:()=>a(n.id),className:`relative flex-1 sm:flex-none px-2 sm:px-4 py-1.5 rounded-lg text-sm font-medium transition-colors ${o?"text-brand-neutral-light":"text-brand-neutral-light/60 hover:text-brand-neutral-light cursor-pointer"}`,children:[o&&e.jsx(m.div,{layoutId:"viewModeIndicator",className:"absolute inset-0 bg-brand-secondary/80 rounded-lg shadow-sm z-10",transition:{type:"spring",stiffness:300,damping:30}}),e.jsx("span",{className:"relative z-20",children:n.label})]},n.id)})})}function ae(){const{tasks:r,categories:a,addTask:l,toggleTaskCompletion:n,deleteTask:o,toggleCategory:u,addCategory:h,dismissTask:d,deleteCategory:s,restoreTask:b,editTask:c}=E(),[C,f]=i.useState(!1),[T,j]=i.useState(!1),[N,y]=i.useState(!1),[p,v]=i.useState("all"),w=i.useMemo(()=>r.filter(g=>g.is_dismissed?!1:p==="active"?!g.is_completed:p==="completed"?g.is_completed:!0),[r,p]),k=i.useMemo(()=>a.filter(g=>g.is_active),[a]);return e.jsxs(m.div,{initial:{opacity:0},animate:{opacity:1},transition:{duration:.42},className:"py-6 lg:p-8 mx-auto space-y-3 xl:h-[calc(100vh)] flex flex-col",children:[e.jsxs("div",{className:"flex flex-col xl:flex-row items-center justify-between gap-3",children:[e.jsx("div",{className:"flex-1 flex flex-col sm:flex-row items-center gap-4 w-auto xl:w-full",children:e.jsx(Z,{currentMode:p,onModeChange:v})}),e.jsx("div",{className:"flex flex-col md:flex-row w-full xl:w-auto items-center gap-3",children:e.jsxs("div",{className:"flex gap-2 w-full xl:w-auto justify-center overflow-x-auto text-sm",children:[e.jsxs("button",{onClick:()=>f(!0),className:`flex items-center bg-brand-accent-1/80 text-brand-neutral-light/70 px-2 sm:px-3 py-2 rounded-xl\r
                      hover:bg-brand-accent-1 hover:text-brand-neutral-light transition-colors cursor-pointer`,children:[e.jsx("span",{className:"material-symbols-sharp",children:"add"}),e.jsx("span",{className:"font-semibold text-center ml-2",children:"Dodaj"})]}),e.jsxs("button",{onClick:()=>j(!0),className:`flex items-center bg-brand-accent-2/80 text-brand-neutral-light/70 px-2 sm:px-3 py-2 rounded-xl\r
                      hover:bg-brand-accent-2 hover:text-brand-neutral-light transition-colors  cursor-pointer`,children:[e.jsx("span",{className:"material-symbols-sharp",children:"filter_list"}),e.jsx("span",{className:"font-semibold text-center ml-2",children:"Filtruj"})]}),e.jsxs("button",{onClick:()=>y(!0),className:`flex items-center bg-brand-accent-3/80 text-brand-neutral-light/70 px-2 sm:px-3 py-2 rounded-xl\r
                      hover:bg-brand-accent-3 hover:text-brand-neutral-light transition-colors cursor-pointer`,children:[e.jsx("span",{className:"material-symbols-sharp",children:"history"}),e.jsx("span",{className:"font-semibold text-center ml-2",children:"Historia"})]})]})})]}),e.jsx("div",{className:"flex-grow overflow-hidden",children:e.jsx(U,{tasks:w,categories:k,onComplete:n,currentDate:new Date,onDismiss:d,onEdit:c})}),e.jsx(F,{isOpen:C,onClose:()=>f(!1),onSubmit:l,categories:k}),e.jsx(Q,{isOpen:T,onClose:()=>j(!1),categories:a,onToggleCategory:u,onAddCategory:h,onDeleteCategory:s}),e.jsx(Y,{isOpen:N,onClose:()=>y(!1),categories:a,tasks:r,onRestore:b,onDelete:o})]})}export{ae as default};
