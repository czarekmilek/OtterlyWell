import{r as p,s as o,j as i}from"./index-BbWOTZI-.js";function C(a,n){const[f,_]=p.useState(!0),[l,b]=p.useState({calories:2370,protein:120,fat:72,carbs:270}),[k,m]=p.useState([]);p.useEffect(()=>{if(!a)return;async function r(){if(!a)return;_(!0);const{data:e,error:t}=await o.from("nutrition_goals").select("daily_kcal_limit, daily_protein_goal, daily_fat_goal, daily_carbs_goal").eq("user_id",a.id).maybeSingle();t&&console.error("Error fetching nutrition goals",t),e&&b(d=>({calories:e.daily_kcal_limit??d.calories,protein:e.daily_protein_goal??d.protein,fat:e.daily_fat_goal??d.fat,carbs:e.daily_carbs_goal??d.carbs}));const c=new Date(n);c.setHours(0,0,0,0);const s=new Date(n);s.setHours(23,59,59,999);const{data:u,error:g}=await o.from("calorie_entries").select("*").eq("user_id",a.id).gte("created_at",c.toISOString()).lte("created_at",s.toISOString()).order("created_at",{ascending:!1});g&&console.error("Error fetching entries",g),u&&m(u),_(!1)}r()},[a,n]);const j=p.useMemo(()=>k.reduce((r,e)=>(r.kcal+=e.kcal,r.protein+=e.protein,r.fat+=e.fat,r.carbs+=e.carbs,r),{kcal:0,protein:0,fat:0,carbs:0}),[k]);async function E(r,e){if(r.kcalPer100g==null||!a)return;let t=r.id;if(!t&&r.sourceId){const{data:y}=await o.from("foods").select("id").eq("source_id",r.sourceId).maybeSingle();if(y)t=y.id;else{const{data:h,error:w}=await o.from("foods").insert({name:r.name,brand:r.brand,source:"openfoodfacts",source_id:r.sourceId,kcal_per_100g:r.kcalPer100g,protein_g_per_100g:r.proteinPer100g,fat_g_per_100g:r.fatPer100g,carbs_g_per_100g:r.carbsPer100g,image_url:r.imageUrl,serving_size_g:r.servingSize,serving_unit:r.servingUnit,created_by:a.id}).select("id").single();w?console.error("Error creating food",w):h&&(t=h.id)}}const c=r.kcalPer100g*e/100,s=(r.proteinPer100g??0)*e/100,u=(r.fatPer100g??0)*e/100,g=(r.carbsPer100g??0)*e/100,d={user_id:a.id,food_id:t||null,name:`${r.name} (${e}g)`,kcal:Math.round(c),grams:e,protein:Math.round(s),fat:Math.round(u),carbs:Math.round(g),created_at:n.toISOString()},{data:x,error:v}=await o.from("calorie_entries").insert(d).select().single();v?console.error("Error inserting entry",v):x&&m(y=>[x,...y].sort((h,w)=>w.kcal-h.kcal))}const N=async r=>{if(!a)return;const{data:e}=await o.from("nutrition_goals").select("id").eq("user_id",a.id).maybeSingle();if(e){const{error:t}=await o.from("nutrition_goals").update(r).eq("id",e.id);t&&console.error("Error updating goals",t)}else{const{error:t}=await o.from("nutrition_goals").insert({user_id:a.id,daily_kcal_limit:l.calories,daily_protein_goal:l.protein,daily_fat_goal:l.fat,daily_carbs_goal:l.carbs,...r});t&&console.error("Error creating goals",t)}},S=(r,e)=>{const t=e>0?e:0;b(s=>({...s,[r]:t})),N({[{calories:"daily_kcal_limit",protein:"daily_protein_goal",fat:"daily_fat_goal",carbs:"daily_carbs_goal"}[r]]:t})};async function P(r,e){if(!a)return!1;let t=null;if(e){const{data:g,error:d}=await o.from("foods").insert({name:r.name,source:"user",kcal_per_100g:r.kcal,protein_g_per_100g:r.protein,fat_g_per_100g:r.fat,carbs_g_per_100g:r.carbs,serving_size_g:e.servingWeight,serving_unit:e.servingName,created_by:a.id}).select("id").single();d?console.error("Error creating custom food",d):g&&(t=g.id)}const c={...r,user_id:a.id,food_id:t,name:`${r.name} (${r.grams}g)`,created_at:n.toISOString()},{data:s,error:u}=await o.from("calorie_entries").insert(c).select().single();return u?(console.error("Error inserting entry",u),!1):s?(m(g=>[s,...g].sort((d,x)=>x.kcal-d.kcal)),!0):!1}async function I(r){const{error:e}=await o.from("calorie_entries").delete().eq("id",r);if(e){console.error("Error deleting entry",e);return}m(t=>t.filter(c=>c.id!==r))}async function M(r,e){const{error:t}=await o.from("calorie_entries").update(e).eq("id",r);if(t){console.error("Error updating entry",t);return}m(c=>c.map(s=>s.id===r?{...s,...e}:s))}return{entries:k,isLoading:f,goals:l,totalCalories:j,addEntryFromFood:E,addCustomEntry:P,removeEntry:I,editEntry:M,updateGoal:S}}function F({consumed:a,goal:n}){const f=n>0?a/n*100:0,_=n-a,l=_<0,b=Math.min(f,100);return i.jsx("div",{className:"relative flex items-center justify-center",children:i.jsx("div",{className:"w-64 h-64 rounded-full shadow-lg shadow-black/30 transition-all duration-300",style:{background:`conic-gradient(
                        var(--color-brand-accent-3) 0% ${b}%, 
                        var(--color-brand-neutral-dark) ${b}% 100%)`},children:i.jsxs("div",{className:`flex flex-col items-center justify-center absolute inset-0 m-auto w-44 h-44 \r
                      bg-brand-neutral-dark rounded-full border-4 border-brand-neutral-light/5 \r
                      transition-all duration-300`,children:[i.jsx("span",{className:"text-xs text-brand-secondary uppercase tracking-wider",children:l?"Nadwyżka":"Pozostało"}),i.jsxs("span",{className:`text-3xl font-bold ${l?"text-brand-negative":"text-brand-positive-lighter"}`,children:[l?"+":"",Math.abs(_).toFixed(0),i.jsx("span",{className:"text-lg font-normal text-brand-secondary ml-1",children:"kcal"})]}),i.jsxs("span",{className:"text-xs text-brand-secondary mt-1",children:[(a/(n||1)*100).toFixed(0),"% celu"]})]})})})}function $(a,n){return n<=0?0:Math.min(100,Math.round(a/n*100))}function O({label:a,value:n,goal:f,color:_}){const l=$(n,f);return i.jsxs("div",{className:"w-full",children:[i.jsxs("div",{className:"text-sm flex justify-between items-baseline mb-1",children:[i.jsx("span",{className:"font-semibold text-brand-neutral-light",children:a}),i.jsxs("span",{className:"text-brand-neutral-light",children:[n.toFixed(0),"g /"," ",i.jsxs("span",{className:"text-brand-secondary",children:[f,"g"]})]})]}),i.jsx("div",{className:"h-4 w-full rounded-full bg-brand-neutral-light/20 overflow-hidden",children:i.jsx("div",{className:"h-full rounded-full",style:{width:`${l}%`,backgroundColor:n>f?"var(--color-brand-negative)":_}})})]})}export{F as C,O as L,C as u};
