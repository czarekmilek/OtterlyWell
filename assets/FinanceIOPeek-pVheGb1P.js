import{a as _,r as i,s as m,j as d}from"./index-DagVn5ui.js";import{m as v}from"./proxy-DGw4AqAz.js";function C(){const{user:e}=_(),[o,f]=i.useState([]),[x,b]=i.useState(!0),[p,y]=i.useState(null),u=i.useCallback(async()=>{if(e){b(!0),y(null);try{const{data:s,error:l}=await m.from("finance_categories").select("*").order("name");if(l)throw l;f(s)}catch(s){console.error("Error fetching categories:",s),y(s.message)}finally{b(!1)}}},[e]);return i.useEffect(()=>{u()},[u]),{categories:o,categoriesLoading:x,categoriesError:p,fetchCategories:u,addCategory:async s=>{if(!e)return;const{data:l,error:t}=await m.from("finance_categories").insert({...s,user_id:e.id}).select().single();if(t)throw console.error("Error adding category:",t),t;return f(a=>[...a,l]),l},toggleCategory:async(s,l)=>{if(!e)return;const t=o.find(a=>a.name===s&&a.type===l);if(t){const a=!t.is_active,{data:n,error:r}=await m.from("finance_categories").update({is_active:a}).eq("id",t.id).select().single();if(r)throw console.error("Error toggling category:",r),r;f(c=>c.map(h=>h.id===t.id?n:h))}else{const a={name:s,type:l,is_active:!0,user_id:e.id},{data:n,error:r}=await m.from("finance_categories").insert(a).select().single();if(r)throw console.error("Error creating category:",r),r;f(c=>[...c,n])}}}}function j(){const{user:e}=_(),[o,f]=i.useState([]),[x,b]=i.useState(!0),[p,y]=i.useState(null),u=i.useCallback(async()=>{if(e){b(!0),y(null);try{const{data:g,error:s}=await m.from("finance_budgets").select("*");if(s)throw s;f(g||[])}catch(g){console.error("Error fetching budgets:",g),y(g.message)}finally{b(!1)}}},[e]);return i.useEffect(()=>{u()},[u]),{budgets:o,budgetsLoading:x,budgetsError:p,fetchBudgets:u,saveBudget:async(g,s)=>{if(!e)return;const l=o.find(r=>r.category_id===g),t={user_id:e.id,category_id:g,amount:s,month:new Date().getMonth(),year:new Date().getFullYear()},{data:a,error:n}=await m.from("finance_budgets").upsert(l?{...l,amount:s}:t).select().single();if(n)throw console.error("Error saving budget",n),n;f(r=>[...r.filter(h=>h.category_id!==g),a])}}}function T(e){const{user:o}=_(),[f,x]=i.useState([]),[b,p]=i.useState(!0),[y,u]=i.useState(null),w=i.useCallback(async()=>{if(o){p(!0),u(null);try{const{data:t,error:a}=await m.from("finance_transactions").select("*").order("date",{ascending:!1});if(a)throw a;const n=(t||[]).map(r=>({...r,finance_categories:e.find(c=>c.id===r.category_id)}));x(n)}catch(t){console.error("Error fetching transactions:",t),u(t.message)}finally{p(!1)}}},[o,e]);return i.useEffect(()=>{w()},[w]),{transactions:f,transactionsLoading:b,transactionsError:y,fetchTransactions:w,addTransaction:async t=>{if(!o)return;const{data:a,error:n}=await m.from("finance_transactions").insert({...t,user_id:o.id}).select("*").single();if(n)throw console.error("Error adding transaction:",n),n;const r={...a,finance_categories:e.find(c=>c.id===a.category_id)};return x(c=>[r,...c]),r},deleteTransaction:async t=>{const{error:a}=await m.from("finance_transactions").delete().eq("id",t);if(a)throw a;x(n=>n.filter(r=>r.id!==t))},editTransaction:async(t,a)=>{const{data:n,error:r}=await m.from("finance_transactions").update(a).eq("id",t).select("*").single();if(r)throw console.error("Error editing transaction:",r),r;const c={...n,finance_categories:e.find(h=>h.id===n.category_id)};return x(h=>h.map(E=>E.id===t?c:E)),c}}}function S(){const{categories:e,categoriesLoading:o,categoriesError:f,fetchCategories:x,addCategory:b,toggleCategory:p}=C(),{budgets:y,budgetsLoading:u,budgetsError:w,fetchBudgets:g,saveBudget:s}=j(),{transactions:l,transactionsLoading:t,transactionsError:a,fetchTransactions:n,addTransaction:r,deleteTransaction:c,editTransaction:h}=T(e),E=i.useCallback(async()=>{await Promise.all([x(),g(),n()])},[x,g,n]);return{categories:e,transactions:l,budgets:y,isLoading:o||u||t,error:f||w||a,addCategory:b,toggleCategory:p,addTransaction:r,deleteTransaction:c,editTransaction:h,saveBudget:s,refresh:E}}function F({moneyLeft:e,totalBudget:o}){return d.jsx(v.div,{initial:{opacity:0,x:20},animate:{opacity:1,x:0},transition:{delay:.3},className:"h-full order-3",children:d.jsxs("div",{className:`flex flex-col justify-between items-start lg:items-end lg:text-right\r
                  h-full bg-brand-neutral-dark rounded-xl p-6 border border-brand-depth`,children:[d.jsxs("div",{children:[d.jsx("p",{className:"text-xs text-brand-neutral-light/70 uppercase tracking-wide mb-2",children:"Pozostały budżet"}),d.jsxs("p",{className:`text-4xl font-bold ${e>=0?"text-brand-accent-1":"text-brand-negative"} transition-colors`,children:[e.toFixed(2),d.jsx("span",{className:"text-lg font-normal text-brand-secondary ml-1",children:"PLN"})]})]}),d.jsxs("div",{className:"mt-4",children:[d.jsx("p",{className:"text-xs text-brand-secondary mb-1",children:"Zaplanowany budżet"}),d.jsxs("p",{className:"font-bold text-xl text-brand-neutral-light",children:[o.toFixed(0)," PLN"]})]})]})})}function P({type:e,amount:o}){return d.jsxs(v.div,{initial:{opacity:0,x:-20},animate:{opacity:1,x:0},transition:{delay:.1},className:"bg-brand-neutral-dark p-4 border border-brand-depth rounded-xl",children:[d.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[d.jsx("div",{className:"w-2 h-2 rounded-full",style:{backgroundColor:e==="income"?"var(--color-brand-positive-lighter)":"var(--color-brand-negative)"}}),d.jsx("p",{className:"text-xs text-brand-neutral-light/70 uppercase tracking-wide",children:e==="income"?"Przychody":"Wydatki"})]}),d.jsxs("p",{className:`text-2xl font-bold ${e==="income"?"text-brand-positive-lighter":"text-brand-negative"}`,children:[e==="income"?"+":"-",o.toFixed(2),d.jsx("span",{className:"text-lg font-normal text-brand-secondary ml-1",children:"PLN"})]})]})}export{F,P as a,S as u};
