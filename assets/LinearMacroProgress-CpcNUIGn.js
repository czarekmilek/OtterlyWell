import{r as m,s as d,j as s}from"./index-Ble1yeuX.js";function C(t,n){const[_,g]=m.useState(!0),[l,b]=m.useState({calories:2137,protein:133,fat:77,carbs:255}),[k,p]=m.useState([]);m.useEffect(()=>{if(!t)return;async function r(){if(!t)return;g(!0);const{data:e,error:a}=await d.from("profiles").select("goal_calories, goal_protein, goal_fat, goal_carbs").eq("id",t.id).maybeSingle();a&&console.error("Error fetching profile",a),e&&b(c=>({calories:e.goal_calories??c.calories,protein:e.goal_protein??c.protein,fat:e.goal_fat??c.fat,carbs:e.goal_carbs??c.carbs}));const o=new Date(n);o.setHours(0,0,0,0);const i=new Date(n);i.setHours(23,59,59,999);const{data:u,error:f}=await d.from("calorie_entries").select("*").eq("user_id",t.id).gte("created_at",o.toISOString()).lte("created_at",i.toISOString()).order("created_at",{ascending:!1});f&&console.error("Error fetching entries",f),u&&p(u),g(!1)}r()},[t,n]);const v=m.useMemo(()=>k.reduce((r,e)=>(r.kcal+=e.kcal,r.protein+=e.protein,r.fat+=e.fat,r.carbs+=e.carbs,r),{kcal:0,protein:0,fat:0,carbs:0}),[k]);async function E(r,e){if(r.kcalPer100g==null||!t)return;let a=r.id;if(!a&&r.sourceId){const{data:h}=await d.from("foods").select("id").eq("source_id",r.sourceId).maybeSingle();if(h)a=h.id;else{const{data:w,error:y}=await d.from("foods").insert({name:r.name,brand:r.brand,source:"openfoodfacts",source_id:r.sourceId,kcal_per_100g:r.kcalPer100g,protein_g_per_100g:r.proteinPer100g,fat_g_per_100g:r.fatPer100g,carbs_g_per_100g:r.carbsPer100g,image_url:r.imageUrl,serving_size_g:r.servingSize,serving_unit:r.servingUnit}).select("id").single();y?console.error("Error creating food",y):w&&(a=w.id)}}const o=r.kcalPer100g*e/100,i=(r.proteinPer100g??0)*e/100,u=(r.fatPer100g??0)*e/100,f=(r.carbsPer100g??0)*e/100,c={user_id:t.id,food_id:a||null,name:`${r.name} (${e}g)`,kcal:Math.round(o),grams:e,protein:Math.round(i),fat:Math.round(u),carbs:Math.round(f),created_at:n.toISOString()},{data:x,error:j}=await d.from("calorie_entries").insert(c).select().single();j?console.error("Error inserting entry",j):x&&p(h=>[x,...h].sort((w,y)=>y.kcal-w.kcal))}const N=async r=>{if(!t)return;const{error:e}=await d.from("profiles").upsert({id:t.id,goal_calories:l.calories,goal_protein:l.protein,goal_fat:l.fat,goal_carbs:l.carbs,...r});e&&console.error("Error updating goals",e)},S=(r,e)=>{const a=e>0?e:0;b(i=>({...i,[r]:a}));const o=`goal_${r}`;N({[o]:a})};async function P(r,e){if(!t)return!1;let a=null;if(e){const{data:f,error:c}=await d.from("foods").insert({name:r.name,source:"user",kcal_per_100g:r.kcal,protein_g_per_100g:r.protein,fat_g_per_100g:r.fat,carbs_g_per_100g:r.carbs,serving_size_g:e.servingWeight,serving_unit:e.servingName,created_by:t.id}).select("id").single();c?console.error("Error creating custom food",c):f&&(a=f.id)}const o={...r,user_id:t.id,food_id:a,name:`${r.name} (${r.grams}g)`,created_at:n.toISOString()},{data:i,error:u}=await d.from("calorie_entries").insert(o).select().single();return u?(console.error("Error inserting entry",u),!1):i?(p(f=>[i,...f].sort((c,x)=>x.kcal-c.kcal)),!0):!1}async function I(r){const{error:e}=await d.from("calorie_entries").delete().eq("id",r);if(e){console.error("Error deleting entry",e);return}p(a=>a.filter(o=>o.id!==r))}async function M(r,e){const{error:a}=await d.from("calorie_entries").update(e).eq("id",r);if(a){console.error("Error updating entry",a);return}p(o=>o.map(i=>i.id===r?{...i,...e}:i))}return{entries:k,isLoading:_,goals:l,totalCalories:v,addEntryFromFood:E,addCustomEntry:P,removeEntry:I,editEntry:M,updateGoal:S}}function O({consumed:t,goal:n}){const _=n>0?t/n*100:0,g=n-t,l=g<0,b=Math.min(_,100);return s.jsx("div",{className:"relative flex items-center justify-center",children:s.jsx("div",{className:"w-64 h-64 rounded-full shadow-lg shadow-black/30 transition-all duration-300",style:{background:`conic-gradient(
                        var(--color-brand-accent-3) 0% ${b}%, 
                        var(--color-brand-neutral-dark) ${b}% 100%)`},children:s.jsxs("div",{className:`flex flex-col items-center justify-center absolute inset-0 m-auto w-44 h-44 \r
                      bg-brand-neutral-dark rounded-full border-4 border-brand-neutral-light/5 \r
                      transition-all duration-300`,children:[s.jsx("span",{className:"text-xs text-brand-secondary uppercase tracking-wider",children:l?"Nadwyżka":"Pozostało"}),s.jsxs("span",{className:`text-3xl font-bold ${l?"text-brand-negative":"text-brand-positive-lighter"}`,children:[l?"+":"",Math.abs(g).toFixed(0),s.jsx("span",{className:"text-lg font-normal text-brand-secondary ml-1",children:"kcal"})]}),s.jsxs("span",{className:"text-xs text-brand-secondary mt-1",children:[(t/(n||1)*100).toFixed(0),"% celu"]})]})})})}function $(t,n){return n<=0?0:Math.min(100,Math.round(t/n*100))}function q({label:t,value:n,goal:_,color:g}){const l=$(n,_);return s.jsxs("div",{className:"w-full",children:[s.jsxs("div",{className:"text-sm flex justify-between items-baseline mb-1",children:[s.jsx("span",{className:"font-semibold text-brand-neutral-light",children:t}),s.jsxs("span",{className:"text-brand-neutral-light",children:[n.toFixed(0),"g /"," ",s.jsxs("span",{className:"text-brand-secondary",children:[_,"g"]})]})]}),s.jsx("div",{className:"h-4 w-full rounded-full bg-brand-neutral-light/20 overflow-hidden",children:s.jsx("div",{className:"h-full rounded-full",style:{width:`${l}%`,backgroundColor:g}})})]})}export{O as C,q as L,C as u};
