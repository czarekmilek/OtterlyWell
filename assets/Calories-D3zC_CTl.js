import{j as e,f as _,g as $,h as B,r as o,i as S,k as E,K as M,l as I,O as w,z as P,Q as T,m as G,s as O,S as W,n as A,a as U}from"./index-1dX7M82B.js";import{C as q,L as z,u as K}from"./LinearMacroProgress-ey4yX_Ol.js";import{m as v}from"./proxy-IKh-44iE.js";import{A as C,C as L}from"./ConfirmDeleteDialog-BlCcLmEk.js";import{D as R}from"./DateSelector-CgO7mwVk.js";function Q({isLoading:a,goalCalories:s,goalProtein:n,goalFat:r,goalCarbs:i,setGoalCalories:l,setGoalProtein:d,setGoalFat:c,setGoalCarbs:x,onClose:u}){return e.jsxs(v.div,{initial:{opacity:0,scale:.95},animate:{opacity:1,scale:1},exit:{opacity:0,scale:.95},transition:{duration:.2},className:"flex flex-col gap-4 sm:gap-2",children:[e.jsx("h3",{className:"text-lg font-semibold text-brand-neutral-light",children:"Edytuj cele"}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-2",children:[e.jsxs("label",{className:"flex flex-col gap-1",children:[e.jsx("span",{className:"text-sm text-brand-secondary",children:"Cel kalorii (kcal)"}),e.jsx("input",{type:"number",min:1,disabled:a,className:`rounded-xl border border-brand-depth bg-brand-neutral-dark px-4 py-3 text-brand-neutral-light focus:ring-2 \r
                    focus:ring-brand-accent-1/40 focus:outline-none disabled:opacity-50`,value:s,onChange:m=>{const t=Number(m.target.value);l(t>0?t:0)}})]}),e.jsxs("label",{className:"flex flex-col gap-1",children:[e.jsx("span",{className:"text-sm text-brand-secondary",children:"Białko (g)"}),e.jsx("input",{type:"number",min:0,disabled:a,className:`rounded-xl border border-brand-depth bg-brand-neutral-dark px-4 py-3 text-brand-neutral-light focus:ring-2 \r
                    focus:ring-brand-accent-1/40 focus:outline-none disabled:opacity-50`,value:n,onChange:m=>d(Number(m.target.value)||0)})]}),e.jsxs("label",{className:"flex flex-col gap-1",children:[e.jsx("span",{className:"text-sm text-brand-secondary",children:"Tłuszcz (g)"}),e.jsx("input",{type:"number",min:0,disabled:a,className:`rounded-xl border border-brand-depth bg-brand-neutral-dark px-4 py-3 text-brand-neutral-light focus:ring-2 \r
                    focus:ring-brand-accent-1/40 focus:outline-none disabled:opacity-50`,value:r,onChange:m=>c(Number(m.target.value)||0)})]}),e.jsxs("label",{className:"flex flex-col gap-1",children:[e.jsx("span",{className:"text-sm text-brand-secondary",children:"Węglowodany (g)"}),e.jsx("input",{type:"number",min:0,disabled:a,className:`rounded-xl border border-brand-depth bg-brand-neutral-dark px-4 py-3 text-brand-neutral-light focus:ring-2 \r
                    focus:ring-brand-accent-1/40 focus:outline-none disabled:opacity-50`,value:i,onChange:m=>x(Number(m.target.value)||0)})]})]}),e.jsx("div",{className:"flex justify-end sm:mt-3",children:e.jsxs("button",{onClick:u,className:"flex items-center gap-2 px-6 py-2 bg-brand-accent-1 text-white rounded-full hover:bg-brand-accent-1/90 transition-colors cursor-pointer",children:[e.jsx(_,{})," Gotowe"]})})]},"edit-form")}function F({label:a,value:s,unit:n,icon:r,type:i}){let l="text-brand-neutral-light",d="bg-brand-neutral-dark";return i==="positive"&&(l="text-brand-positive-lighter"),i==="negative"&&(l="text-brand-negative"),e.jsxs(v.div,{initial:{opacity:0,x:-20},animate:{opacity:1,x:0},transition:{delay:.1},className:`${d} p-4 border border-brand-depth rounded-xl w-full`,children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsx("div",{className:"text-brand-secondary/70 transform scale-83",children:r}),e.jsx("p",{className:"text-xs text-brand-neutral-light/70 uppercase tracking-wide",children:a})]}),e.jsxs("p",{className:`text-2xl font-bold ${l}`,children:[s.toFixed(0),e.jsx("span",{className:"text-lg font-normal text-brand-secondary ml-1",children:n})]})]})}function Z({goalCalories:a,totalCalories:s,goalProtein:n,goalFat:r,goalCarbs:i}){return e.jsxs(v.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},transition:{duration:.2},className:"grid grid-cols-1 lg:grid-cols-3 gap-6 lg:gap-0",children:[e.jsxs("div",{className:"flex flex-col gap-4 order-2 lg:order-1 justify-center",children:[e.jsx(F,{label:"Cel dzienny",value:a,unit:"kcal",icon:e.jsx($,{}),type:"neutral"}),e.jsx(F,{label:"Spożyto",value:s.kcal,unit:"kcal",icon:e.jsx(B,{}),type:s.kcal>a?"negative":"positive"})]}),e.jsx(v.div,{initial:{scale:.9,opacity:0},animate:{scale:1,opacity:1},transition:{type:"spring",duration:.8},className:"order-1 lg:order-2 lg:-mt-16 overflow-visible flex items-center justify-center pointer-events-none",children:e.jsx(q,{consumed:s.kcal,goal:a})}),e.jsx(v.div,{initial:{opacity:0,x:20},animate:{opacity:1,x:0},transition:{delay:.3},className:"h-full order-3 flex flex-col justify-center",children:e.jsxs("div",{className:"bg-brand-neutral-dark rounded-xl p-4 border border-brand-depth flex flex-col gap-3.5",children:[e.jsx("p",{className:"text-xs text-brand-secondary uppercase tracking-wider mb-2",children:"Makroskladniki"}),e.jsx(z,{label:"Białko",value:s.protein,goal:n,color:"var(--color-brand-primary)"}),e.jsx(z,{label:"Tłuszcz",value:s.fat,goal:r,color:"var(--color-brand-accent-1)"}),e.jsx(z,{label:"Węgle",value:s.carbs,goal:i,color:"var(--color-brand-accent-2)"})]})})]},"stats-view")}const J=({goalCalories:a,totalCalories:s,goalProtein:n,goalFat:r,goalCarbs:i,setGoalCalories:l,setGoalProtein:d,setGoalFat:c,setGoalCarbs:x,isLoading:u})=>{const[m,t]=o.useState(!1);return e.jsxs("div",{className:"bg-brand-neutral-dark/40 border border-brand-depth rounded-2xl p-6 relative",children:[e.jsx("div",{className:"absolute top-4 right-4 z-10",children:e.jsx("button",{onClick:()=>t(!m),className:"p-2 rounded-full hover:bg-brand-neutral-dark/80 text-brand-secondary hover:text-brand-accent-1 transition-colors flex items-center justify-center cursor-pointer",title:m?"Zamknij edycję":"Edytuj cele",disabled:u,children:m?e.jsx(S,{}):e.jsx(E,{})})}),e.jsx(C,{mode:"wait",children:m?e.jsx(Q,{isLoading:u,goalCalories:a,goalProtein:n,goalFat:r,goalCarbs:i,setGoalCalories:l,setGoalProtein:d,setGoalFat:c,setGoalCarbs:x,onClose:()=>t(!1)}):e.jsx(Z,{goalCalories:a,totalCalories:s,goalProtein:n,goalFat:r,goalCarbs:i})})]})},V=({isOpen:a,onClose:s,entry:n,onSave:r})=>{const[i,l]=o.useState(n.name),[d,c]=o.useState(n.kcal),[x,u]=o.useState(n.protein),[m,t]=o.useState(n.fat),[h,f]=o.useState(n.carbs),[g,y]=o.useState(n.grams);o.useEffect(()=>{a&&(l(n.name),c(n.kcal),u(n.protein),t(n.fat),f(n.carbs),y(n.grams))},[n,a]);const j=b=>{b.preventDefault(),r(n.id,{name:i,kcal:Number(d),protein:Number(x),fat:Number(m),carbs:Number(h),grams:Number(g)}),s()};return e.jsx(M,{show:a,as:o.Fragment,children:e.jsxs(I,{as:"div",className:"relative z-50",onClose:s,children:[e.jsx(w,{as:o.Fragment,enter:"transition-opacity ease-linear duration-300",enterFrom:"opacity-0",enterTo:"opacity-100",leave:"transition-opacity ease-linear duration-300",leaveFrom:"opacity-100",leaveTo:"opacity-0",children:e.jsx("div",{className:"fixed inset-0 bg-brand-neutral-darker/70 backdrop-blur-sm"})}),e.jsx("div",{className:"fixed inset-0 flex items-end justify-center",children:e.jsx(w,{as:o.Fragment,enter:"transition ease-in-out duration-300 transform",enterFrom:"translate-y-full",enterTo:"translate-y-0",leave:"transition ease-in-out duration-300 transform",leaveFrom:"translate-y-0",leaveTo:"translate-y-full",children:e.jsxs(P,{className:"w-full max-w-md rounded-t-xl bg-brand-neutral-dark border-t border-brand-depth p-6 shadow-xl relative",children:[e.jsxs("div",{className:"flex justify-between items-center mb-4",children:[e.jsx(T,{className:"text-lg font-bold text-brand-neutral-light",children:"Edytuj wpis"}),e.jsx("button",{onClick:s,className:`flex items-center justify-center text-brand-neutral-light/60 hover:text-brand-neutral-light \r
                      hover:bg-brand-neutral-light/10 rounded-full p-1 transition-colors cursor-pointer`,children:e.jsx(S,{})})]}),e.jsxs("form",{onSubmit:j,className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-brand-neutral-light/80 mb-1",children:"Nazwa"}),e.jsx("input",{type:"text",value:i,onChange:b=>l(b.target.value),className:`w-full rounded-md border border-brand-depth bg-brand-neutral-dark px-3 py-2 \r
                             text-brand-neutral-light focus:outline-none focus:ring-2 focus:ring-brand-accent-1/40\r
                             transition-all duration-300`,required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-brand-neutral-light/80 mb-1",children:"Ilość (g)"}),e.jsx("input",{type:"number",value:g,onChange:b=>{const N=Number(b.target.value),p=new RegExp(`\\((${g}|${n.grams})\\s*g\\)|(${g}|${n.grams})\\s*g`,"i");if(p.test(i)&&l(i.replace(p,k=>k.replace(/\d+/,N.toString()))),y(N),n.grams>0){const k=N/n.grams;c(Math.round(n.kcal*k)),u(Math.round(n.protein*k*10)/10),t(Math.round(n.fat*k*10)/10),f(Math.round(n.carbs*k*10)/10)}},className:`w-full rounded-md border border-brand-depth bg-brand-neutral-dark px-3 py-2 \r
                             text-brand-neutral-light focus:outline-none focus:ring-2 focus:ring-brand-accent-1/40\r
                             transition-all duration-300`,required:!0})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-brand-neutral-light/80 mb-1",children:"Kcal"}),e.jsx("input",{type:"number",value:d,onChange:b=>c(Number(b.target.value)),className:`w-full rounded-md border border-brand-depth bg-brand-neutral-dark px-3 py-2 \r
                               text-brand-neutral-light focus:outline-none focus:ring-2 focus:ring-brand-accent-1/40\r
                               transition-all duration-300`})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-brand-neutral-light/80 mb-1",children:"Białko (g)"}),e.jsx("input",{type:"number",value:x,onChange:b=>u(Number(b.target.value)),className:`w-full rounded-md border border-brand-depth bg-brand-neutral-dark px-3 py-2 \r
                               text-brand-neutral-light focus:outline-none focus:ring-2 focus:ring-brand-accent-1/40\r
                               transition-all duration-300`})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-brand-neutral-light/80 mb-1",children:"Tłuszcz (g)"}),e.jsx("input",{type:"number",value:m,onChange:b=>t(Number(b.target.value)),className:`w-full rounded-md border border-brand-depth bg-brand-neutral-dark px-3 py-2 \r
                               text-brand-neutral-light focus:outline-none focus:ring-2 focus:ring-brand-accent-1/40\r
                               transition-all duration-300`})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-brand-neutral-light/80 mb-1",children:"Węgle (g)"}),e.jsx("input",{type:"number",value:h,onChange:b=>f(Number(b.target.value)),className:`w-full rounded-md border border-brand-depth bg-brand-neutral-dark px-3 py-2 \r
                               text-brand-neutral-light focus:outline-none focus:ring-2 focus:ring-brand-accent-1/40\r
                               transition-all duration-300`})]})]}),e.jsx("div",{className:"pt-2",children:e.jsx("button",{type:"submit",className:"w-full py-2 bg-brand-accent-2 rounded-xl text-brand-neutral-light font-bold hover:bg-brand-accent-2/70 transition-all cursor-pointer",children:"Zapisz"})})]})]})})})]})})};function X({protein:a,fat:s,carbs:n}){const r=a*4,i=s*9,l=n*4,d=Math.max(1e-6,r+i+l),c=r/d*100,x=i/d*100,u=l/d*100;return e.jsxs("div",{className:"h-2 w-full rounded-full bg-brand-neutral-dark overflow-hidden flex",children:[e.jsx("div",{className:"h-full bg-brand-primary",style:{width:`${c}%`},title:`Białko ${a.toFixed(1)}g`}),e.jsx("div",{className:"h-full bg-brand-accent-1",style:{width:`${x}%`},title:`Tłuszcz ${s.toFixed(1)}g`}),e.jsx("div",{className:"h-full bg-brand-accent-2",style:{width:`${u}%`},title:`Węglowodany ${n.toFixed(1)}g`})]})}const Y=({entry:a,removeEntry:s,onEdit:n})=>{const[r,i]=o.useState(!1),[l,d]=o.useState(!1);return e.jsxs(e.Fragment,{children:[e.jsxs(v.li,{layout:!0,initial:{opacity:0,y:-10},animate:{opacity:1,y:0},exit:{opacity:0,x:-20},transition:{duration:.2},className:`group relative flex flex-col gap-2 p-4 bg-brand-neutral-dark/30 hover:bg-brand-neutral-dark/50 rounded-xl \r
                  border border-transparent hover:border-brand-primary/10 transition-all duration-300`,children:[e.jsxs("div",{className:"flex justify-between items-start w-full",children:[e.jsx("div",{className:"flex-1 pr-4",children:e.jsx("h3",{className:"font-medium text-brand-neutral-light text-base leading-snug",children:a.name})}),e.jsx("div",{className:"flex flex-col items-end shrink-0",children:e.jsxs("span",{className:"font-bold text-lg text-brand-accent-3 tabular-nums",children:[Math.round(a.kcal)," kcal"]})})]}),e.jsx("div",{children:e.jsx(X,{protein:a.protein,fat:a.fat,carbs:a.carbs})}),e.jsxs("div",{className:"flex items-center justify-between mt-1",children:[e.jsxs("div",{className:"flex items-center gap-4 text-xs font-medium text-brand-secondary",children:[e.jsxs("div",{className:"flex items-center gap-1.5",title:"Białko",children:[e.jsx("div",{className:"w-2 h-2 rounded-full bg-brand-primary shadow-[0_0_8px_rgba(var(--brand-primary),0.5)]"}),e.jsxs("span",{className:"text-brand-neutral-light/80",children:["B: ",a.protein.toFixed(1),"g"]})]}),e.jsxs("div",{className:"flex items-center gap-1.5",title:"Tłuszcz",children:[e.jsx("div",{className:"w-2 h-2 rounded-full bg-brand-accent-1 shadow-[0_0_8px_rgba(var(--brand-accent-1),0.5)]"}),e.jsxs("span",{className:"text-brand-neutral-light/80",children:["T: ",a.fat.toFixed(1),"g"]})]}),e.jsxs("div",{className:"flex items-center gap-1.5",title:"Węglowodany",children:[e.jsx("div",{className:"w-2 h-2 rounded-full bg-brand-accent-2 shadow-[0_0_8px_rgba(var(--brand-accent-2),0.5)]"}),e.jsxs("span",{className:"text-brand-neutral-light/80",children:["W: ",a.carbs.toFixed(1),"g"]})]})]}),e.jsxs("div",{className:"sm:flex items-center gap-1 sm:opacity-0 sm:group-hover:opacity-100 transition-opacity duration-200",children:[e.jsx("button",{onClick:()=>d(!0),className:"flex items-center p-1.5 rounded-full text-brand-secondary hover:bg-brand-accent-2/70 transition-colors cursor-pointer",title:"Edytuj",children:e.jsx(E,{className:""})}),e.jsx("button",{onClick:()=>i(!0),className:"flex items-center p-1.5 rounded-full text-brand-secondary hover:text-red-400 hover:bg-red-400/10 transition-colors cursor-pointer",title:"Usuń",children:e.jsx(G,{className:""})})]})]})]}),e.jsx(L,{isOpen:r,onClose:()=>i(!1),onConfirm:()=>s(a.id),description:e.jsxs("p",{children:["Czy na pewno chcesz usunąć"," ",e.jsx("strong",{className:"text-brand-neutral-light",children:a.name}),"? Tej akcji nie można cofnąć."]})}),e.jsx(V,{isOpen:l,onClose:()=>d(!1),entry:a,onSave:n})]})},H=({entries:a,removeEntry:s,isLoading:n,onEdit:r})=>e.jsxs("div",{className:"flex flex-col flex-1 min-h-0",children:[e.jsx("div",{className:"flex items-end lg:justify-end",children:e.jsx("h2",{className:"glass-header text-lg rounded-t-xl py-2 px-4",children:"Historia posiłków"})}),e.jsx(v.section,{layout:!0,className:"glass-panel rounded-b-2xl rounded-tr-2xl lg:rounded-tr-none lg:rounded-tl-2xl p-4 flex-1 min-h-0 overflow-y-auto",children:e.jsx("div",{className:"h-full flex flex-col",children:n?e.jsx(v.div,{animate:{rotate:360},transition:{repeat:1/0,duration:1.3,ease:"linear"},className:"w-5 h-5 border-2 border-white/30 border-t-white rounded-full"}):a.length===0?e.jsx("p",{className:"mt-4 text-brand-secondary",children:"Nic dziś jeszcze nie dodano. Dodaj pierwszy produkt na panelu obok."}):e.jsx("ul",{className:"space-y-2 pb-4",children:e.jsx(C,{children:a.map(i=>e.jsx(Y,{entry:i,removeEntry:s,onEdit:r},i.id))})})})})]}),D=({isOpen:a,onClose:s,onSubmit:n,foodHit:r,onGramsChange:i})=>{const[l,d]=o.useState(1),[c,x]=o.useState("grams");o.useEffect(()=>{a&&r&&(r.servingSize?(x("serving"),d(1),i(r.servingSize)):(x("grams"),d(100),i(100)))},[a,r?.id]);const u=t=>{d(t),c==="serving"&&r?.servingSize?i(t*r.servingSize):i(t)},m=()=>{c==="grams"&&r?.servingSize?(x("serving"),d(1),i(r.servingSize)):(x("grams"),d(100),i(100))};return e.jsx(M,{show:a,as:o.Fragment,children:e.jsxs(I,{as:"div",className:"relative z-40",onClose:s,children:[e.jsx(w,{as:o.Fragment,enter:"transition-opacity ease-linear duration-300",enterFrom:"opacity-0",enterTo:"opacity-100",leave:"transition-opacity ease-linear duration-300",leaveFrom:"opacity-100",leaveTo:"opacity-0",children:e.jsx("div",{className:"fixed inset-0 bg-brand-neutral-dark/80"})}),e.jsx("div",{className:"fixed inset-0 flex items-end justify-center",children:e.jsx(w,{as:o.Fragment,enter:"transition ease-in-out duration-300 transform",enterFrom:"translate-y-full",enterTo:"translate-y-0",leave:"transition ease-in-out duration-300 transform",leaveFrom:"translate-y-0",leaveTo:"translate-y-full",children:e.jsx(P,{className:`w-full max-w-md transform overflow-hidden rounded-t-xl bg-brand-neutral-dark p-6 text-left \r
                          align-middle shadow-xl transition-all border-t border-brand-depth`,children:r&&e.jsxs(e.Fragment,{children:[e.jsx(T,{as:"h3",className:"text-lg font-medium leading-6 text-brand-neutral-light",children:"Dodaj produkt"}),e.jsxs("form",{onSubmit:n,className:"mt-4",children:[e.jsxs("div",{className:"rounded-lg border border-brand-depth p-3",children:[e.jsx("p",{className:"text-brand-neutral-light truncate",children:r.name}),e.jsxs("p",{className:"text-sm text-brand-secondary",children:[r.brand??"—"," • ",r.kcalPer100g," kcal / 100g"]})]}),e.jsxs("div",{className:"mt-4",children:[e.jsxs("div",{className:"flex justify-between items-center mb-2",children:[e.jsxs("label",{htmlFor:"amount",className:"block text-sm font-medium text-brand-secondary",children:["Ilość"," ",c==="serving"?`(${r.servingUnit||"porcji"})`:"(g)"]}),r.servingSize&&e.jsx("button",{type:"button",onClick:m,className:"text-xs text-brand-accent-1 hover:underline hover:cursor-pointer",children:c==="grams"?"Przełącz na porcje":"Przełącz na gramy"})]}),e.jsx("input",{id:"amount",type:"number",min:1,step:c==="serving"?.5:1,className:`mt-1 w-full rounded-md border border-brand-depth bg-brand-neutral-dark px-3 py-2 \r
                                text-brand-neutral-light focus:outline-none focus:ring-2 focus:ring-brand-accent-1/40\r
                                transition-focus duration-300`,value:l,onChange:t=>u(Number(t.target.value))}),c==="serving"&&r.servingSize&&e.jsxs("p",{className:"text-xs text-brand-secondary mt-1 text-left",children:[l," x ",r.servingSize,"g ="," ",Math.round(l*r.servingSize),"g"]})]}),e.jsxs("div",{className:"mt-6 flex gap-3",children:[e.jsx("button",{type:"button",className:`flex-1 justify-center rounded-md border border-brand-secondary px-4 py-2 text-sm font-medium \r
                                text-brand-secondary hover:bg-brand-secondary/10 focus:outline-none focus-visible:ring-2 focus-visible:ring-brand-accent-1/40`,onClick:s,children:"Anuluj"}),e.jsx("button",{type:"submit",disabled:r.grams<=0,className:`flex-1 justify-center rounded-md bg-brand-accent-1 px-4 py-2 text-sm font-semibold \r
                                text-brand-neutral-dark hover:bg-brand-accent-1/80 focus:outline-none focus-visible:ring-2 focus-visible:ring-brand-accent-1/40 disabled:bg-brand-secondary`,children:"Dodaj"})]})]})]})})})})]})})},ee=({query:a,loading:s,error:n,localHits:r,addEntryFromFood:i})=>{const[l,d]=o.useState(null),c=t=>d({...t,grams:t.grams>0?t.grams:100}),x=()=>{d(null)},u=t=>{t.preventDefault(),l&&l.grams>0&&(i(l,l.grams),x())},m=t=>{l&&d({...l,grams:t})};return e.jsxs(e.Fragment,{children:[e.jsxs(v.div,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},exit:{opacity:0,y:-10},transition:{duration:.2},className:"h-full flex flex-col",children:[e.jsx(C,{children:r.length>0&&e.jsx(v.ul,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:"divide-y divide-white/10 border-b border-brand-depth/40 flex-1 overflow-y-auto min-h-0 max-h-[calc(100vh-15rem)] custom-scrollbar",children:r.map(t=>t.kcalPer100g!=null&&e.jsxs(v.li,{layout:!0,initial:{opacity:0,y:-10},animate:{opacity:1,y:0},exit:{opacity:0,x:-20},transition:{duration:.2},onClick:()=>c(t),className:"group p-3 flex items-center gap-3 hover:bg-brand-depth/20 transition cursor-pointer",children:[t.imageUrl&&e.jsx("img",{src:t.imageUrl,alt:t.name,className:"h-10 w-10 rounded object-cover"}),e.jsxs("div",{className:"min-w-0 flex-1",children:[e.jsxs("p",{className:"text-brand-neutral-light",children:[t.brand&&e.jsxs("span",{children:[e.jsx("span",{className:"text-brand-secondary",children:t.brand}),e.jsx("span",{className:"text-brand-neutral-light mx-1",children:"•"})]}),t.name]}),e.jsxs("p",{className:"text-sm text-brand-secondary",children:[t.kcalPer100g?`${t.kcalPer100g} kcal / 100g`:"brak danych"," ",t.proteinPer100g!=null&&`| ${t.proteinPer100g}g białka`," ",t.fatPer100g!=null&&`| ${t.fatPer100g}g tłuszczu`," ",t.carbsPer100g!=null&&`| ${t.carbsPer100g}g węglowodanów`]})]})]},t.listId))})}),r.length===0&&s===!1&&a!==""&&n===null&&e.jsx("p",{className:"m-2 text-brand-secondary",children:"Brak wyników"}),s&&e.jsx("p",{className:"m-2 text-brand-secondary",children:"Szukam w internecie..."}),n&&e.jsxs("p",{className:"m-2 text-brand-warning",children:["Błąd: ",n]})]},"search"),e.jsx(D,{isOpen:l!==null,onClose:x,onSubmit:u,foodHit:l,onGramsChange:m})]})},ae=({customEntry:a,handleCustomEntryChange:s,handleCustomEntrySubmit:n})=>{const[r,i]=o.useState("grams"),[l,d]=o.useState(!1),[c,x]=o.useState(""),[u,m]=o.useState(0),[t,h]=o.useState(100);o.useEffect(()=>{if(r==="grams")s({target:{name:"grams",value:t.toString()}});else{const g=t*u;s({target:{name:"grams",value:g.toString()}})}},[r,t,u]);const f=g=>{g.preventDefault(),n(g,l?{servingName:c,servingWeight:u}:void 0)};return e.jsx(v.div,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},exit:{opacity:0,y:-10},transition:{duration:.2},className:"overflow-y-auto",children:e.jsxs("form",{onSubmit:f,className:"p-4 bg-brand-neutral-dark/50 rounded-b-xl",children:[e.jsxs("div",{className:"flex gap-2 mb-4 p-1 bg-brand-neutral-dark rounded-lg border border-brand-depth",children:[e.jsx("button",{type:"button",onClick:()=>i("grams"),className:`flex-1 py-1 px-3 rounded-md text-sm font-medium transition-colors ${r==="grams"?"bg-brand-accent-1 text-brand-neutral-dark":"text-brand-secondary hover:text-brand-neutral-light hover:cursor-pointer"}`,children:"Na 100g"}),e.jsx("button",{type:"button",onClick:()=>i("serving"),className:`flex-1 py-1 px-3 rounded-md text-sm font-medium transition-colors ${r==="serving"?"bg-brand-accent-1 text-brand-neutral-dark":"text-brand-secondary hover:text-brand-neutral-light hover:cursor-pointer"}`,children:"Na porcję"})]}),e.jsxs("div",{className:"grid gap-3 sm:grid-cols-2",children:[e.jsx("input",{name:"name",className:`rounded-md border border-brand-depth bg-brand-neutral-dark px-3 py-2 text-brand-neutral-light \r
                    placeholder-brand-secondary focus:outline-none focus:ring-2 focus:ring-brand-accent-1/40 sm:col-span-2\r
                      transition-outline duration-300`,placeholder:"Nazwa produktu*",value:a.name,onChange:s,required:!0}),r==="serving"&&e.jsxs("div",{className:"sm:col-span-2 grid grid-cols-2 gap-3 p-3 rounded-lg border border-brand-depth/50 bg-brand-neutral-dark/30",children:[e.jsxs("label",{className:"flex flex-col text-sm text-brand-neutral-light",children:["Nazwa porcji*",e.jsx("input",{type:"text",placeholder:"porcja",className:`mt-1 rounded-md border border-brand-depth bg-brand-neutral-dark px-2 py-1 text-brand-neutral-light focus:ring-2 \r
                          focus:ring-brand-accent-1/40 focus:outline-none transition-outline duration-300`,value:c,onChange:g=>x(g.target.value),required:!0})]}),e.jsxs("label",{className:"flex flex-col text-sm text-brand-neutral-light",children:["Waga porcji (g)*",e.jsx("input",{type:"number",min:1,className:`mt-1 rounded-md border border-brand-depth bg-brand-neutral-dark px-2 py-1 text-brand-neutral-light focus:ring-2 \r
                          focus:ring-brand-accent-1/40 focus:outline-none transition-outline duration-300`,value:u||"100",onChange:g=>m(Number(g.target.value)),required:!0})]})]}),e.jsxs("div",{className:"sm:col-span-2",children:[e.jsxs("label",{className:"flex flex-col text-sm text-brand-neutral-light",children:[r==="grams"?"Ilość (g)":`Ilość (${c||"porcji"})`,e.jsx("input",{type:"number",min:0,step:r==="serving"?.5:1,className:`mt-1 w-full rounded-md border border-brand-depth bg-brand-neutral-dark px-3 py-2 text-brand-neutral-light focus:ring-2 \r
                        focus:ring-brand-accent-1/40 focus:outline-none transition-outline duration-300`,value:t,onChange:g=>h(Number(g.target.value))})]}),r==="serving"&&u>0&&e.jsxs("p",{className:"text-xs text-brand-secondary mt-1 text-left",children:[t," x ",u,"g = ",t*u,"g"]})]}),e.jsxs("div",{className:"",children:[e.jsxs("label",{className:"flex flex-col text-sm text-brand-neutral-light",children:["Węglowodany (na 100g)",e.jsx("input",{name:"carbs",type:"number",min:0,className:`mt-1 rounded-md border border-brand-depth bg-brand-neutral-dark px-2 py-1 text-brand-neutral-light focus:ring-2 \r
                        focus:ring-brand-accent-1/40 focus:outline-none transition-outline duration-300`,value:a.carbs,onChange:s})]}),e.jsxs("label",{className:"flex flex-col text-sm text-brand-neutral-light",children:["Białko (na 100g)",e.jsx("input",{name:"protein",type:"number",min:0,className:`mt-1 rounded-md border border-brand-depth bg-brand-neutral-dark px-2 py-1 text-brand-neutral-light focus:ring-2 \r
                        focus:ring-brand-accent-1/40 focus:outline-none transition-outline duration-300`,value:a.protein,onChange:s})]}),e.jsxs("label",{className:"flex flex-col text-sm text-brand-neutral-light",children:["Tłuszcz (na 100g)",e.jsx("input",{name:"fat",type:"number",min:0,className:`mt-1 rounded-md border border-brand-depth bg-brand-neutral-dark px-2 py-1 text-brand-neutral-light focus:ring-2 \r
                        focus:ring-brand-accent-1/40 focus:outline-none transition-outline duration-300`,value:a.fat,onChange:s})]})]}),e.jsx("div",{className:"",children:e.jsxs("label",{className:"flex flex-col text-sm text-brand-neutral-light",children:["Kalorie (na 100g)",e.jsx("input",{name:"kcal",type:"number",min:0,className:`mt-1 rounded-md border border-brand-depth bg-brand-neutral-dark px-2 py-1 text-brand-neutral-light focus:ring-2 \r
                        focus:ring-brand-accent-1/40 focus:outline-none transition-outline duration-300`,value:a.kcal,onChange:s})]})})]}),e.jsxs("div",{className:"mt-4 flex items-center gap-2",children:[e.jsx("input",{type:"checkbox",id:"saveToMyFoods",checked:l,onChange:g=>d(g.target.checked),className:"rounded border-brand-depth bg-brand-neutral-dark text-brand-accent-1 focus:ring-brand-accent-1/40"}),e.jsx("label",{htmlFor:"saveToMyFoods",className:"text-sm text-brand-neutral-light select-none cursor-pointer",children:"Zapisz do moich produktów"})]}),e.jsx("div",{className:"mt-4",children:e.jsx("button",{type:"submit",className:`w-full rounded-md bg-brand-accent-1 px-4 py-2 font-semibold text-brand-neutral-dark hover:bg-brand-accent-1/80 \r
                      transition duration-300 cursor-pointer`,children:"Dodaj"})})]})},"custom")};function te(a){const[s,n]=o.useState(!1),[r,i]=o.useState([]),[l,d]=o.useState(null);return o.useEffect(()=>{let c=!1;async function x(){if(!a){i([]),d(null);return}n(!0),d(null);try{const u="https://uknexpaqqpakwbwpbhpz.supabase.co/functions",m=new URL(`${u}/v1/get-food-by-barcode`);m.searchParams.set("barcode",a);const t=await fetch(m.toString());if(!t.ok){const f=await t.json();throw new Error(f.error||`HTTP ${t.status}`)}const h=await t.json();c||i(h.items??[])}catch(u){c||d(u.message)}finally{c||n(!1)}}return x(),()=>{c=!0}},[a]),{loading:s,hits:r,error:l,setHits:i}}const re=({addEntryFromFood:a})=>{const[s,n]=o.useState(""),[r,i]=o.useState(""),[l,d]=o.useState(null),[c,x]=o.useState(!1),{loading:u,hits:m,error:t,setHits:h}=te(r),[f,g]=o.useState(null);o.useEffect(()=>{if(t){g(t),d(null);return}if(m.length>0){const p=m[0];p.kcalPer100g!=null?(d({...p,id:p.sourceId||"result",listId:"scanner",grams:100}),x(!0),g(null)):(d(null),g(`"${p.name}" nie zawiera danych o kaloriach.`))}else d(null),r&&!u&&g("Nie znaleziono produktu o podanym kodzie.")},[m,t,r,u]);const y=()=>{i(""),n(""),d(null),h([]),x(!1),g(null)},j=p=>{p.preventDefault(),g(null),s&&i(s)},b=p=>{p.preventDefault(),l&&l.grams>0&&(a(l,l.grams),y())},N=p=>{l&&d({...l,grams:p})};return e.jsxs(e.Fragment,{children:[e.jsxs(v.div,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},exit:{opacity:0,y:-10},transition:{duration:.2},className:"pt-4 px-4 bg-brand-neutral-dark/50 rounded-xl rounded-tl-none",children:[u?e.jsx("p",{className:"text-center text-brand-secondary",children:"Szukam..."}):e.jsxs("form",{onSubmit:j,children:[e.jsx("input",{type:"text",placeholder:"Wpisz numer kodu kreskowego...",value:s,onChange:p=>n(p.target.value),className:`mt-1 w-full rounded-md border border-brand-depth bg-brand-neutral-dark px-3 py-2 text-brand-neutral-light \r
                         placeholder-brand-secondary focus:ring-2 focus:ring-brand-accent-1/40 focus:outline-none`}),e.jsx("button",{type:"submit",className:`mt-3 w-full rounded-md bg-brand-primary px-4 py-2 font-semibold text-brand-neutral-light\r
                         hover:bg-brand-primary/80 transition duration-300 cursor-pointer disabled:opacity-50 disabled:hover:cursor-not-allowed\r
                         disabled:hover:bg-brand-primary`,disabled:!s||u,children:"Szukaj ręcznie"})]}),f&&e.jsx("p",{className:"mt-4 text-center text-brand-warning font-semibold T",children:f}),e.jsx("div",{className:"h-4"})]},"scan"),e.jsx(D,{isOpen:c,onClose:y,onSubmit:b,foodHit:l,onGramsChange:N})]})};function ne({onClose:a,customEntry:s,handleCustomEntryChange:n,handleCustomEntrySubmit:r}){return e.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center p-4 bg-brand-neutral-dark/60",children:e.jsxs(v.div,{initial:{opacity:0,scale:.95},animate:{opacity:1,scale:1},exit:{opacity:0,scale:.95},className:"bg-brand-neutral-dark border border-brand-depth w-full max-w-lg rounded-2xl shadow-2xl flex flex-col max-h-[90vh] overflow-hidden",children:[e.jsxs("div",{className:"flex justify-between items-center p-4 border-b border-brand-depth bg-brand-neutral-dark/50 rounded-t-2xl",children:[e.jsx("h2",{className:"text-xl font-bold text-brand-neutral-light",children:"Dodaj własny produkt"}),e.jsx("button",{onClick:a,className:"p-1 cursor-pointer hover:bg-brand-depth rounded-full transition-colors hover:text-brand-neutral-dark text-brand-neutral-light flex items-center justify-center",children:e.jsx(S,{})})]}),e.jsx("div",{className:"flex-1 overflow-y-hidden",children:e.jsx(ae,{customEntry:s,handleCustomEntryChange:n,handleCustomEntrySubmit:(i,l)=>{r(i,l),a()}})})]})})}function se({onClose:a,addEntryFromFood:s}){return e.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center p-4 bg-brand-neutral-dark/60",children:e.jsxs(v.div,{initial:{opacity:0,scale:.95},animate:{opacity:1,scale:1},exit:{opacity:0,scale:.95},className:"bg-brand-neutral-dark border border-brand-depth w-full max-w-md rounded-2xl shadow-2xl flex flex-col",children:[e.jsxs("div",{className:"flex justify-between items-center p-4 border-b border-brand-depth bg-brand-neutral-dark/50 rounded-t-2xl",children:[e.jsx("h2",{className:"text-xl font-bold text-brand-neutral-light",children:"Skanuj kod kreskowy"}),e.jsx("button",{onClick:a,className:"p-1 cursor-pointer hover:bg-brand-depth rounded-full transition-colors hover:text-brand-neutral-dark text-brand-neutral-light flex items-center justify-center",children:e.jsx(S,{})})]}),e.jsx("div",{className:"p-2",children:e.jsx(re,{addEntryFromFood:s})})]})})}function le(a){const[s,n]=o.useState(!1),[r,i]=o.useState([]),[l,d]=o.useState(null);return o.useEffect(()=>{let c=!1;async function x(){if(!a||a.length<2){i([]);return}n(!0),d(null);try{const{data:m,error:t}=await O.from("foods").select("*").ilike("name",`%${a}%`).limit(15);if(t)throw t;const h=(m||[]).map(b=>({id:b.id,name:b.name,brand:b.brand,kcalPer100g:b.kcal_per_100g,proteinPer100g:b.protein_g_per_100g,fatPer100g:b.fat_g_per_100g,carbsPer100g:b.carbs_g_per_100g,imageUrl:b.image_url,sourceId:b.source_id,servingSize:b.serving_size_g,servingUnit:b.serving_unit}));c||i(h);const f="https://uknexpaqqpakwbwpbhpz.supabase.co/functions",g=new URL(`${f}/v1/search-food`);g.searchParams.set("q",a);const y=await fetch(g);let j=[];if(y.ok?j=(await y.json()).items??[]:console.warn("OFF search failed",y.status),!c){const b=new Set(h.map(p=>p.sourceId).filter(Boolean)),N=j.filter(p=>!p.sourceId||!b.has(p.sourceId));i([...h,...N])}}catch(m){c||d(m.message)}finally{c||n(!1)}}const u=setTimeout(x,333);return()=>{c=!0,clearTimeout(u)}},[a]),{loading:s,hits:r,error:l}}function ie(a,s){const[n,r]=o.useState(a);function i(d){const{name:c,value:x}=d.target;r(u=>({...u,[c]:c==="name"?x:Number(x)}))}async function l(d,c){d.preventDefault(),await s(n,c)&&r({name:"",kcal:0,grams:100,protein:0,fat:0,carbs:0})}return{customEntry:n,handleCustomEntryChange:i,handleCustomEntrySubmit:l}}function de({addEntryFromFood:a,addCustomEntry:s}){const[n,r]=o.useState(!1),[i,l]=o.useState(!1),[d,c]=o.useState(""),{loading:x,hits:u,error:m}=le(d),t=o.useMemo(()=>u.map(b=>({...b,listId:(b.sourceId??"")+b.name+(b.id??""),grams:100})),[u]),[h,f]=o.useState(t);o.useEffect(()=>{f(t)},[t]);const{customEntry:g,handleCustomEntryChange:y,handleCustomEntrySubmit:j}=ie({name:"",kcal:0,grams:100,protein:0,fat:0,carbs:0},s);return e.jsxs("div",{className:"flex-1 flex flex-col min-h-0",children:[e.jsxs("div",{className:"flex flex-col h-full bg-brand-neutral-dark/10 rounded-xl overflow-hidden border border-brand-depth/50",children:[e.jsxs("div",{className:"p-3 border-b border-brand-depth bg-brand-neutral-dark relative flex gap-2",children:[e.jsxs("div",{className:"relative flex-1",children:[e.jsx(W,{className:"absolute left-3 top-1/2 -translate-y-1/2 text-brand-neutral-light/50"}),e.jsx("input",{type:"text",placeholder:"Szukaj produktu...",value:d,onChange:b=>c(b.target.value),className:`w-full pl-10 pr-4 py-3 rounded-lg bg-brand-depth/30 border border-brand-depth/50 text-brand-neutral-light \r
                        placeholder-brand-neutral-light/30 focus:outline-none focus:ring-1 focus:ring-brand-accent-1 focus:border-brand-accent-1 \r
                        transition-all`})]}),e.jsx("button",{onClick:()=>r(!0),className:"bg-brand-accent-1 hover:bg-brand-accent-2 text-white p-3 rounded-lg transition-colors shadow-lg cursor-pointer flex items-center justify-center",title:"Dodaj własny produkt",children:e.jsx("span",{className:"flex justify-center items-center",children:"+"})}),e.jsx("button",{onClick:()=>l(!0),className:`bg-brand-neutral-light/90 hover:bg-brand-accent-3 border border-brand-depth \r
                    text-brand-neutral-dark p-3 rounded-lg transition-colors \r
                      shadow-sm cursor-pointer flex items-center justify-center`,title:"Skanuj kod kreskowy",children:e.jsx(A,{})})]}),e.jsx("div",{className:"flex-1 overflow-hidden relative bg-brand-neutral-dark/40",children:e.jsx(ee,{query:d,loading:x,error:m,localHits:h,addEntryFromFood:a})})]}),e.jsxs(C,{children:[n&&e.jsx(ne,{onClose:()=>r(!1),customEntry:g,handleCustomEntryChange:y,handleCustomEntrySubmit:(b,N)=>{j(b,N),r(!1)}}),i&&e.jsx(se,{onClose:()=>l(!1),addEntryFromFood:a})]})]})}function xe(){const{user:a}=U(),[s,n]=o.useState(new Date),{entries:r,isLoading:i,goals:l,totalCalories:d,addEntryFromFood:c,addCustomEntry:x,removeEntry:u,editEntry:m,updateGoal:t}=K(a,s),h=j=>t("calories",j),f=j=>t("protein",j),g=j=>t("fat",j),y=j=>t("carbs",j);return e.jsxs(v.div,{initial:{opacity:0},animate:{opacity:1},transition:{duration:.5},className:"py-6 lg:p-8 mx-auto space-y-3 lg:h-[calc(100vh)] flex flex-col",children:[e.jsx("div",{className:"flex flex-col sm:flex-row items-center justify-between gap-3",children:e.jsx(R,{selectedDate:s,onDateChange:n,format:"day"})}),e.jsx(J,{goalCalories:l.calories,totalCalories:d,goalProtein:l.protein,goalFat:l.fat,goalCarbs:l.carbs,setGoalCalories:h,setGoalProtein:f,setGoalFat:g,setGoalCarbs:y,isLoading:i}),e.jsxs("div",{className:"flex-1 grid grid-cols-1 lg:grid-cols-2 gap-8 min-h-0",children:[e.jsx(H,{entries:r,removeEntry:u,isLoading:i,onEdit:m}),e.jsx(de,{addEntryFromFood:c,addCustomEntry:x})]})]})}export{xe as default};
