import{j as e,m as y,g as W,h as A,i as U,r as o,k as z,l as M,K as P,n as T,O as C,z as D,Q as $,o as q,a as B,s as E,S as R,p as K}from"./index-DVEhPOJy.js";import{C as L,L as F,u as Q}from"./LinearMacroProgress-CFyWf68q.js";import{A as _,C as Z}from"./ConfirmDeleteDialog-Ck78dyFH.js";import{D as J}from"./DateSelector-BliOKbC7.js";function V({isLoading:t,goalCalories:n,goalProtein:r,goalFat:a,goalCarbs:l,setGoalCalories:i,setGoalProtein:s,setGoalFat:c,setGoalCarbs:p,onClose:u}){return e.jsxs(y.div,{initial:{opacity:0,scale:.95},animate:{opacity:1,scale:1},exit:{opacity:0,scale:.95},transition:{duration:.2},className:"flex flex-col gap-4 sm:gap-2",children:[e.jsx("h3",{className:"text-lg font-semibold text-brand-neutral-light",children:"Edytuj cele"}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-2",children:[e.jsxs("label",{className:"flex flex-col gap-1",children:[e.jsx("span",{className:"text-sm text-brand-secondary",children:"Cel kalorii (kcal)"}),e.jsx("input",{type:"number",min:1,disabled:t,className:`rounded-xl border border-brand-depth bg-brand-neutral-dark px-4 py-3 text-brand-neutral-light focus:ring-2 \r
                    focus:ring-brand-accent-1/40 focus:outline-none disabled:opacity-50`,value:n,onChange:x=>{const d=Number(x.target.value);i(d>0?d:0)}})]}),e.jsxs("label",{className:"flex flex-col gap-1",children:[e.jsx("span",{className:"text-sm text-brand-secondary",children:"Białko (g)"}),e.jsx("input",{type:"number",min:0,disabled:t,className:`rounded-xl border border-brand-depth bg-brand-neutral-dark px-4 py-3 text-brand-neutral-light focus:ring-2 \r
                    focus:ring-brand-accent-1/40 focus:outline-none disabled:opacity-50`,value:r,onChange:x=>s(Number(x.target.value)||0)})]}),e.jsxs("label",{className:"flex flex-col gap-1",children:[e.jsx("span",{className:"text-sm text-brand-secondary",children:"Tłuszcz (g)"}),e.jsx("input",{type:"number",min:0,disabled:t,className:`rounded-xl border border-brand-depth bg-brand-neutral-dark px-4 py-3 text-brand-neutral-light focus:ring-2 \r
                    focus:ring-brand-accent-1/40 focus:outline-none disabled:opacity-50`,value:a,onChange:x=>c(Number(x.target.value)||0)})]}),e.jsxs("label",{className:"flex flex-col gap-1",children:[e.jsx("span",{className:"text-sm text-brand-secondary",children:"Węglowodany (g)"}),e.jsx("input",{type:"number",min:0,disabled:t,className:`rounded-xl border border-brand-depth bg-brand-neutral-dark px-4 py-3 text-brand-neutral-light focus:ring-2 \r
                    focus:ring-brand-accent-1/40 focus:outline-none disabled:opacity-50`,value:l,onChange:x=>p(Number(x.target.value)||0)})]})]}),e.jsx("div",{className:"flex justify-end sm:mt-3",children:e.jsxs("button",{onClick:u,className:"flex items-center gap-2 px-6 py-2 bg-brand-accent-1 text-white rounded-full hover:bg-brand-accent-1/90 transition-colors cursor-pointer",children:[e.jsx(W,{})," Gotowe"]})})]},"edit-form")}function I({label:t,value:n,unit:r,icon:a,type:l}){let i="text-brand-neutral-light",s="bg-brand-neutral-dark";return l==="positive"&&(i="text-brand-positive-lighter"),l==="negative"&&(i="text-brand-negative"),e.jsxs(y.div,{initial:{opacity:0,x:-20},animate:{opacity:1,x:0},transition:{delay:.1},className:`${s} p-4 border border-brand-depth rounded-xl w-full`,children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsx("div",{className:"text-brand-secondary/70 transform scale-83",children:a}),e.jsx("p",{className:"text-xs text-brand-neutral-light/70 uppercase tracking-wide",children:t})]}),e.jsxs("p",{className:`text-2xl font-bold ${i}`,children:[n.toFixed(0),e.jsx("span",{className:"text-lg font-normal text-brand-secondary ml-1",children:r})]})]})}function X({goalCalories:t,totalCalories:n,goalProtein:r,goalFat:a,goalCarbs:l}){return e.jsxs(y.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},transition:{duration:.2},className:"grid grid-cols-1 lg:grid-cols-3 gap-6 lg:gap-0",children:[e.jsxs("div",{className:"flex flex-col gap-4 order-2 lg:order-1 justify-center",children:[e.jsx(I,{label:"Cel dzienny",value:t,unit:"kcal",icon:e.jsx(A,{}),type:"neutral"}),e.jsx(I,{label:"Spożyto",value:n.kcal,unit:"kcal",icon:e.jsx(U,{}),type:n.kcal>t?"negative":"positive"})]}),e.jsx(y.div,{initial:{scale:.9,opacity:0},animate:{scale:1,opacity:1},transition:{type:"spring",duration:.8},className:"order-1 lg:order-2 lg:-mt-16 overflow-visible flex items-center justify-center pointer-events-none",children:e.jsx(L,{consumed:n.kcal,goal:t})}),e.jsx(y.div,{initial:{opacity:0,x:20},animate:{opacity:1,x:0},transition:{delay:.3},className:"h-full order-3 flex flex-col justify-center",children:e.jsxs("div",{className:"bg-brand-neutral-dark rounded-xl p-4 border border-brand-depth flex flex-col gap-3.5",children:[e.jsx("p",{className:"text-xs text-brand-secondary uppercase tracking-wider mb-2",children:"Makroskladniki"}),e.jsx(F,{label:"Białko",value:n.protein,goal:r,color:"var(--color-brand-primary)"}),e.jsx(F,{label:"Tłuszcz",value:n.fat,goal:a,color:"var(--color-brand-accent-1)"}),e.jsx(F,{label:"Węgle",value:n.carbs,goal:l,color:"var(--color-brand-accent-2)"})]})})]},"stats-view")}const Y=({goalCalories:t,totalCalories:n,goalProtein:r,goalFat:a,goalCarbs:l,setGoalCalories:i,setGoalProtein:s,setGoalFat:c,setGoalCarbs:p,isLoading:u})=>{const[x,d]=o.useState(!1);return e.jsxs("div",{className:"bg-brand-neutral-dark/40 border border-brand-depth rounded-2xl p-6 relative",children:[e.jsx("div",{className:"absolute top-4 right-4 z-10",children:e.jsx("button",{onClick:()=>d(!x),className:"p-2 rounded-full hover:bg-brand-neutral-dark/80 text-brand-secondary hover:text-brand-accent-1 transition-colors flex items-center justify-center cursor-pointer",title:x?"Zamknij edycję":"Edytuj cele",disabled:u,children:x?e.jsx(z,{}):e.jsx(M,{})})}),e.jsx(_,{mode:"wait",children:x?e.jsx(V,{isLoading:u,goalCalories:t,goalProtein:r,goalFat:a,goalCarbs:l,setGoalCalories:i,setGoalProtein:s,setGoalFat:c,setGoalCarbs:p,onClose:()=>d(!1)}):e.jsx(X,{goalCalories:t,totalCalories:n,goalProtein:r,goalFat:a,goalCarbs:l})})]})},H=({isOpen:t,onClose:n,entry:r,onSave:a})=>{const[l,i]=o.useState(r.name),[s,c]=o.useState(r.kcal),[p,u]=o.useState(r.protein),[x,d]=o.useState(r.fat),[b,v]=o.useState(r.carbs),[m,N]=o.useState(r.grams);o.useEffect(()=>{t&&(i(r.name),c(r.kcal),u(r.protein),d(r.fat),v(r.carbs),N(r.grams))},[r,t]);const f=h=>{h.preventDefault(),a(r.id,{name:l,kcal:Number(s),protein:Number(p),fat:Number(x),carbs:Number(b),grams:Number(m)}),n()};return e.jsx(P,{show:t,as:o.Fragment,children:e.jsxs(T,{as:"div",className:"relative z-50",onClose:n,children:[e.jsx(C,{as:o.Fragment,enter:"transition-opacity ease-linear duration-300",enterFrom:"opacity-0",enterTo:"opacity-100",leave:"transition-opacity ease-linear duration-300",leaveFrom:"opacity-100",leaveTo:"opacity-0",children:e.jsx("div",{className:"fixed inset-0 bg-brand-neutral-darker/70 backdrop-blur-sm"})}),e.jsx("div",{className:"fixed inset-0 flex items-end justify-center",children:e.jsx(C,{as:o.Fragment,enter:"transition ease-in-out duration-300 transform",enterFrom:"translate-y-full",enterTo:"translate-y-0",leave:"transition ease-in-out duration-300 transform",leaveFrom:"translate-y-0",leaveTo:"translate-y-full",children:e.jsxs(D,{className:"w-full max-w-md rounded-t-xl bg-brand-neutral-dark border-t border-brand-depth p-6 shadow-xl relative",children:[e.jsxs("div",{className:"flex justify-between items-center mb-4",children:[e.jsx($,{className:"text-lg font-bold text-brand-neutral-light",children:"Edytuj wpis"}),e.jsx("button",{onClick:n,className:`flex items-center justify-center text-brand-neutral-light/60 hover:text-brand-neutral-light \r
                      hover:bg-brand-neutral-light/10 rounded-full p-1 transition-colors cursor-pointer`,children:e.jsx(z,{})})]}),e.jsxs("form",{onSubmit:f,className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-brand-neutral-light/80 mb-1",children:"Nazwa"}),e.jsx("input",{type:"text",value:l,onChange:h=>i(h.target.value),className:`w-full rounded-md border border-brand-depth bg-brand-neutral-dark px-3 py-2 \r
                             text-brand-neutral-light focus:outline-none focus:ring-2 focus:ring-brand-accent-1/40\r
                             transition-all duration-300`,required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-brand-neutral-light/80 mb-1",children:"Ilość (g)"}),e.jsx("input",{type:"number",min:0,value:m,onChange:h=>{const j=Number(h.target.value),g=new RegExp(`\\((${m}|${r.grams})\\s*g\\)|(${m}|${r.grams})\\s*g`,"i");if(g.test(l)&&i(l.replace(g,w=>w.replace(/\d+/,j.toString()))),N(j),r.grams>0){const w=j/r.grams;c(Math.round(r.kcal*w)),u(Math.round(r.protein*w*10)/10),d(Math.round(r.fat*w*10)/10),v(Math.round(r.carbs*w*10)/10)}},className:`w-full rounded-md border border-brand-depth bg-brand-neutral-dark px-3 py-2 \r
                             text-brand-neutral-light focus:outline-none focus:ring-2 focus:ring-brand-accent-1/40\r
                             transition-all duration-300`,required:!0})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-brand-neutral-light/80 mb-1",children:"Kcal"}),e.jsx("input",{type:"number",min:0,value:s,onChange:h=>c(Number(h.target.value)),className:`w-full rounded-md border border-brand-depth bg-brand-neutral-dark px-3 py-2 \r
                               text-brand-neutral-light focus:outline-none focus:ring-2 focus:ring-brand-accent-1/40\r
                               transition-all duration-300`})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-brand-neutral-light/80 mb-1",children:"Białko (g)"}),e.jsx("input",{type:"number",min:0,value:p,onChange:h=>u(Number(h.target.value)),className:`w-full rounded-md border border-brand-depth bg-brand-neutral-dark px-3 py-2 \r
                               text-brand-neutral-light focus:outline-none focus:ring-2 focus:ring-brand-accent-1/40\r
                               transition-all duration-300`})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-brand-neutral-light/80 mb-1",children:"Tłuszcz (g)"}),e.jsx("input",{type:"number",min:0,value:x,onChange:h=>d(Number(h.target.value)),className:`w-full rounded-md border border-brand-depth bg-brand-neutral-dark px-3 py-2 \r
                               text-brand-neutral-light focus:outline-none focus:ring-2 focus:ring-brand-accent-1/40\r
                               transition-all duration-300`})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-brand-neutral-light/80 mb-1",children:"Węgle (g)"}),e.jsx("input",{type:"number",min:0,value:b,onChange:h=>v(Number(h.target.value)),className:`w-full rounded-md border border-brand-depth bg-brand-neutral-dark px-3 py-2 \r
                               text-brand-neutral-light focus:outline-none focus:ring-2 focus:ring-brand-accent-1/40\r
                               transition-all duration-300`})]})]}),e.jsx("div",{className:"pt-2",children:e.jsx("button",{type:"submit",className:"w-full py-2 bg-brand-accent-2 rounded-xl text-brand-neutral-light font-bold hover:bg-brand-accent-2/70 transition-all cursor-pointer",children:"Zapisz"})})]})]})})})]})})};function ee({protein:t,fat:n,carbs:r}){const a=t*4,l=n*9,i=r*4,s=Math.max(1e-6,a+l+i),c=a/s*100,p=l/s*100,u=i/s*100;return e.jsxs("div",{className:"h-2 w-full rounded-full bg-brand-neutral-dark overflow-hidden flex",children:[e.jsx("div",{className:"h-full bg-brand-primary",style:{width:`${c}%`},title:`Białko ${t.toFixed(1)}g`}),e.jsx("div",{className:"h-full bg-brand-accent-1",style:{width:`${p}%`},title:`Tłuszcz ${n.toFixed(1)}g`}),e.jsx("div",{className:"h-full bg-brand-accent-2",style:{width:`${u}%`},title:`Węglowodany ${r.toFixed(1)}g`})]})}const ae=({entry:t,removeEntry:n,onEdit:r})=>{const[a,l]=o.useState(!1),[i,s]=o.useState(!1);return e.jsxs(e.Fragment,{children:[e.jsxs(y.li,{layout:!0,initial:{opacity:0,y:-10},animate:{opacity:1,y:0},exit:{opacity:0,x:-20},transition:{duration:.2},className:`group relative flex flex-col gap-2 p-4 bg-brand-neutral-dark/30 hover:bg-brand-neutral-dark/50 rounded-xl \r
                  border border-transparent hover:border-brand-primary/10 transition-all duration-300`,children:[e.jsxs("div",{className:"flex justify-between items-start w-full",children:[e.jsx("div",{className:"flex-1 pr-4",children:e.jsx("h3",{className:"font-medium text-brand-neutral-light text-base leading-snug",children:t.name})}),e.jsx("div",{className:"flex flex-col items-end shrink-0",children:e.jsxs("span",{className:"font-bold text-lg text-brand-accent-3 tabular-nums",children:[Math.round(t.kcal)," kcal"]})})]}),e.jsx("div",{children:e.jsx(ee,{protein:t.protein,fat:t.fat,carbs:t.carbs})}),e.jsxs("div",{className:"flex items-center justify-between mt-1",children:[e.jsxs("div",{className:"flex items-center gap-4 text-xs font-medium text-brand-secondary",children:[e.jsxs("div",{className:"flex items-center gap-1.5",title:"Białko",children:[e.jsx("div",{className:"w-2 h-2 rounded-full bg-brand-primary shadow-[0_0_8px_rgba(var(--brand-primary),0.5)]"}),e.jsxs("span",{className:"text-brand-neutral-light/80",children:["B: ",t.protein.toFixed(1),"g"]})]}),e.jsxs("div",{className:"flex items-center gap-1.5",title:"Tłuszcz",children:[e.jsx("div",{className:"w-2 h-2 rounded-full bg-brand-accent-1 shadow-[0_0_8px_rgba(var(--brand-accent-1),0.5)]"}),e.jsxs("span",{className:"text-brand-neutral-light/80",children:["T: ",t.fat.toFixed(1),"g"]})]}),e.jsxs("div",{className:"flex items-center gap-1.5",title:"Węglowodany",children:[e.jsx("div",{className:"w-2 h-2 rounded-full bg-brand-accent-2 shadow-[0_0_8px_rgba(var(--brand-accent-2),0.5)]"}),e.jsxs("span",{className:"text-brand-neutral-light/80",children:["W: ",t.carbs.toFixed(1),"g"]})]})]}),e.jsxs("div",{className:"sm:flex items-center gap-1 sm:opacity-0 sm:group-hover:opacity-100 transition-opacity duration-200",children:[e.jsx("button",{onClick:()=>s(!0),className:"flex items-center p-1.5 rounded-full text-brand-secondary hover:bg-brand-accent-2/70 transition-colors cursor-pointer",title:"Edytuj",children:e.jsx(M,{className:""})}),e.jsx("button",{onClick:()=>l(!0),className:"flex items-center p-1.5 rounded-full text-brand-secondary hover:text-red-400 hover:bg-red-400/10 transition-colors cursor-pointer",title:"Usuń",children:e.jsx(q,{className:""})})]})]})]}),e.jsx(Z,{isOpen:a,onClose:()=>l(!1),onConfirm:()=>n(t.id),description:e.jsxs("p",{children:["Czy na pewno chcesz usunąć"," ",e.jsx("strong",{className:"text-brand-neutral-light",children:t.name}),"? Tej akcji nie można cofnąć."]})}),e.jsx(H,{isOpen:i,onClose:()=>s(!1),entry:t,onSave:r})]})},te=({entries:t,removeEntry:n,isLoading:r,onEdit:a})=>e.jsxs("div",{className:"flex flex-col flex-1 min-h-0",children:[e.jsx("div",{className:"flex items-end lg:justify-end",children:e.jsx("h2",{className:"glass-header text-lg rounded-t-xl py-2 px-4",children:"Historia posiłków"})}),e.jsx(y.section,{layout:!0,className:"glass-panel rounded-b-2xl rounded-tr-2xl lg:rounded-tr-none lg:rounded-tl-2xl p-4 flex-1 min-h-0 overflow-y-auto",children:e.jsx("div",{className:"h-full flex flex-col",children:r?e.jsx(y.div,{animate:{rotate:360},transition:{repeat:1/0,duration:1.3,ease:"linear"},className:"w-5 h-5 border-2 border-white/30 border-t-white rounded-full"}):t.length===0?e.jsx("p",{className:"mt-4 text-brand-secondary",children:"Nic dziś jeszcze nie dodano. Dodaj pierwszy produkt na panelu obok."}):e.jsx("ul",{className:"space-y-2 pb-4",children:e.jsx(_,{children:t.map(l=>e.jsx(ae,{entry:l,removeEntry:n,onEdit:a},l.id))})})})})]}),G=({isOpen:t,onClose:n,onSubmit:r,foodHit:a,onGramsChange:l})=>{const[i,s]=o.useState(1),[c,p]=o.useState("grams");o.useEffect(()=>{t&&a&&(a.servingSize?(p("serving"),s(1),l(a.servingSize)):(p("grams"),s(100),l(100)))},[t,a?.id]);const u=d=>{s(d),c==="serving"&&a?.servingSize?l(d*a.servingSize):l(d)},x=()=>{c==="grams"&&a?.servingSize?(p("serving"),s(1),l(a.servingSize)):(p("grams"),s(100),l(100))};return e.jsx(P,{show:t,as:o.Fragment,children:e.jsxs(T,{as:"div",className:"relative z-40",onClose:n,children:[e.jsx(C,{as:o.Fragment,enter:"transition-opacity ease-linear duration-300",enterFrom:"opacity-0",enterTo:"opacity-100",leave:"transition-opacity ease-linear duration-300",leaveFrom:"opacity-100",leaveTo:"opacity-0",children:e.jsx("div",{className:"fixed inset-0 bg-brand-neutral-dark/80"})}),e.jsx("div",{className:"fixed inset-0 flex items-end justify-center",children:e.jsx(C,{as:o.Fragment,enter:"transition ease-in-out duration-300 transform",enterFrom:"translate-y-full",enterTo:"translate-y-0",leave:"transition ease-in-out duration-300 transform",leaveFrom:"translate-y-0",leaveTo:"translate-y-full",children:e.jsx(D,{className:`w-full max-w-md transform overflow-hidden rounded-t-xl bg-brand-neutral-dark p-6 text-left \r
                          align-middle shadow-xl transition-all border-t border-brand-depth`,children:a&&e.jsxs(e.Fragment,{children:[e.jsx($,{as:"h3",className:"text-lg font-medium leading-6 text-brand-neutral-light",children:"Dodaj produkt"}),e.jsxs("form",{onSubmit:r,className:"mt-4",children:[e.jsxs("div",{className:"rounded-lg border border-brand-depth p-3",children:[e.jsx("p",{className:"text-brand-neutral-light truncate",children:a.name}),e.jsxs("p",{className:"text-sm text-brand-secondary",children:[a.brand??"—"," • ",a.kcalPer100g," kcal / 100g"]})]}),e.jsxs("div",{className:"mt-4",children:[e.jsxs("div",{className:"flex justify-between items-center mb-2",children:[e.jsxs("label",{htmlFor:"amount",className:"block text-sm font-medium text-brand-secondary",children:["Ilość"," ",c==="serving"?`(${a.servingUnit||"porcji"})`:"(g)"]}),a.servingSize&&e.jsx("button",{type:"button",onClick:x,className:"text-xs text-brand-accent-1 hover:underline hover:cursor-pointer",children:c==="grams"?"Przełącz na porcje":"Przełącz na gramy"})]}),e.jsx("input",{id:"amount",type:"number",min:1,step:c==="serving"?.5:1,className:`mt-1 w-full rounded-md border border-brand-depth bg-brand-neutral-dark px-3 py-2 \r
                                text-brand-neutral-light focus:outline-none focus:ring-2 focus:ring-brand-accent-1/40\r
                                transition-focus duration-300`,value:i,onChange:d=>u(Number(d.target.value))}),c==="serving"&&a.servingSize&&e.jsxs("p",{className:"text-xs text-brand-secondary mt-1 text-left",children:[i," x ",a.servingSize,"g ="," ",Math.round(i*a.servingSize),"g"]})]}),e.jsxs("div",{className:"mt-6 flex gap-3",children:[e.jsx("button",{type:"button",className:`flex-1 justify-center rounded-md border border-brand-secondary px-4 py-2 text-sm font-medium \r
                                text-brand-secondary hover:bg-brand-secondary/10 focus:outline-none focus-visible:ring-2 focus-visible:ring-brand-accent-1/40`,onClick:n,children:"Anuluj"}),e.jsx("button",{type:"submit",disabled:a.grams<=0,className:`flex-1 justify-center rounded-md bg-brand-accent-1 px-4 py-2 text-sm font-semibold \r
                                text-brand-neutral-dark hover:bg-brand-accent-1/80 focus:outline-none focus-visible:ring-2 focus-visible:ring-brand-accent-1/40 disabled:bg-brand-secondary`,children:"Dodaj"})]})]})]})})})})]})})},re=({query:t,loading:n,error:r,localHits:a,addEntryFromFood:l,isRecent:i=!1})=>{const[s,c]=o.useState(null),p=b=>c({...b,grams:b.grams>0?b.grams:100}),u=()=>{c(null)},x=b=>{b.preventDefault(),s&&s.grams>0&&(l(s,s.grams),u())},d=b=>{s&&c({...s,grams:b})};return e.jsxs(e.Fragment,{children:[e.jsxs(y.div,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},exit:{opacity:0,y:-10},transition:{duration:.2},className:"h-full flex flex-col",children:[e.jsx(_,{children:a.length>0&&e.jsx(y.ul,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:"divide-y divide-white/10 border-b border-brand-depth/40 flex-1 overflow-y-auto min-h-0 max-h-[calc(100vh-15rem)] custom-scrollbar",children:a.map(b=>b.kcalPer100g!=null&&e.jsxs(y.li,{layout:!0,initial:{opacity:0,y:-10},animate:{opacity:1,y:0},exit:{opacity:0,x:-20},transition:{duration:.2},onClick:()=>p(b),className:"group p-3 flex items-center gap-3 hover:bg-brand-neutral-dark/40 transition cursor-pointer ",children:[b.imageUrl&&e.jsx("img",{src:b.imageUrl,alt:b.name,className:"h-10 w-10 rounded object-cover"}),e.jsxs("div",{className:"min-w-0 flex-1",children:[e.jsxs("p",{className:"text-brand-neutral-light",children:[b.brand&&e.jsxs("span",{children:[e.jsx("span",{className:"text-brand-secondary",children:b.brand}),e.jsx("span",{className:"text-brand-neutral-light mx-1",children:"•"})]}),b.name]}),e.jsxs("p",{className:"text-sm text-brand-secondary",children:[b.kcalPer100g?`${b.kcalPer100g} kcal / 100g`:"brak danych"," ",b.proteinPer100g!=null&&`| ${b.proteinPer100g}g białka`," ",b.fatPer100g!=null&&`| ${b.fatPer100g}g tłuszczu`," ",b.carbsPer100g!=null&&`| ${b.carbsPer100g}g węglowodanów`]})]})]},b.listId))})}),a.length===0&&n===!1&&t!==""&&r===null&&e.jsx("p",{className:"m-2 text-brand-secondary",children:"Brak wyników"}),a.length===0&&n===!1&&i&&a.length===0&&e.jsx("div",{className:"flex flex-col items-center justify-center p-8 text-brand-neutral-light/30",children:e.jsx("p",{children:"Brak ostatnio dodawanych produktów"})}),n&&e.jsx("p",{className:"m-2 text-brand-secondary",children:"Szukam w internecie..."}),r&&e.jsxs("p",{className:"m-2 text-brand-warning",children:["Błąd: ",r]})]},"search"),e.jsx(G,{isOpen:s!==null,onClose:u,onSubmit:x,foodHit:s,onGramsChange:d})]})},ne=({customEntry:t,handleCustomEntryChange:n,handleCustomEntrySubmit:r})=>{const[a,l]=o.useState("grams"),[i,s]=o.useState(!1),[c,p]=o.useState(""),[u,x]=o.useState(0),[d,b]=o.useState(100);o.useEffect(()=>{if(a==="grams")n({target:{name:"grams",value:d.toString()}});else{const m=d*u;n({target:{name:"grams",value:m.toString()}})}},[a,d,u]);const v=m=>{m.preventDefault(),r(m,i?{servingName:c,servingWeight:u}:void 0)};return e.jsx(y.div,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},exit:{opacity:0,y:-10},transition:{duration:.2},className:"overflow-y-auto",children:e.jsxs("form",{onSubmit:v,className:"p-4 bg-brand-neutral-dark/50 rounded-b-xl",children:[e.jsxs("div",{className:"flex gap-2 mb-4 p-1 bg-brand-neutral-dark rounded-lg border border-brand-depth",children:[e.jsx("button",{type:"button",onClick:()=>l("grams"),className:`flex-1 py-1 px-3 rounded-md text-sm font-medium transition-colors ${a==="grams"?"bg-brand-accent-1 text-brand-neutral-dark":"text-brand-secondary hover:text-brand-neutral-light hover:cursor-pointer"}`,children:"Na 100g"}),e.jsx("button",{type:"button",onClick:()=>l("serving"),className:`flex-1 py-1 px-3 rounded-md text-sm font-medium transition-colors ${a==="serving"?"bg-brand-accent-1 text-brand-neutral-dark":"text-brand-secondary hover:text-brand-neutral-light hover:cursor-pointer"}`,children:"Na porcję"})]}),e.jsxs("div",{className:"grid gap-3 sm:grid-cols-2",children:[e.jsx("input",{name:"name",className:`rounded-md border border-brand-depth bg-brand-neutral-dark px-3 py-2 text-brand-neutral-light \r
                    placeholder-brand-secondary focus:outline-none focus:ring-2 focus:ring-brand-accent-1/40 sm:col-span-2\r
                      transition-outline duration-300`,placeholder:"Nazwa produktu*",value:t.name,onChange:n,required:!0}),a==="serving"&&e.jsxs("div",{className:"sm:col-span-2 grid grid-cols-2 gap-3 p-3 rounded-lg border border-brand-depth/50 bg-brand-neutral-dark/30",children:[e.jsxs("label",{className:"flex flex-col text-sm text-brand-neutral-light",children:["Nazwa porcji*",e.jsx("input",{type:"text",placeholder:"porcja",className:`mt-1 rounded-md border border-brand-depth bg-brand-neutral-dark px-2 py-1 text-brand-neutral-light focus:ring-2 \r
                          focus:ring-brand-accent-1/40 focus:outline-none transition-outline duration-300`,value:c,onChange:m=>p(m.target.value),required:!0})]}),e.jsxs("label",{className:"flex flex-col text-sm text-brand-neutral-light",children:["Waga porcji (g)*",e.jsx("input",{type:"number",min:1,className:`mt-1 rounded-md border border-brand-depth bg-brand-neutral-dark px-2 py-1 text-brand-neutral-light focus:ring-2 \r
                          focus:ring-brand-accent-1/40 focus:outline-none transition-outline duration-300`,value:u||"100",onChange:m=>x(Number(m.target.value)),required:!0})]})]}),e.jsxs("div",{className:"sm:col-span-2",children:[e.jsxs("label",{className:"flex flex-col text-sm text-brand-neutral-light",children:[a==="grams"?"Ilość (g)":`Ilość (${c||"porcji"})`,e.jsx("input",{type:"number",min:0,step:a==="serving"?.5:1,className:`mt-1 w-full rounded-md border border-brand-depth bg-brand-neutral-dark px-3 py-2 text-brand-neutral-light focus:ring-2 \r
                        focus:ring-brand-accent-1/40 focus:outline-none transition-outline duration-300`,value:d,onChange:m=>b(Number(m.target.value))})]}),a==="serving"&&u>0&&e.jsxs("p",{className:"text-xs text-brand-secondary mt-1 text-left",children:[d," x ",u,"g = ",d*u,"g"]})]}),e.jsxs("div",{className:"",children:[e.jsxs("label",{className:"flex flex-col text-sm text-brand-neutral-light",children:["Węglowodany (na 100g)",e.jsx("input",{name:"carbs",type:"number",min:0,className:`mt-1 rounded-md border border-brand-depth bg-brand-neutral-dark px-2 py-1 text-brand-neutral-light focus:ring-2 \r
                        focus:ring-brand-accent-1/40 focus:outline-none transition-outline duration-300`,value:t.carbs,onChange:n})]}),e.jsxs("label",{className:"flex flex-col text-sm text-brand-neutral-light",children:["Białko (na 100g)",e.jsx("input",{name:"protein",type:"number",min:0,className:`mt-1 rounded-md border border-brand-depth bg-brand-neutral-dark px-2 py-1 text-brand-neutral-light focus:ring-2 \r
                        focus:ring-brand-accent-1/40 focus:outline-none transition-outline duration-300`,value:t.protein,onChange:n})]}),e.jsxs("label",{className:"flex flex-col text-sm text-brand-neutral-light",children:["Tłuszcz (na 100g)",e.jsx("input",{name:"fat",type:"number",min:0,className:`mt-1 rounded-md border border-brand-depth bg-brand-neutral-dark px-2 py-1 text-brand-neutral-light focus:ring-2 \r
                        focus:ring-brand-accent-1/40 focus:outline-none transition-outline duration-300`,value:t.fat,onChange:n})]})]}),e.jsx("div",{className:"",children:e.jsxs("label",{className:"flex flex-col text-sm text-brand-neutral-light",children:["Kalorie (na 100g)",e.jsx("input",{name:"kcal",type:"number",min:0,className:`mt-1 rounded-md border border-brand-depth bg-brand-neutral-dark px-2 py-1 text-brand-neutral-light focus:ring-2 \r
                        focus:ring-brand-accent-1/40 focus:outline-none transition-outline duration-300`,value:t.kcal,onChange:n})]})})]}),e.jsxs("div",{className:"mt-4 flex items-center gap-2",children:[e.jsx("input",{type:"checkbox",id:"saveToMyFoods",checked:i,onChange:m=>s(m.target.checked),className:"rounded border-brand-depth bg-brand-neutral-dark text-brand-accent-1 focus:ring-brand-accent-1/40"}),e.jsx("label",{htmlFor:"saveToMyFoods",className:"text-sm text-brand-neutral-light select-none cursor-pointer",children:"Zapisz do moich produktów"})]}),e.jsx("div",{className:"mt-4",children:e.jsx("button",{type:"submit",className:`w-full rounded-md bg-brand-accent-1 px-4 py-2 font-semibold text-brand-neutral-dark hover:bg-brand-accent-1/80 \r
                      transition duration-300 cursor-pointer`,children:"Dodaj"})})]})},"custom")};function se(t){const[n,r]=o.useState(!1),[a,l]=o.useState([]),[i,s]=o.useState(null);return o.useEffect(()=>{let c=!1;async function p(){if(!t){l([]),s(null);return}r(!0),s(null);try{const u="https://uknexpaqqpakwbwpbhpz.supabase.co/functions",x=new URL(`${u}/v1/get-food-by-barcode`);x.searchParams.set("barcode",t);const d=await fetch(x.toString());if(!d.ok){const v=await d.json();throw new Error(v.error||`HTTP ${d.status}`)}const b=await d.json();c||l(b.items??[])}catch(u){c||s(u.message)}finally{c||r(!1)}}return p(),()=>{c=!0}},[t]),{loading:n,hits:a,error:i,setHits:l}}const le=({addEntryFromFood:t})=>{const[n,r]=o.useState(""),[a,l]=o.useState(""),[i,s]=o.useState(null),[c,p]=o.useState(!1),{loading:u,hits:x,error:d,setHits:b}=se(a),[v,m]=o.useState(null);o.useEffect(()=>{if(d){m(d),s(null);return}if(x.length>0){const g=x[0];g.kcalPer100g!=null?(s({...g,id:g.sourceId||"result",listId:"scanner",grams:100}),p(!0),m(null)):(s(null),m(`"${g.name}" nie zawiera danych o kaloriach.`))}else s(null),a&&!u&&m("Nie znaleziono produktu o podanym kodzie.")},[x,d,a,u]);const N=()=>{l(""),r(""),s(null),b([]),p(!1),m(null)},f=g=>{g.preventDefault(),m(null),n&&l(n)},h=g=>{g.preventDefault(),i&&i.grams>0&&(t(i,i.grams),N())},j=g=>{i&&s({...i,grams:g})};return e.jsxs(e.Fragment,{children:[e.jsxs(y.div,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},exit:{opacity:0,y:-10},transition:{duration:.2},className:"pt-4 px-4 bg-brand-neutral-dark/50 rounded-xl rounded-tl-none",children:[u?e.jsx("p",{className:"text-center text-brand-secondary",children:"Szukam..."}):e.jsxs("form",{onSubmit:f,children:[e.jsx("input",{type:"text",placeholder:"Wpisz numer kodu kreskowego...",value:n,onChange:g=>r(g.target.value),className:`mt-1 w-full rounded-md border border-brand-depth bg-brand-neutral-dark px-3 py-2 text-brand-neutral-light \r
                         placeholder-brand-secondary focus:ring-2 focus:ring-brand-accent-1/40 focus:outline-none`}),e.jsx("button",{type:"submit",className:`mt-3 w-full rounded-md bg-brand-primary px-4 py-2 font-semibold text-brand-neutral-light\r
                         hover:bg-brand-primary/80 transition duration-300 cursor-pointer disabled:opacity-50 disabled:hover:cursor-not-allowed\r
                         disabled:hover:bg-brand-primary`,disabled:!n||u,children:"Szukaj ręcznie"})]}),v&&e.jsx("p",{className:"mt-4 text-center text-brand-warning font-semibold T",children:v}),e.jsx("div",{className:"h-4"})]},"scan"),e.jsx(G,{isOpen:c,onClose:N,onSubmit:h,foodHit:i,onGramsChange:j})]})};function ie({onClose:t,customEntry:n,handleCustomEntryChange:r,handleCustomEntrySubmit:a}){return e.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center p-4 bg-brand-neutral-dark/60",children:e.jsxs(y.div,{initial:{opacity:0,scale:.95},animate:{opacity:1,scale:1},exit:{opacity:0,scale:.95},className:"bg-brand-neutral-dark border border-brand-depth w-full max-w-lg rounded-2xl shadow-2xl flex flex-col max-h-[90vh] overflow-hidden",children:[e.jsxs("div",{className:"flex justify-between items-center p-4 border-b border-brand-depth bg-brand-neutral-dark/50 rounded-t-2xl",children:[e.jsx("h2",{className:"text-xl font-bold text-brand-neutral-light",children:"Dodaj własny produkt"}),e.jsx("button",{onClick:t,className:"p-1 cursor-pointer hover:bg-brand-depth rounded-full transition-colors hover:text-brand-neutral-dark text-brand-neutral-light flex items-center justify-center",children:e.jsx(z,{})})]}),e.jsx("div",{className:"flex-1 overflow-y-hidden",children:e.jsx(ne,{customEntry:n,handleCustomEntryChange:r,handleCustomEntrySubmit:(l,i)=>{a(l,i),t()}})})]})})}function de({onClose:t,addEntryFromFood:n}){return e.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center p-4 bg-brand-neutral-dark/60",children:e.jsxs(y.div,{initial:{opacity:0,scale:.95},animate:{opacity:1,scale:1},exit:{opacity:0,scale:.95},className:"bg-brand-neutral-dark border border-brand-depth w-full max-w-md rounded-2xl shadow-2xl flex flex-col",children:[e.jsxs("div",{className:"flex justify-between items-center p-4 border-b border-brand-depth bg-brand-neutral-dark/50 rounded-t-2xl",children:[e.jsx("h2",{className:"text-xl font-bold text-brand-neutral-light",children:"Skanuj kod kreskowy"}),e.jsx("button",{onClick:t,className:"p-1 cursor-pointer hover:bg-brand-depth rounded-full transition-colors hover:text-brand-neutral-dark text-brand-neutral-light flex items-center justify-center",children:e.jsx(z,{})})]}),e.jsx("div",{className:"p-2",children:e.jsx(le,{addEntryFromFood:n})})]})})}function oe(t,n=0){const[r,a]=o.useState(!1),[l,i]=o.useState([]),[s,c]=o.useState(null),[p,u]=o.useState(!0),{user:x}=B();return o.useEffect(()=>{let d=!1;async function b(){if(!t||t.length<2){if(!x){i([]),u(!0);return}a(!0),c(null);try{const{data:m,error:N}=await E.from("calorie_entries").select("food:foods(*)").eq("user_id",x.id).order("created_at",{ascending:!1}).limit(50);if(N)throw N;const f=new Set,h=[];m&&m.forEach(j=>{const g=j.food;g&&!f.has(g.id)&&(f.add(g.id),h.push({id:g.id,name:g.name,brand:g.brand,kcalPer100g:g.kcal_per_100g,proteinPer100g:g.protein_g_per_100g,fatPer100g:g.fat_g_per_100g,carbsPer100g:g.carbs_g_per_100g,imageUrl:g.image_url,sourceId:g.source_id,servingSize:g.serving_size_g,servingUnit:g.serving_unit}))}),d||(i(h.slice(0,10)),u(!0))}catch(m){d||c(m.message)}finally{d||a(!1)}return}a(!0),c(null),u(!1);try{const{data:m,error:N}=await E.from("foods").select("*").ilike("name",`%${t}%`).limit(15);if(N)throw N;const f=(m||[]).map(k=>({id:k.id,name:k.name,brand:k.brand,kcalPer100g:k.kcal_per_100g,proteinPer100g:k.protein_g_per_100g,fatPer100g:k.fat_g_per_100g,carbsPer100g:k.carbs_g_per_100g,imageUrl:k.image_url,sourceId:k.source_id,servingSize:k.serving_size_g,servingUnit:k.serving_unit}));d||i(f);const h="https://uknexpaqqpakwbwpbhpz.supabase.co/functions",j=new URL(`${h}/v1/search-food`);j.searchParams.set("q",t);const g=await fetch(j);let w=[];if(g.ok?w=(await g.json()).items??[]:console.warn("OFF search failed",g.status),!d){const k=new Set(f.map(S=>S.sourceId).filter(Boolean)),O=w.filter(S=>!S.sourceId||!k.has(S.sourceId));i([...f,...O])}}catch(m){d||c(m.message)}finally{d||a(!1)}}const v=setTimeout(b,333);return()=>{d=!0,clearTimeout(v)}},[t,x,n]),{loading:r,hits:l,error:s,isRecent:p}}function ce(t,n){const[r,a]=o.useState(t);function l(s){const{name:c,value:p}=s.target;a(u=>({...u,[c]:c==="name"?p:Number(p)}))}async function i(s,c){s.preventDefault(),await n(r,c)&&a({name:"",kcal:0,grams:100,protein:0,fat:0,carbs:0})}return{customEntry:r,handleCustomEntryChange:l,handleCustomEntrySubmit:i}}function ue({addEntryFromFood:t,addCustomEntry:n}){const[r,a]=o.useState(!1),[l,i]=o.useState(!1),[s,c]=o.useState(""),{loading:p,hits:u,error:x,isRecent:d}=oe(s),b=o.useMemo(()=>u.map(j=>({...j,listId:(j.sourceId??"")+j.name+(j.id??""),grams:100})),[u]),[v,m]=o.useState(b);o.useEffect(()=>{m(b)},[b]);const{customEntry:N,handleCustomEntryChange:f,handleCustomEntrySubmit:h}=ce({name:"",kcal:0,grams:100,protein:0,fat:0,carbs:0},n);return e.jsxs("div",{className:"flex-1 flex flex-col min-h-0",children:[e.jsxs("div",{className:"flex flex-col h-full bg-brand-neutral-dark/10 rounded-xl overflow-hidden border border-brand-depth/50",children:[e.jsxs("div",{className:"p-3 border-b border-brand-depth bg-brand-neutral-dark relative flex gap-2",children:[e.jsxs("div",{className:"relative flex-1",children:[e.jsx(R,{className:"absolute left-3 top-1/2 -translate-y-1/2 text-brand-neutral-light/50"}),e.jsx("input",{type:"text",placeholder:"Szukaj produktu...",value:s,onChange:j=>c(j.target.value),className:`w-full pl-10 pr-4 py-3 rounded-lg bg-brand-depth/30 border border-brand-depth/50 text-brand-neutral-light \r
                        placeholder-brand-neutral-light/30 focus:outline-none focus:ring-1 focus:ring-brand-accent-1 focus:border-brand-accent-1 \r
                        transition-all`})]}),e.jsx("button",{onClick:()=>a(!0),className:"bg-brand-accent-1 hover:bg-brand-accent-2 text-white p-3 rounded-lg transition-colors shadow-lg cursor-pointer flex items-center justify-center",title:"Dodaj własny produkt",children:e.jsx("span",{className:"flex justify-center items-center",children:"+"})}),e.jsx("button",{onClick:()=>i(!0),className:`bg-brand-neutral-light/90 hover:bg-brand-accent-3 border border-brand-depth \r
                    text-brand-neutral-dark p-3 rounded-lg transition-colors \r
                      shadow-sm cursor-pointer flex items-center justify-center`,title:"Skanuj kod kreskowy",children:e.jsx(K,{})})]}),e.jsx("div",{className:"flex-1 overflow-hidden relative bg-brand-neutral-dark/40",children:e.jsx(re,{query:s,loading:p,error:x,localHits:v,addEntryFromFood:t,isRecent:d})})]}),e.jsxs(_,{children:[r&&e.jsx(ie,{onClose:()=>a(!1),customEntry:N,handleCustomEntryChange:f,handleCustomEntrySubmit:(j,g)=>{h(j,g),a(!1)}}),l&&e.jsx(de,{onClose:()=>i(!1),addEntryFromFood:t})]})]})}function pe(){const{user:t}=B(),[n,r]=o.useState(new Date),{entries:a,isLoading:l,goals:i,totalCalories:s,addEntryFromFood:c,addCustomEntry:p,removeEntry:u,editEntry:x,updateGoal:d}=Q(t,n),b=f=>d("calories",f),v=f=>d("protein",f),m=f=>d("fat",f),N=f=>d("carbs",f);return e.jsxs(y.div,{initial:{opacity:0},animate:{opacity:1},transition:{duration:.5},className:"py-6 lg:p-8 mx-auto space-y-3 lg:h-[calc(100vh)] flex flex-col",children:[e.jsx("div",{className:"flex flex-col sm:flex-row items-center justify-between gap-3",children:e.jsx(J,{selectedDate:n,onDateChange:r,format:"day"})}),e.jsx(Y,{goalCalories:i.calories,totalCalories:s,goalProtein:i.protein,goalFat:i.fat,goalCarbs:i.carbs,setGoalCalories:b,setGoalProtein:v,setGoalFat:m,setGoalCarbs:N,isLoading:l}),e.jsxs("div",{className:"flex-1 grid grid-cols-1 lg:grid-cols-2 gap-8 min-h-0",children:[e.jsx(te,{entries:a,removeEntry:u,isLoading:l,onEdit:x}),e.jsx(ue,{addEntryFromFood:c,addCustomEntry:p})]})]})}export{pe as default};
