import{r,j as e,n as q,z as G,k as R,m as S,l as O,q as D,a as T,s as z,A as L,o as W,S as M,t as K}from"./index-DVEhPOJy.js";import{D as Z}from"./DateSelector-BliOKbC7.js";import{C as I,A as E}from"./ConfirmDeleteDialog-Ck78dyFH.js";import{C as $}from"./CustomSelect-CXzvWPs5.js";import{T as B}from"./TabButton-ByS7VgA3.js";import{u as A,a as H}from"./useFitnessDaily-a4wDe0LC.js";const Q=({isOpen:t,onClose:w,entry:s,onSave:j})=>{const[b,m]=r.useState(s.sets||0),[x,c]=r.useState(s.reps||0),[p,l]=r.useState(s.weight_kg||0),[i,h]=r.useState(s.duration_min||0),[k,N]=r.useState(s.distance_km||0);r.useEffect(()=>{t&&(m(s.sets||0),c(s.reps||0),l(s.weight_kg||0),h(s.duration_min||0),N(s.distance_km||0))},[s,t]);const d=async n=>{n.preventDefault();const u=s.exercise?.type||"strength";let f={};u==="strength"?f={sets:b,reps:x,weight_kg:p}:u==="cardio"?f={duration_min:i,distance_km:k}:u==="stretching"&&(f={duration_min:i}),await j(s.id,f),w()};return e.jsxs(q,{open:t,onClose:w,className:"relative z-50",children:[e.jsx("div",{className:"fixed inset-0 bg-brand-neutral-darker/70 backdrop-blur-sm","aria-hidden":"true"}),e.jsx("div",{className:"fixed inset-0 flex items-center justify-center p-4",children:e.jsxs(G,{className:"w-full max-w-sm rounded-2xl bg-brand-neutral-dark border border-brand-depth p-6 shadow-xl",children:[e.jsxs("div",{className:"flex justify-between items-center mb-4",children:[e.jsx("h3",{className:"text-lg font-bold text-brand-neutral-light",children:"Edytuj trening"}),e.jsx("button",{onClick:w,className:`flex items-center justify-center text-brand-neutral-light/60 hover:text-brand-neutral-light transition-colors cursor-pointer \r
                        hover:bg-brand-neutral-light/10 rounded-full p-1`,children:e.jsx(R,{})})]}),e.jsxs("form",{onSubmit:d,className:"space-y-4",children:[s.exercise?.type==="strength"&&e.jsxs("div",{className:"grid grid-cols-3 gap-3",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-brand-neutral-light/80 mb-1",children:"Serie"}),e.jsx("input",{type:"number",min:0,value:b,onChange:n=>m(Number(n.target.value)),className:"w-full px-3 py-2 bg-brand-neutral-dark/40 border border-brand-depth rounded-xl text-brand-neutral-light focus:outline-none focus:border-brand-primary"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-brand-neutral-light/80 mb-1",children:"Powt."}),e.jsx("input",{type:"number",min:0,value:x,onChange:n=>c(Number(n.target.value)),className:"w-full px-3 py-2 bg-brand-neutral-dark/40 border border-brand-depth rounded-xl text-brand-neutral-light focus:outline-none focus:border-brand-primary"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-brand-neutral-light/80 mb-1",children:"Waga (kg)"}),e.jsx("input",{type:"number",min:0,value:p,onChange:n=>l(Number(n.target.value)),className:"w-full px-3 py-2 bg-brand-neutral-dark/40 border border-brand-depth rounded-xl text-brand-neutral-light focus:outline-none focus:border-brand-primary"})]})]}),s.exercise?.type==="cardio"&&e.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-brand-neutral-light/80 mb-1",children:"Czas (min)"}),e.jsx("input",{type:"number",min:0,value:i,onChange:n=>h(Number(n.target.value)),className:"w-full px-3 py-2 bg-brand-neutral-dark/40 border border-brand-depth rounded-xl text-brand-neutral-light focus:outline-none focus:border-brand-primary"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-brand-neutral-light/80 mb-1",children:"Dystans (km)"}),e.jsx("input",{type:"number",min:0,value:k,onChange:n=>N(Number(n.target.value)),className:"w-full px-3 py-2 bg-brand-neutral-dark/40 border border-brand-depth rounded-xl text-brand-neutral-light focus:outline-none focus:border-brand-primary"})]})]}),s.exercise?.type==="stretching"&&e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-brand-neutral-light/80 mb-1",children:"Czas (min)"}),e.jsx("input",{type:"number",min:0,value:i,onChange:n=>h(Number(n.target.value)),className:"w-full px-3 py-2 bg-brand-neutral-dark/40 border border-brand-depth rounded-xl text-brand-neutral-light focus:outline-none focus:border-brand-primary"})]}),e.jsx("div",{className:"pt-2",children:e.jsx("button",{type:"submit",className:"w-full py-2 bg-brand-accent-2 rounded-xl text-brand-neutral-light font-bold hover:bg-brand-accent-2/60 transition-all cursor-pointer",children:"Zapisz"})})]})]})})]})};function Y({entry:t,onRemoveEntry:w,onEdit:s}){const[j,b]=r.useState(!1),[m,x]=r.useState(!1),c=()=>b(!0),p=()=>b(!1),l=()=>{w(t.id)},i=[{label:"Klatka",value:"chest"},{label:"Plecy",value:"back"},{label:"Nogi",value:"legs"},{label:"Barki",value:"shoulders"},{label:"Ramiona",value:"arms"},{label:"Brzuch",value:"core"},{label:"Cardio",value:"cardio"},{label:"Biceps",value:"biceps"},{label:"Triceps",value:"triceps"}];return e.jsxs(e.Fragment,{children:[e.jsxs(S.div,{layout:!0,initial:{opacity:0,scale:.95},animate:{opacity:1,scale:1},exit:{opacity:0,scale:.95},className:"mb-2 last:mb-0 bg-brand-neutral-dark border border-brand-depth rounded-lg p-3 group relative overflow-hidden",children:[e.jsxs("div",{className:"flex justify-between items-start z-10 relative",children:[e.jsxs("div",{children:[e.jsx("h4",{className:"font-bold text-brand-neutral-light text-lg",children:t.exercise?.name||"Nieznane ćwiczenie"}),e.jsxs("p",{className:"text-sm text-brand-neutral-light/70 uppercase tracking-wider",children:[t.exercise?.type==="strength"?`${i.find(h=>h.value===t.exercise?.muscle_group)?.label} • `:"",t.exercise?.type==="strength"?"Siłowe":t.exercise?.type==="stretching"?"Rozciąganie":"Cardio"]})]}),e.jsxs("div",{className:"flex sm:flex-row flex-col gap-1",children:[e.jsx("button",{onClick:()=>x(!0),className:`flex sm:order-1 order-2 sm:w-auto h-fit items-center justify-center rounded-full text-sm text-brand-neutral-light \r
                        hover:bg-brand-neutral-light/10 hover:text-brand-neutral-light\r
                        transition-colors duration-200 cursor-pointer p-1`,title:"Edytuj",children:e.jsx(O,{className:"scale-75"})}),e.jsx("button",{onClick:c,className:`flex sm:order-2 order-1 sm:w-auto h-fit items-center justify-center rounded-full text-sm text-brand-neutral-light \r
                        hover:bg-red-800/20 hover:border-red-500/30 hover:text-red-400\r
                        transition-colors duration-200 cursor-pointer p-1`,title:"Usuń",children:e.jsx(D,{className:"scale-75"})})]})]}),e.jsx("div",{className:"mt-3 flex gap-4",children:t.exercise?.type==="strength"?e.jsxs("div",{className:"flex gap-2",children:[e.jsxs("div",{className:"bg-brand-depth/30 rounded px-2 py-1",children:[e.jsx("span",{className:"text-brand-accent-1 font-bold",children:t.sets}),e.jsx("span",{className:"text-xs text-brand-neutral-light/50 ml-1",children:"SERIE"})]}),e.jsxs("div",{className:"bg-brand-depth/30 rounded px-2 py-1",children:[e.jsx("span",{className:"text-brand-accent-1 font-bold",children:t.reps}),e.jsx("span",{className:"text-xs text-brand-neutral-light/50 ml-1",children:"POWT."})]}),e.jsxs("div",{className:"bg-brand-depth/30 rounded px-2 py-1",children:[e.jsx("span",{className:"text-brand-accent-1 font-bold",children:t.weight_kg}),e.jsx("span",{className:"text-xs text-brand-neutral-light/50 ml-1",children:"KG"})]})]}):t.exercise?.type==="cardio"?e.jsxs("div",{className:"flex gap-2",children:[e.jsxs("div",{className:"bg-brand-depth/30 rounded px-2 py-1",children:[e.jsx("span",{className:"text-brand-accent-1 font-bold",children:t.duration_min}),e.jsx("span",{className:"text-xs text-brand-neutral-light/50 ml-1",children:"MIN"})]}),e.jsxs("div",{className:"bg-brand-depth/30 rounded px-2 py-1",children:[e.jsx("span",{className:"text-brand-accent-1 font-bold",children:t.distance_km}),e.jsx("span",{className:"text-xs text-brand-neutral-light/50 ml-1",children:"KM"})]})]}):e.jsx("div",{className:"flex gap-2",children:e.jsxs("div",{className:"bg-brand-depth/30 rounded px-2 py-1",children:[e.jsx("span",{className:"text-brand-accent-1 font-bold",children:t.duration_min}),e.jsx("span",{className:"text-xs text-brand-neutral-light/50 ml-1",children:"MIN"})]})})})]}),e.jsx(I,{isOpen:j,onClose:p,onConfirm:l,description:e.jsxs("p",{children:["Czy na pewno chcesz usunąć"," ",e.jsx("strong",{className:"text-brand-neutral-light",children:t.exercise?.name||"ćwiczenie"}),"? Tej akcji nie można cofnąć."]})}),e.jsx(Q,{isOpen:m,onClose:()=>x(!1),entry:t,onSave:s})]})}function J({entries:t,onRemoveEntry:w,isLoading:s,onEdit:j}){return s?e.jsx("div",{className:"flex-1 bg-brand-neutral-dark/50 border border-brand-depth rounded-xl p-4 flex items-center justify-center",children:e.jsx("p",{className:"text-brand-neutral-light/50",children:"Ładowanie treningów..."})}):t.length===0?e.jsx("div",{className:"flex-1 bg-brand-neutral-dark/50 border border-brand-depth rounded-xl p-4 flex items-center justify-center",children:e.jsx("p",{className:"text-brand-neutral-light/50",children:"Brak treningów tego dnia"})}):e.jsx("div",{className:"flex-1 bg-brand-neutral-dark/50 border border-brand-depth rounded-xl p-4 overflow-y-auto custom-scrollbar",children:e.jsx(S.div,{className:"space-y-4",initial:"hidden",animate:"visible",variants:{visible:{transition:{staggerChildren:.05}}},children:e.jsx(E,{mode:"popLayout",children:t.map(b=>e.jsx(Y,{entry:b,onRemoveEntry:w,onEdit:j},b.id))})})})}function V(t,w=0,s=null){const[j,b]=r.useState(!1),[m,x]=r.useState([]),[c,p]=r.useState(null),[l,i]=r.useState(!0),{user:h}=T();return r.useEffect(()=>{const N=setTimeout(async()=>{b(!0),p(null);try{if((!t||t.length<2)&&s===null){if(!h){x([]),i(!0);return}const{data:d,error:n}=await z.from("workout_logs").select("exercise:exercises(*)").eq("user_id",h.id).order("created_at",{ascending:!1}).limit(50);if(n)throw n;const u=new Set,f=[];d?.forEach(o=>{o.exercise&&!u.has(o.exercise.id)&&(u.add(o.exercise.id),f.push(o.exercise))}),x(f.slice(0,7)),i(!0)}else{let d=z.from("exercises").select("*").or(`created_by.is.null,created_by.eq.${h?.id}`);s&&s!=="all"&&(d=d.eq("type",s)),t&&t.length>=2&&(d=d.ilike("name",`%${t}%`));const n=t?20:50,{data:u,error:f}=await d.limit(n);if(f)throw f;x(u||[]),i(!1)}}catch(d){console.error("Error searching exercises:",d),p(d.message)}finally{b(!1)}},300);return()=>clearTimeout(N)},[t,h,w,s]),{loading:j,hits:m,error:c,isRecent:l}}function X({exercise:t,onCancel:w,onAdd:s,submitButtonText:j="Dodaj ćwiczenie",onEdit:b,onDelete:m}){const{user:x}=T(),[c,p]=r.useState(3),[l,i]=r.useState(10),[h,k]=r.useState(0),[N,d]=r.useState(0),[n,u]=r.useState(0),f=()=>{s({sets:t.type==="strength"||!t.type?c:1,reps:t.type==="strength"||!t.type?l:1,weight:t.type==="strength"||!t.type?h:0,duration:t.type==="cardio"||t.type==="stretching"?N:0,distance:t.type==="cardio"?n:0})},o="flex flex-col p-3 rounded-lg bg-brand-neutral-dark/40 backdrop-blur-md border border-brand-depth/50 shadow-inner",g=()=>{switch(t.type){case"cardio":return e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:o,children:[e.jsx("label",{className:"text-xs font-bold text-brand-neutral-light/70 uppercase text-center mb-1",children:"Czas (min)"}),e.jsx("input",{type:"number",min:0,value:N,onChange:a=>d(Number(a.target.value)),className:"w-full bg-transparent text-center text-xl font-bold text-brand-accent-1 focus:outline-none",placeholder:"0"})]}),e.jsxs("div",{className:o,children:[e.jsx("label",{className:"text-xs font-bold text-brand-neutral-light/70 uppercase text-center mb-1",children:"Dystans (km)"}),e.jsx("input",{type:"number",min:0,value:n,onChange:a=>u(Number(a.target.value)),className:"w-full bg-transparent text-center text-xl font-bold text-brand-accent-1 focus:outline-none",placeholder:"0"})]})]});case"stretching":return e.jsxs("div",{className:`${o} col-span-full`,children:[e.jsx("label",{className:"text-xs font-bold text-brand-neutral-light/70 uppercase text-center mb-1",children:"Czas (min)"}),e.jsx("input",{type:"number",min:0,value:N,onChange:a=>d(Number(a.target.value)),className:"w-full bg-transparent text-center text-xl font-bold text-brand-accent-1 focus:outline-none",placeholder:"0"})]});case"strength":default:return e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:o,children:[e.jsx("label",{className:"text-xs font-bold text-brand-neutral-light/70 uppercase text-center mb-1",children:"Serie"}),e.jsx("input",{type:"number",min:0,value:c,onChange:a=>p(Number(a.target.value)),className:"w-full bg-transparent text-center text-xl font-bold text-brand-accent-1 focus:outline-none"})]}),e.jsxs("div",{className:o,children:[e.jsx("label",{className:"text-xs font-bold text-brand-neutral-light/70 uppercase text-center mb-1",children:"Powtórzenia"}),e.jsx("input",{type:"number",min:0,value:l,onChange:a=>i(Number(a.target.value)),className:"w-full bg-transparent text-center text-xl font-bold text-brand-accent-1 focus:outline-none"})]}),e.jsxs("div",{className:o,children:[e.jsx("label",{className:"text-xs font-bold text-brand-neutral-light/70 uppercase text-center mb-1",children:"Ciężar (kg)"}),e.jsx("input",{type:"number",min:0,value:h,onChange:a=>k(Number(a.target.value)),className:"w-full bg-transparent text-center text-xl font-bold text-brand-accent-1 focus:outline-none"})]})]})}};return e.jsxs(S.div,{initial:{opacity:0,x:20},animate:{opacity:1,x:0},exit:{opacity:0,x:20},transition:{duration:.2},className:"flex flex-col h-full p-4",children:[e.jsxs("div",{className:"flex items-start justify-between border-b border-brand-depth pb-4 mb-4",children:[e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("button",{onClick:w,className:`flex items-center justify-center p-2 hover:bg-brand-neutral-light/30 rounded-full transition-colors\r
                            text-brand-neutral-light/60 hover:text-brand-neutral-light cursor-pointer`,children:e.jsx(L,{className:"scale-95 rotate-180"})}),e.jsx("h3",{className:"text-lg sm:text-xl font-bold text-brand-neutral-light",children:t.name})]}),e.jsx("p",{className:"text-xs text-brand-neutral-light/60 uppercase tracking-wider mt-1",children:t.type==="cardio"?"Cardio":t.type==="stretching"?"Rozciąganie":"Siłowe"}),t.description&&e.jsx("p",{className:"text-sm text-brand-neutral-light/70 mt-2 tracking-wide leading-relaxed",children:t.description})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[b&&x&&t.created_by===x.id&&e.jsx("button",{onClick:b,className:`flex items-center justify-center p-2 hover:bg-brand-accent-2/50 rounded-full transition-colors \r
                        text-brand-neutral-light/60 hover:text-brand-neutral-light cursor-pointer`,title:"Edytuj ćwiczenie",children:e.jsx(O,{className:"scale-95"})}),m&&x&&t.created_by===x.id&&e.jsx("button",{onClick:m,className:`flex items-center justify-center p-2 hover:bg-red-500/20 rounded-full transition-colors \r
                        text-brand-neutral-light/60 hover:text-red-400 cursor-pointer`,title:"Usuń ćwiczenie",children:e.jsx(W,{className:"scale-95"})})]})]}),e.jsx("div",{className:`flex flex-col gap-3 mb-6 md:grid ${t.type==="strength"||!t.type?"md:grid-cols-3":t.type==="cardio"?"md:grid-cols-2":"md:grid-cols-1"}`,children:g()}),e.jsx(S.button,{onClick:f,whileHover:{scale:1.02},whileTap:{scale:.98},className:`mt-auto w-full py-4 bg-brand-accent-1 hover:bg-brand-accent-2 cursor-pointer text-white font-bold rounded-xl \r
                   shadow-lg hover:shadow-brand-accent-1/20 transition-all flex items-center justify-center gap-2 text-lg`,children:j})]},"details")}function U({onAddExercise:t,submitButtonText:w="Dodaj ćwiczenie",onCreateExercise:s,onEditExercise:j,onDeleteExercise:b,refreshTrigger:m=0,clearSelectionTrigger:x=0}){const[c,p]=r.useState(""),[l,i]=r.useState(null),{loading:h,hits:k,error:N,isRecent:d}=V(c,m,l),[n,u]=r.useState(null),f=r.useRef(!1);r.useEffect(()=>{x>0&&(u(null),f.current=!0)},[x]),r.useEffect(()=>{(async()=>{if(f.current){f.current=!1;return}if(n&&m>0){const{data:a,error:v}=await z.from("exercises").select("*").eq("id",n.id).single();u(a&&!v?a:null)}})()},[m]);const o=g=>{n&&(t(n,g),u(null),p(""))};return e.jsx("div",{className:"flex flex-col h-full bg-brand-neutral-dark/50 rounded-b-xl overflow-hidden border border-brand-depth/50",children:e.jsx(E,{mode:"wait",children:n?e.jsx(X,{exercise:n,onCancel:()=>u(null),onAdd:o,submitButtonText:w,onEdit:j?()=>j(n):void 0,onDelete:b?()=>b(n):void 0}):e.jsxs(S.div,{initial:{opacity:0,x:-20},animate:{opacity:1,x:0},exit:{opacity:0,x:-20},transition:{duration:.2},className:"flex flex-col h-full",children:[e.jsxs("div",{className:"flex flex-col border-b border-brand-depth bg-brand-neutral-dark relative",children:[e.jsxs("div",{className:"p-3 flex gap-2",children:[e.jsxs("div",{className:"relative flex-1",children:[e.jsx(M,{className:"absolute left-3 top-1/2 -translate-y-1/2 text-brand-neutral-light/50"}),e.jsx("input",{type:"text",placeholder:"Szukaj ćwiczenia...",value:c,onChange:g=>p(g.target.value),className:`w-full pl-10 pr-4 py-3 rounded-lg bg-brand-depth/30 border border-brand-depth/50 text-brand-neutral-light \r
                              placeholder-brand-neutral-light/30 focus:outline-none focus:ring-1 focus:ring-brand-accent-1 focus:border-brand-accent-1 \r
                              transition-all`})]}),e.jsx("button",{onClick:s,className:"bg-brand-accent-1 hover:bg-brand-accent-2 text-white p-3 rounded-lg transition-colors shadow-lg cursor-pointer",title:"Stwórz nowe ćwiczenie",children:"+"})]}),e.jsx("div",{className:"px-3 pb-3 flex gap-2 overflow-x-auto custom-scrollbar",children:[{label:"Ostatnie",value:null},{label:"Wszystkie",value:"all"},{label:"Siłowe",value:"strength"},{label:"Cardio",value:"cardio"},{label:"Rozciąganie",value:"stretching"}].map(g=>e.jsx("button",{onClick:()=>i(g.value),className:`px-3 py-1.5 rounded-full text-xs font-medium transition-all whitespace-nowrap
                      ${l===g.value?"bg-brand-accent-1 text-brand-neutral-darker shadow-sm":"cursor-pointer bg-brand-depth text-brand-neutral-dark hover:bg-brand-depth/80"}`,children:g.label},g.label))})]}),e.jsxs("div",{className:"flex-1 overflow-y-auto custom-scrollbar p-2 space-y-1 relative",children:[e.jsx(E,{children:h&&e.jsx(S.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:"absolute inset-0 z-10 flex items-center justify-center bg-brand-neutral-dark/60 backdrop-blur-xs",children:e.jsx("p",{className:"text-brand-neutral-light/70 font-medium animate-pulse",children:"Szukanie..."})})}),N&&e.jsxs("p",{className:"text-red-400 text-center py-4 text-sm",children:["Błąd: ",N]}),k.map(g=>e.jsx(S.div,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},whileHover:{scale:1.01},whileTap:{scale:.99},onClick:()=>u(g),className:`p-4 rounded-lg bg-brand-neutral-dark border 
                            cursor-pointer transition-colors group shadow-sm hover:shadow-md hover:border-brand-accent-3/30
                            hover:bg-brand-neutral-dark/90 ${d?"border-brand-accent-1/20 bg-brand-accent-1/5":"border-brand-depth/50"}`,children:e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:`font-medium text-brand-neutral-light group-hover:text-brand-accent-3 \r
                                    transition-colors truncate flex-1 min-w-0 mr-2`,children:g.name}),(()=>{let a=g.type,v="text-brand-neutral-dark/80 bg-brand-depth";return g.type==="strength"?a=[{label:"Klatka",value:"chest"},{label:"Plecy",value:"back"},{label:"Nogi",value:"legs"},{label:"Barki",value:"shoulders"},{label:"Ramiona",value:"arms"},{label:"Brzuch",value:"core"},{label:"Cardio",value:"cardio"}].find(y=>y.value===g.muscle_group)?.label||g.muscle_group:g.type==="cardio"?(a="Cardio",v="bg-brand-accent-1 text-brand-neutral-darker"):g.type==="stretching"&&(a="Rozciąganie",v="bg-brand-accent-2 text-brand-neutral-darker"),e.jsx("span",{className:`text-xs font-bold px-2 py-1 rounded-full uppercase tracking-wide ${v}`,children:a})})()]})},g.id)),!h&&!d&&k.length===0&&e.jsxs("div",{className:"flex flex-col items-center justify-center py-8 text-brand-neutral-light/40",children:[e.jsx(M,{className:"text-4xl mb-2 opacity-20"}),e.jsx("p",{className:"text-sm",children:"Brak wyników"})]}),!h&&d&&k.length===0&&e.jsxs("div",{className:"flex flex-col items-center justify-center py-12 text-brand-neutral-light/30",children:[e.jsx(M,{className:"text-5xl mb-3"}),e.jsx("p",{className:"text-sm",children:"Wpisz nazwę aby wyszukać"}),e.jsx("button",{onClick:s,className:"mt-2 text-brand-accent-1 hover:underline cursor-pointer text-sm",children:"lub stwórz nowe ćwiczenie"})]})]})]},"search")})})}function P(t,w=0){const{user:s}=T(),[j,b]=r.useState(!1),[m,x]=r.useState([]),[c,p]=r.useState(null),l=async()=>{if(s){b(!0),p(null);try{let d=z.from("workout_sets").select(`
          *,
          items:workout_set_items (
            *,
            exercise:exercises (*)
          )
        `).order("created_at",{ascending:!1});t&&(d=d.ilike("name",`%${t}%`));const{data:n,error:u}=await d;if(u)throw u;x(n||[])}catch(d){console.error("Error searching sets:",d),p(d.message)}finally{b(!1)}}};r.useEffect(()=>{const d=setTimeout(l,300);return()=>clearTimeout(d)},[t,s,w]);const i=()=>{l()};return{loading:j,sets:m,error:c,refreshSets:i,createSet:async(d,n,u)=>{if(!s)throw new Error("Użytkownik nie jest zalogowany");const{data:f,error:o}=await z.from("workout_sets").insert({name:d,description:n,created_by:s.id}).select().single();if(o)throw o;if(u.length>0){const g=u.map((v,C)=>({set_id:f.id,exercise_id:v.exercise.id,order_index:C,sets:v.sets,reps:v.reps,weight_kg:v.weight,duration_min:v.duration})),{error:a}=await z.from("workout_set_items").insert(g);if(a)throw a}return i(),f},deleteSet:async d=>{const{error:n}=await z.from("workout_sets").delete().eq("id",d);if(n)throw n;i()},updateSet:async(d,n,u,f)=>{if(!s)throw new Error("Użytkownik nie jest zalogowany");const{error:o}=await z.from("workout_sets").update({name:n,description:u}).eq("id",d);if(o)throw o;const{error:g}=await z.from("workout_set_items").delete().eq("set_id",d);if(g)throw g;if(f.length>0){const a=f.map((C,y)=>({set_id:d,exercise_id:C.exercise.id,order_index:y,sets:C.sets,reps:C.reps,weight_kg:C.weight,duration_min:C.duration})),{error:v}=await z.from("workout_set_items").insert(a);if(v)throw v}i()}}}function F({onClose:t,onSuccess:w,initialData:s}){const{createSet:j,updateSet:b}=P(""),[m,x]=r.useState("details"),[c,p]=r.useState(s?.name||""),[l,i]=r.useState(s?.description||""),[h,k]=r.useState([]),[N,d]=r.useState(!1),[n,u]=r.useState(null);r.useEffect(()=>{s?.items&&k(s.items.map(a=>({id:a.id||Math.random().toString(36).substr(2,9),exercise:a.exercise,sets:a.sets,reps:a.reps,weight:a.weight_kg||0,duration:a.duration_min||0,distance:a.distance_km||0})))},[s]);const f=(a,v)=>{const C={id:Math.random().toString(36).substr(2,9),exercise:a,sets:v.sets,reps:v.reps,weight:v.weight,duration:v.duration,distance:v.distance};k(y=>[...y,C]),x("details")},o=a=>{k(v=>v.filter(C=>C.id!==a))},g=async()=>{if(!c.trim()){u("Nazwa zestawu jest wymagana");return}if(h.length===0){u("Dodaj przynajmniej jedno ćwiczenie");return}d(!0),u(null);try{s?await b(s.id,c,l,h):await j(c,l,h),w(),t()}catch(a){console.error("Failed to save set:",a),u("Nie udało się zapisać zestawu: "+a.message)}finally{d(!1)}};return e.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center p-4 bg-brand-neutral-dark/60",children:e.jsxs(S.div,{initial:{opacity:0,scale:.95},animate:{opacity:1,scale:1},exit:{opacity:0,scale:.95},className:`bg-brand-neutral-dark border border-brand-depth w-full max-w-lg h-[80vh] rounded-2xl \r
                  shadow-2xl flex flex-col overflow-hidden`,children:[e.jsxs("div",{className:"flex justify-between items-center p-4 border-b border-brand-depth bg-brand-neutral-dark/50",children:[e.jsx("h2",{className:"text-xl font-bold text-brand-neutral-light",children:m==="details"?s?"Edytuj zestaw ćwiczeń":"Stwórz nowy zestaw ćwiczeń":"Dodaj ćwiczenie do zestawu"}),e.jsx("button",{onClick:m==="details"?t:()=>x("details"),className:`p-1 cursor-pointer hover:bg-brand-depth rounded-full transition-colors hover:text-brand-neutral-dark \r
                    text-brand-neutral-light flex items-center justify-center`,children:e.jsx(R,{})})]}),e.jsx("div",{className:"flex-1 overflow-hidden relative",children:e.jsx(E,{mode:"wait",children:m==="details"?e.jsxs(S.div,{initial:{opacity:0,x:-20},animate:{opacity:1,x:0},exit:{opacity:0,x:-20},transition:{duration:.2},className:"flex flex-col h-full p-4 overflow-y-auto custom-scrollbar",children:[e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-bold text-brand-neutral-light/70 uppercase mb-1",children:"Nazwa zestawu"}),e.jsx("input",{type:"text",value:c,onChange:a=>p(a.target.value),placeholder:"np. Rozgrzewka A",className:`w-full px-4 py-2 rounded-lg bg-brand-depth/30 border border-brand-depth/50 text-brand-neutral-light \r
                                focus:outline-none focus:border-brand-accent-1 transition-colors`})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-bold text-brand-neutral-light/70 uppercase mb-1",children:"Opis (opcjonalnie)"}),e.jsx("textarea",{value:l,onChange:a=>i(a.target.value),placeholder:"Krótki opis zestawu...",rows:2,className:`w-full px-4 py-2 rounded-lg bg-brand-depth/30 border border-brand-depth/50 text-brand-neutral-light \r
                                focus:outline-none focus:border-brand-accent-1 resize-none transition-colors`})]}),e.jsxs("div",{className:"pt-2",children:[e.jsxs("div",{className:"flex justify-between items-center mb-2",children:[e.jsxs("label",{className:"block text-xs font-bold text-brand-neutral-light/70 uppercase",children:["Ćwiczenia (",h.length,")"]}),e.jsx("button",{onClick:()=>x("add-exercise"),className:`text-xs font-bold text-brand-accent-1 hover:text-brand-accent-2 cursor-pointer transition-colors \r
                                  uppercase tracking-wide`,children:"+ Dodaj ćwiczenie"})]}),e.jsxs("div",{className:"space-y-2 min-h-[100px] bg-brand-depth/10 rounded-lg p-2 border border-brand-depth/30",children:[h.length===0&&e.jsx("p",{className:"text-center text-brand-neutral-light/30 text-sm py-8",children:"Brak ćwiczeń. Dodaj pierwsze ćwiczenie!"}),h.map((a,v)=>e.jsxs("div",{className:"flex justify-between items-center p-3 bg-brand-neutral-dark border border-brand-depth rounded-lg group",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs("span",{className:"text-brand-neutral-light/30 font-bold text-xs w-4",children:[v+1,"."]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-brand-neutral-light",children:a.exercise.name}),e.jsx("p",{className:"text-xs text-brand-neutral-light/60",children:a.exercise.type==="cardio"?`${a.duration} min | ${a.distance} km`:a.exercise.type==="stretching"?`${a.duration} min`:`${a.sets} x ${a.reps} ${a.weight>0?`| ${a.weight}kg`:""}`})]})]}),e.jsx("button",{onClick:()=>o(a.id),className:`text-brand-neutral-light/30 hover:text-red-400 transition-colors p-1 hover:bg-red-400/10 \r
                                      flex items-center justify-center rounded-full cursor-pointer`,children:e.jsx(D,{})})]},a.id))]})]}),n&&e.jsx("p",{className:"text-red-400 text-sm text-center bg-red-400/10 p-2 rounded",children:n})]}),e.jsx("div",{className:"mt-auto pt-4",children:e.jsx("button",{onClick:g,disabled:N,className:`w-full py-3 bg-brand-accent-1 hover:bg-brand-accent-2 disabled:opacity-50 disabled:cursor-not-allowed\r
                             text-white font-bold rounded-xl shadow-lg transition-all cursor-pointer`,children:N?"Zapisywanie...":s?"Zapisz zmiany":"Utwórz zestaw"})})]},"details"):e.jsx(S.div,{initial:{opacity:0,x:20},animate:{opacity:1,x:0},exit:{opacity:0,x:20},transition:{duration:.2},className:"flex flex-col h-full",children:e.jsx(U,{onAddExercise:f,submitButtonText:"Dodaj do zestawu"})},"add-exercise")})})]})})}function ee({onAddSet:t,onCreateSet:w,refreshTrigger:s=0}){const[j,b]=r.useState(""),{loading:m,sets:x,error:c,refreshSets:p,deleteSet:l}=P(j,s),[i,h]=r.useState(null),[k,N]=r.useState(!1),[d,n]=r.useState(!1),u=()=>{i&&(t(i),h(null),b(""))},f=async()=>{if(i)try{await l(i.id),h(null),n(!1)}catch(o){console.error("Failed to delete set",o)}};return e.jsxs("div",{className:"flex flex-col h-full bg-brand-neutral-dark/50 rounded-b-xl overflow-hidden border border-brand-depth/50",children:[e.jsx(E,{mode:"wait",children:i?e.jsxs(S.div,{initial:{opacity:0,x:20},animate:{opacity:1,x:0},exit:{opacity:0,x:20},transition:{duration:.2},className:"flex flex-col h-full p-4",children:[e.jsxs("div",{className:"flex items-start justify-between border-b border-brand-depth pb-4 mb-4",children:[e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("button",{onClick:()=>h(null),className:`flex items-center justify-center p-2 hover:bg-brand-neutral-light/30 rounded-full transition-colors \r
                        text-brand-neutral-light/60 hover:text-brand-neutral-light cursor-pointer`,title:"Wróć",children:e.jsx(L,{className:"scale-95 rotate-180"})}),e.jsx("h3",{className:"text-lg sm:text-xl font-bold text-brand-neutral-light",children:i.name})]}),e.jsxs("p",{className:"text-xs text-brand-neutral-light/60 uppercase tracking-wider mt-1",children:["Liczba ćwiczeń: ",i.items?.length||0]}),e.jsx("p",{className:"text-sm text-brand-neutral-light/70 mt-2 tracking-wide leading-relaxed",children:i.description})]}),e.jsx("div",{className:"flex flex-col items-end gap-2",children:e.jsxs("div",{className:"ml-4 flex sm:flex-row flex-col gap-2",children:[e.jsx("button",{onClick:()=>N(!0),className:`flex items-center justify-center p-2 hover:bg-brand-accent-2/50 rounded-full transition-colors \r
                        text-brand-neutral-light/60 hover:text-brand-neutral-light cursor-pointer`,title:"Edytuj zestaw",children:e.jsx(O,{className:"scale-95"})}),e.jsx("button",{onClick:()=>n(!0),className:`flex items-center justify-center p-2 hover:bg-red-400/50 rounded-full transition-colors \r
                    text-brand-neutral-light/60 hover:text-brand-neutral-light cursor-pointer`,title:"Usuń zestaw",children:e.jsx(W,{className:"scale-95"})})]})})]}),e.jsx("div",{className:"flex-1 overflow-y-auto mb-4 custom-scrollbar",children:e.jsx("div",{className:"space-y-2",children:i.items?.map((o,g)=>e.jsx("div",{className:"p-3 rounded bg-brand-depth/20 border border-brand-depth/40 flex justify-between items-center",children:e.jsxs("div",{className:"flex gap-3 items-center",children:[e.jsxs("span",{className:"text-brand-neutral-light/30 font-bold text-xs w-4",children:[g+1,"."]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-brand-neutral-light font-medium text-sm",children:o.exercise?.name}),e.jsx("p",{className:"text-brand-neutral-light/60 text-xs",children:o.exercise?.type==="strength"?`${o.sets} x ${o.reps} • ${o.weight_kg||0}kg`:`${o.sets} serii • ${o.duration_min||o.reps} min/powt`})]})]})},o.id))})}),e.jsx(S.button,{onClick:u,whileHover:{scale:1.02},whileTap:{scale:.98},className:`mt-auto w-full py-3.5 bg-brand-accent-1 hover:bg-brand-accent-2 cursor-pointer text-white font-bold rounded-xl \r
                         shadow-lg hover:shadow-brand-accent-1/20 transition-all flex items-center justify-center gap-2`,children:"Dodaj zestaw treningowy"})]},"details"):e.jsxs(S.div,{initial:{opacity:0,x:-20},animate:{opacity:1,x:0},exit:{opacity:0,x:-20},transition:{duration:.2},className:"flex flex-col h-full",children:[e.jsxs("div",{className:"p-3 border-b border-brand-depth bg-brand-neutral-dark relative flex gap-2",children:[e.jsxs("div",{className:"relative flex-1",children:[e.jsx(M,{className:"absolute left-3 top-1/2 -translate-y-1/2 text-brand-neutral-light/50"}),e.jsx("input",{type:"text",placeholder:"Szukaj zestawu...",value:j,onChange:o=>b(o.target.value),className:`w-full pl-10 pr-4 py-3 rounded-lg bg-brand-depth/30 border border-brand-depth/50 text-brand-neutral-light \r
                            placeholder-brand-neutral-light/30 focus:outline-none focus:ring-1 focus:ring-brand-accent-1 focus:border-brand-accent-1 \r
                            transition-all`})]}),e.jsx("button",{onClick:w,className:"bg-brand-accent-1 hover:bg-brand-accent-2 text-white p-3 rounded-lg transition-colors shadow-lg cursor-pointer",title:"Stwórz nowy zestaw",children:"+"})]}),e.jsxs("div",{className:"flex-1 overflow-y-auto custom-scrollbar p-2 space-y-2",children:[m&&e.jsx("p",{className:"text-brand-neutral-light/50 text-center py-8 text-sm animate-pulse",children:"Ładowanie..."}),c&&e.jsxs("p",{className:"text-red-400 text-center py-4 text-sm",children:["Błąd: ",c]}),x.map(o=>e.jsx(S.div,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},whileHover:{scale:1.01},whileTap:{scale:.99},onClick:()=>h(o),className:`p-4 rounded-lg bg-brand-neutral-dark border border-brand-depth/50 \r
                            cursor-pointer transition-colors group shadow-sm hover:shadow-md hover:border-brand-accent-3/30\r
                            hover:bg-brand-neutral-dark/90`,children:e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium text-brand-neutral-light group-hover:text-brand-accent-3 transition-colors",children:o.name}),o.description&&e.jsx("p",{className:"text-xs text-brand-neutral-light/50 mt-1 line-clamp-1",children:o.description})]}),e.jsxs("span",{className:"text-xs font-bold text-brand-neutral-dark/80 bg-brand-depth px-2 py-1 rounded-full uppercase tracking-wide whitespace-nowrap",children:[o.items?.length||0," ćw."]})]})},o.id)),!m&&j&&x.length===0&&e.jsxs("div",{className:"flex flex-col items-center justify-center py-8 text-brand-neutral-light/40",children:[e.jsx(M,{className:"text-4xl mb-2 opacity-20"}),e.jsx("p",{className:"text-sm",children:"Brak wyników"})]}),!m&&!j&&x.length===0&&e.jsxs("div",{className:"flex flex-col items-center justify-center py-12 text-brand-neutral-light/30",children:[e.jsx(M,{className:"text-5xl mb-3"}),e.jsx("p",{className:"text-sm",children:"Brak zestawów"}),e.jsx("button",{onClick:w,className:"mt-2 text-brand-accent-1 hover:underline cursor-pointer text-sm",children:"Stwórz swój pierwszy zestaw"})]})]})]},"search")}),k&&i&&e.jsx(F,{initialData:i,onClose:()=>N(!1),onSuccess:()=>{p(),h(null),N(!1)}}),e.jsx(I,{isOpen:d,onClose:()=>n(!1),onConfirm:f,title:"Usuń zestaw",description:e.jsxs("p",{children:["Czy na pewno chcesz usunąć zestaw"," ",e.jsx("strong",{className:"text-brand-neutral-light",children:i?.name}),"?"]})})]})}const te=[{label:"Klatka",value:"chest"},{label:"Plecy",value:"back"},{label:"Nogi",value:"legs"},{label:"Barki",value:"shoulders"},{label:"Ramiona",value:"arms"},{label:"Brzuch",value:"core"},{label:"Biceps",value:"biceps"},{label:"Triceps",value:"triceps"}],se=[{label:"Siłowe",value:"strength"},{label:"Cardio",value:"cardio"},{label:"Rozciąganie",value:"stretching"}];function re({onClose:t,onCreated:w,initialData:s}){const{user:j}=T(),[b,m]=r.useState(s?.name||""),[x,c]=r.useState(s?.description||""),[p,l]=r.useState(s?.muscle_group||"chest"),[i,h]=r.useState(s?.type||"strength"),[k,N]=r.useState(!1),[d,n]=r.useState(null);r.useEffect(()=>{s?(m(s.name),c(s.description||""),l(s.muscle_group),h(s.type)):(m(""),c(""),l("chest"),h("strength"))},[s]);const u=async f=>{if(f.preventDefault(),!j||!b)return;N(!0),n(null);const o={name:b,description:x,muscle_group:i==="strength"?p:i,type:i};let g=null;if(s){const{data:a,error:v}=await z.from("exercises").update(o).eq("id",s.id).select();v?g=v:(!a||a.length===0)&&(g={message:"Brak uprawnień do edycji tego ćwiczenia lub ćwiczenie nie istnieje."})}else{const{error:a}=await z.from("exercises").insert({...o,created_by:j.id});g=a}N(!1),g?(console.error(`Error ${s?"updating":"creating"} custom exercise`,g),n(`Nie udało się ${s?"zaktualizować":"utworzyć"} ćwiczenia: `+g.message)):(s||(m(""),c("")),w(),t())};return e.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center p-4 bg-brand-neutral-dark/60",children:e.jsxs(S.div,{initial:{opacity:0,scale:.95},animate:{opacity:1,scale:1},exit:{opacity:0,scale:.95},className:`bg-brand-neutral-dark border border-brand-depth w-full max-w-lg rounded-2xl \r
                  shadow-2xl flex flex-col`,children:[e.jsxs("div",{className:"flex justify-between items-center p-4 border-b border-brand-depth bg-brand-neutral-dark/50 rounded-t-2xl",children:[e.jsx("h2",{className:"text-xl font-bold text-brand-neutral-light",children:s?"Edytuj ćwiczenie":"Stwórz własne ćwiczenie"}),e.jsx("button",{onClick:t,className:`p-1 cursor-pointer hover:bg-brand-depth rounded-full transition-colors hover:text-brand-neutral-dark \r
                    text-brand-neutral-light flex items-center justify-center`,children:e.jsx(R,{})})]}),e.jsxs("form",{onSubmit:u,className:"flex flex-col gap-5 p-4",children:[e.jsxs("div",{className:"flex flex-col gap-2",children:[e.jsx("label",{className:"text-sm text-brand-neutral-light font-medium",children:"Nazwa ćwiczenia"}),e.jsx("input",{type:"text",value:b,onChange:f=>m(f.target.value),required:!0,placeholder:"np. Wyciskanie hantli",className:`p-3 rounded-lg bg-brand-neutral-dark border border-brand-depth text-brand-neutral-light \r
                         placeholder-brand-neutral-light/30 focus:outline-none focus:ring-1 focus:ring-brand-accent-1 \r
                         focus:border-brand-accent-1 transition-all`})]}),e.jsxs("div",{className:"flex flex-col gap-2",children:[e.jsx("label",{className:"text-sm text-brand-neutral-light font-medium",children:"Opis (opcjonalnie)"}),e.jsx("textarea",{value:x,onChange:f=>c(f.target.value),placeholder:"Krótki opis, wskazówki...",rows:2,className:`p-3 rounded-lg bg-brand-neutral-dark border border-brand-depth text-brand-neutral-light \r
                         placeholder-brand-neutral-light/30 focus:outline-none focus:ring-1 focus:ring-brand-accent-1 \r
                         focus:border-brand-accent-1 transition-all resize-none`})]}),e.jsxs("div",{className:`grid grid-cols-1 ${i==="strength"?"sm:grid-cols-2":""} gap-4`,children:[i==="strength"&&e.jsx($,{label:"Partia mięśniowa",value:p,onChange:l,options:te}),e.jsx($,{label:"Typ",value:i,onChange:f=>h(f),options:se})]}),d&&e.jsx("p",{className:"text-red-400 text-sm text-center bg-red-400/10 p-2 rounded",children:d}),e.jsx(S.button,{type:"submit",disabled:k,whileHover:{scale:1.02},whileTap:{scale:.98},className:`mt-4 w-full py-3 bg-brand-accent-1 hover:bg-brand-accent-2 text-white font-bold rounded-lg \r
                       transition-colors disabled:opacity-50 disabled:cursor-not-allowed flex items-center justify-center gap-2 shadow-lg \r
                       cursor-pointer hover:shadow-brand-accent-1/20`,children:k?e.jsxs(e.Fragment,{children:[e.jsx(K,{className:"animate-spin"})," Zapisywanie..."]}):s?"Zapisz zmiany":"Stwórz ćwiczenie"})]})]})})}function ae(){const{user:t}=T(),[w,s]=r.useState(!1),[j,b]=r.useState(null);return{deleteExercise:async x=>{if(!t)throw new Error("Musisz być zalogowany, aby usuwać ćwiczenia.");s(!0),b(null);try{const{error:c}=await z.from("workout_logs").delete().eq("exercise_id",x);if(c)throw c;const{error:p}=await z.from("workout_set_items").delete().eq("exercise_id",x);if(p)throw p;const{error:l,data:i}=await z.from("exercises").delete().eq("id",x).select();if(l)throw l;if(!i||i.length===0)throw new Error("Nie udało się usunąć ćwiczenia. Możesz usuwać tylko ćwiczenia stworzone przez siebie.");return!0}catch(c){console.error("Error deleting exercise:",c);const p=c.message||"Wystąpił nieznany błąd podczas usuwania.";throw b(p),new Error(p)}finally{s(!1)}},isDeleting:w,error:j}}function ne({onAddExercise:t}){const{deleteExercise:w}=ae(),[s,j]=r.useState("exercises"),[b,m]=r.useState(!1),[x,c]=r.useState(void 0),[p,l]=r.useState(!1),[i,h]=r.useState(0),[k,N]=r.useState(0),[d,n]=r.useState(!1),[u,f]=r.useState(null),[o,g]=r.useState(0),a=y=>{y.items?.forEach(_=>{_.exercise&&t(_.exercise,{sets:_.sets,reps:_.reps,weight:_.weight_kg||0,duration:_.duration_min||0,distance:_.distance_km||0})})},v=y=>{f(y),n(!0)},C=async()=>{if(u)try{await w(u.id),h(y=>y+1),g(y=>y+1)}catch(y){alert("Wystąpił błąd: "+(y.message||y.toString()))}finally{n(!1),f(null)}};return e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"rounded-xl flex-1 flex flex-col min-h-0",children:[e.jsxs("div",{className:"flex border-b border-brand-depth gap-2",children:[e.jsx(B,{label:"Ćwiczenia",value:"exercises",isSelected:s==="exercises",setSelectedTab:y=>j(y)}),e.jsx(B,{label:"Zestawy",value:"sets",isSelected:s==="sets",setSelectedTab:y=>j(y)})]}),s==="exercises"?e.jsx("div",{className:"flex flex-col h-full overflow-hidden",children:e.jsx("div",{className:"flex-1 overflow-hidden relative",children:e.jsx(E,{mode:"wait",children:e.jsx(U,{onAddExercise:t,onCreateExercise:()=>{c(void 0),l(!0)},onEditExercise:y=>{c(y),l(!0)},onDeleteExercise:v,refreshTrigger:i,clearSelectionTrigger:o},"search")})})}):e.jsx("div",{className:"flex-1 overflow-hidden relative",children:e.jsx(ee,{onCreateSet:()=>m(!0),onAddSet:a,refreshTrigger:k})})]}),e.jsxs(E,{children:[b&&e.jsx(F,{onClose:()=>m(!1),onSuccess:()=>{N(y=>y+1),m(!1)}}),p&&e.jsx(re,{onClose:()=>{l(!1),c(void 0)},initialData:x,onCreated:()=>{h(y=>y+1),l(!1),c(void 0)}})]}),e.jsx(I,{isOpen:d,onClose:()=>n(!1),onConfirm:C,title:"Usuń ćwiczenie",description:e.jsxs("p",{children:["Czy na pewno chcesz usunąć ćwiczenie"," ",e.jsx("strong",{className:"text-brand-neutral-light",children:u?.name}),"? ",e.jsx("br",{}),e.jsx("span",{className:"text-xs opacity-80 mt-2 block",children:"Usunie to również wszystkie użycia tego ćwiczenia w historii treningów oraz zestawach. Tego działania nie można cofnąć."})]})})]})}const le=[{id:1,name:"Poniedziałek"},{id:2,name:"Wtorek"},{id:3,name:"Środa"},{id:4,name:"Czwartek"},{id:5,name:"Piątek"},{id:6,name:"Sobota"},{id:0,name:"Niedziela"}];function ie({onClose:t}){const{weeklyPlan:w,updateScheduledDay:s,loading:j}=A(),{sets:b,loading:m,refreshSets:x}=P("");return r.useEffect(()=>{x()},[]),e.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center p-4 bg-black/60 backdrop-blur-sm",children:e.jsxs(S.div,{initial:{opacity:0,scale:.95},animate:{opacity:1,scale:1},exit:{opacity:0,scale:.95},className:"bg-brand-neutral-dark border border-brand-depth rounded-2xl w-full max-w-2xl max-h-[90vh] flex flex-col shadow-2xl",children:[e.jsxs("div",{className:"p-6 border-b border-brand-depth flex justify-between items-center",children:[e.jsx("h2",{className:"text-xl lg:text-2xl font-bold text-brand-neutral-light",children:"Plan tygodniowy"}),e.jsx("button",{onClick:t,className:`flex items-center justify-center p-2 hover:bg-brand-depth/50 rounded-full transition-colors \r
                text-brand-neutral-light/60 hover:text-brand-neutral-light cursor-pointer`,children:e.jsx(R,{})})]}),e.jsx("div",{className:"p-6 overflow-y-auto custom-scrollbar space-y-4",children:j||m?e.jsx("div",{className:"py-10 text-center text-brand-neutral-light/50",children:"Ładowanie..."}):e.jsx("div",{className:"grid grid-cols-1 gap-3",children:le.map(c=>{const p=w.find(l=>l.scheduled_day===c.id);return e.jsxs("div",{className:"flex items-center gap-4 bg-brand-depth/20 p-3 rounded-xl border border-brand-depth/40 hover:border-brand-depth transition-colors",children:[e.jsx("div",{className:"truncate w-14 lg:w-28 font-medium text-brand-neutral-light",children:c.name}),e.jsx("div",{className:"flex-1",children:e.jsxs("select",{value:p?.id||"",onChange:l=>{const i=l.target.value;!i&&p?s(p.id,null):i&&s(i,c.id)},className:`w-full bg-brand-neutral-dark border border-brand-depth/60 rounded-lg px-3 py-2 text-sm text-brand-neutral-light focus:border-brand-accent-1 \r
                                focus:ring-1 focus:ring-brand-accent-1 outline-none`,children:[e.jsx("option",{value:"",children:"Brak planu"}),b.map(l=>e.jsx("option",{value:l.id,children:l.name},l.id))]})})]},c.id)})})}),e.jsx("div",{className:"p-6 border-t border-brand-depth flex justify-end",children:e.jsx("button",{onClick:t,className:"px-6 py-2 bg-brand-accent-1 hover:bg-brand-accent-2 text-white font-bold rounded-xl transition-all shadow-lg cursor-pointer",children:"Gotowe"})})]})})}function de({entries:t,selectedDate:w}){const[s,j]=r.useState(!1),{getDayPlan:b,refreshPlan:m}=A(),[x,c]=r.useState(null),p=r.useMemo(()=>{const i=w.getDay();return i===0?0:i},[w]);r.useEffect(()=>{m()},[]),r.useEffect(()=>{const i=b(p);c(i)},[p,b]);const l=r.useMemo(()=>{const i=new Set(t.map(n=>n.exercise_id)).size,h=t.reduce((n,u)=>n+(u.sets||0),0),k=t.reduce((n,u)=>n+(u.sets||0)*(u.reps||0)*(u.weight_kg||0),0),N=t.reduce((n,u)=>n+(u.distance_km||0),0),d=t.length>0?t[t.length-1]:null;return{workouts:i,sets:h,volume:k,distance_km:N,lastSet:d}},[t]);return e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"bg-brand-neutral-dark/40 border border-brand-depth rounded-2xl p-6 relative",children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-3",children:[e.jsxs(S.div,{initial:{opacity:0,x:-20},animate:{opacity:1,x:0},transition:{delay:.4},className:"bg-brand-neutral-dark p-4 border border-brand-depth rounded-xl h-full flex flex-col justify-center min-h-[100px]",children:[e.jsx("p",{className:"text-xs text-brand-neutral-light/70 uppercase tracking-wide mb-2",children:"Ostatnia seria"}),l.lastSet?e.jsxs("div",{className:"flex flex-col gap-1",children:[e.jsx("span",{className:"text-lg font-bold text-brand-neutral-light line-clamp-1",children:l.lastSet.exercise?.name||"Nieznane ćwiczenie"}),e.jsxs("div",{className:"flex items-center gap-2 mt-1",children:[e.jsx("span",{className:"text-xs text-brand-accent-1 bg-brand-accent-1/10 px-2 py-0.5 rounded",children:new Date(l.lastSet.created_at).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})}),l.lastSet.distance_km?e.jsxs("span",{className:"text-xs text-brand-accent-1 bg-brand-accent-1/10 px-2 py-0.5 rounded",children:[l.lastSet.distance_km," km x"," ",l.lastSet.duration_min," min"]}):l.lastSet.weight_kg?e.jsxs("span",{className:"text-xs text-brand-accent-1 bg-brand-accent-1/10 px-2 py-0.5 rounded",children:[l.lastSet.weight_kg," kg x ",l.lastSet.reps]}):e.jsxs("span",{className:"text-xs text-brand-accent-1 bg-brand-accent-1/10 px-2 py-0.5 rounded",children:[l.lastSet.duration_min," min"]})]})]}):e.jsx("span",{className:"text-brand-neutral-light/50 italic text-sm",children:"Brak aktywności"})]}),e.jsx(S.div,{initial:{opacity:0,x:-20},animate:{opacity:1,x:0},transition:{delay:.4},className:"bg-brand-neutral-dark p-4 border border-brand-depth rounded-xl h-full flex flex-col justify-center min-h-[100px]",children:e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("p",{className:"text-xs text-brand-neutral-light/60 uppercase tracking-widest mb-1",children:[w.toLocaleDateString("pl-PL",{weekday:"long"}),": PLAN"]}),e.jsx("button",{onClick:()=>j(!0),className:`flex items-center justify-center text-brand-neutral-light hover:text-white transition-all hover:bg-brand-depth/50 \r
                            p-1 rounded-full cursor-pointer`,title:"Zmień plan",children:e.jsx(O,{className:"scale-80"})})]}),x?e.jsxs("div",{className:"text-center px-6",children:[e.jsx("h3",{className:"text-xl lg:text-2xl font-bold text-brand-accent-2 mb-2 line-clamp-2",children:x.name}),e.jsxs("span",{className:"text-xs text-brand-neutral-light/50 bg-brand-depth/50 px-2 py-1 rounded-full",children:["Liczba ćwiczeń: ",x.items?.length||0]})]}):e.jsx("span",{className:"text-brand-neutral-light/30 italic px-4 text-center",children:"Brak planu"})]})}),e.jsx(S.div,{initial:{opacity:0,x:-20},animate:{opacity:1,x:0},transition:{delay:.1},className:"bg-brand-neutral-dark p-4 border border-brand-depth rounded-xl flex items-center justify-between",children:e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-brand-neutral-light/70 uppercase tracking-wide mb-1",children:"Ćwiczenia • Serie"}),e.jsxs("p",{className:"text-2xl font-bold text-brand-accent-1",children:[l.workouts," ",e.jsx("span",{className:"text-brand-neutral-light/50",children:"•"})," ",e.jsx("span",{className:"text-brand-accent-3",children:l.sets})]})]})}),e.jsx(S.div,{initial:{opacity:0,x:-20},animate:{opacity:1,x:0},transition:{delay:.1},className:"bg-brand-neutral-dark p-4 border border-brand-depth rounded-xl flex items-center justify-between",children:e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-brand-neutral-light/70 uppercase tracking-wide mb-1",children:"Objętość • Przebieg"}),e.jsxs("p",{className:"text-2xl font-bold text-brand-accent-1",children:[e.jsxs("span",{className:"text-brand-accent-3",children:[l.volume," kg"]})," ",e.jsx("span",{className:"text-brand-neutral-light/50",children:"•"})," ",e.jsxs("span",{className:"text-brand-accent-1",children:[l.distance_km," km"]})]})]})})]})}),e.jsx(E,{children:s&&e.jsx(ie,{onClose:()=>j(!1)})})]})}function me(){T();const[t,w]=r.useState(new Date),{entries:s,isLoading:j,addEntry:b,removeEntry:m,editEntry:x}=H(t),c=async(l,i)=>{await b(l,i)},p=async l=>{await m(l)};return e.jsxs(S.div,{initial:{opacity:0},animate:{opacity:1},transition:{duration:.5},className:"flex flex-col lg:flex-row gap-6 py-2 sm:py-4 h-full lg:h-[calc(100vh-1rem)] w-full overflow-hidden",children:[e.jsxs("div",{className:"lg:w-1/3 w-full h-full flex flex-col gap-4 overflow-hidden order-1",children:[e.jsx(Z,{selectedDate:t,onDateChange:w,format:"day"}),e.jsx(J,{entries:s,onRemoveEntry:p,isLoading:j,onEdit:x})]}),e.jsxs("div",{className:"lg:w-2/3 w-full h-full flex flex-col gap-4 overflow-hidden order-1 lg:order-2",children:[e.jsx(de,{entries:s,selectedDate:t}),e.jsx(ne,{onAddExercise:c})]})]})}export{me as default};
