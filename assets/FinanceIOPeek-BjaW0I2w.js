import{a as E,r as c,s as m,j as l,m as v}from"./index-BbWOTZI-.js";function C(){const{user:t}=E(),[d,u]=c.useState([]),[h,b]=c.useState(!0),[_,p]=c.useState(null),g=c.useRef(!1),y=c.useCallback(async()=>{if(t){b(!0),p(null);try{const{data:o,error:s}=await m.from("finance_categories").select("*").order("name");if(s)throw s;if(o&&o.length>0){const a=new Set,e=[],n=[];for(const r of o){const i=`${r.name}-${r.type}`;a.has(i)?e.push(r):(a.add(i),n.push(r))}if(e.length>0){console.log("Found duplicates, cleaning up...",e);const{error:r}=await m.from("finance_categories").delete().in("id",e.map(i=>i.id));r&&console.error("Error deleting duplicates:",r),u(n);return}}if((!o||o.length===0)&&!g.current){g.current=!0;const a=["Wynagrodzenia","Inwestycje","Prezenty","Inne"],e=["Codzienne","Inne","Oszczędności","Transport","Jedzenie","Płatności","Samorozwój","Zdrowie","Rozrywka","Dom"],n=[...a.map(x=>({name:x,type:"income",user_id:t.id,is_active:!0})),...e.map(x=>({name:x,type:"expense",user_id:t.id,is_active:!0}))],{data:r,error:i}=await m.from("finance_categories").insert(n).select();if(g.current=!1,i)throw i;u(r)}else u(o||[])}catch(o){console.error("Error fetching categories:",o),p(o.message),g.current=!1}finally{b(!1)}}},[t]);return c.useEffect(()=>{y()},[y]),{categories:d,categoriesLoading:h,categoriesError:_,fetchCategories:y,addCategory:async o=>{if(!t)return;const{data:s,error:a}=await m.from("finance_categories").insert({...o,user_id:t.id}).select().single();if(a)throw console.error("Error adding category:",a),a;return u(e=>[...e,s]),s},toggleCategory:async(o,s)=>{if(!t)return;const a=d.find(e=>e.name===o&&e.type===s);if(a){const e=!a.is_active,{data:n,error:r}=await m.from("finance_categories").update({is_active:e}).eq("id",a.id).select().single();if(r)throw console.error("Error toggling category:",r),r;u(i=>i.map(x=>x.id===a.id?n:x))}else{const e={name:o,type:s,is_active:!0,user_id:t.id},{data:n,error:r}=await m.from("finance_categories").insert(e).select().single();if(r)throw console.error("Error creating category:",r),r;u(i=>[...i,n])}}}}function j(){const{user:t}=E(),[d,u]=c.useState([]),[h,b]=c.useState(!0),[_,p]=c.useState(null),g=c.useCallback(async()=>{if(t){b(!0),p(null);try{const{data:f,error:w}=await m.from("finance_budgets").select("*");if(w)throw w;u(f||[])}catch(f){console.error("Error fetching budgets:",f),p(f.message)}finally{b(!1)}}},[t]);return c.useEffect(()=>{g()},[g]),{budgets:d,budgetsLoading:h,budgetsError:_,fetchBudgets:g,saveBudget:async(f,w)=>{if(!t)return;const o=d.find(n=>n.category_id===f),s={user_id:t.id,category_id:f,amount:w,month:new Date().getMonth(),year:new Date().getFullYear()},{data:a,error:e}=await m.from("finance_budgets").upsert(o?{...o,amount:w}:s).select().single();if(e)throw console.error("Error saving budget",e),e;u(n=>[...n.filter(i=>i.category_id!==f),a])}}}function T(t){const{user:d}=E(),[u,h]=c.useState([]),[b,_]=c.useState(!0),[p,g]=c.useState(null),y=c.useCallback(async()=>{if(d){_(!0),g(null);try{const{data:s,error:a}=await m.from("finance_transactions").select("*").order("date",{ascending:!1});if(a)throw a;const e=(s||[]).map(n=>({...n,finance_categories:t.find(r=>r.id===n.category_id)}));h(e)}catch(s){console.error("Error fetching transactions:",s),g(s.message)}finally{_(!1)}}},[d,t]);return c.useEffect(()=>{y()},[y]),{transactions:u,transactionsLoading:b,transactionsError:p,fetchTransactions:y,addTransaction:async s=>{if(!d)return;const{data:a,error:e}=await m.from("finance_transactions").insert({...s,user_id:d.id}).select("*").single();if(e)throw console.error("Error adding transaction:",e),e;const n={...a,finance_categories:t.find(r=>r.id===a.category_id)};return h(r=>[n,...r]),n},deleteTransaction:async s=>{const{error:a}=await m.from("finance_transactions").delete().eq("id",s);if(a)throw a;h(e=>e.filter(n=>n.id!==s))},editTransaction:async(s,a)=>{const{data:e,error:n}=await m.from("finance_transactions").update(a).eq("id",s).select("*").single();if(n)throw console.error("Error editing transaction:",n),n;const r={...e,finance_categories:t.find(i=>i.id===e.category_id)};return h(i=>i.map(x=>x.id===s?r:x)),r}}}function S(){const{categories:t,categoriesLoading:d,categoriesError:u,fetchCategories:h,addCategory:b,toggleCategory:_}=C(),{budgets:p,budgetsLoading:g,budgetsError:y,fetchBudgets:f,saveBudget:w}=j(),{transactions:o,transactionsLoading:s,transactionsError:a,fetchTransactions:e,addTransaction:n,deleteTransaction:r,editTransaction:i}=T(t),x=c.useCallback(async()=>{await Promise.all([h(),f(),e()])},[h,f,e]);return{categories:t,transactions:o,budgets:p,isLoading:d||g||s,error:u||y||a,addCategory:b,toggleCategory:_,addTransaction:n,deleteTransaction:r,editTransaction:i,saveBudget:w,refresh:x}}function z({moneyLeft:t,totalBudget:d}){return l.jsx(v.div,{initial:{opacity:0,x:20},animate:{opacity:1,x:0},transition:{delay:.3},className:"h-full order-3",children:l.jsxs("div",{className:`flex flex-col justify-between items-start lg:items-end lg:text-right\r
                  h-full bg-brand-neutral-dark rounded-xl p-6 border border-brand-depth`,children:[l.jsxs("div",{children:[l.jsx("p",{className:"text-xs text-brand-neutral-light/70 uppercase tracking-wide mb-2",children:"Pozostały budżet"}),l.jsxs("p",{className:`text-4xl font-bold ${t>=0?"text-brand-accent-1":"text-brand-negative"} transition-colors`,children:[t.toFixed(2),l.jsx("span",{className:"text-lg font-normal text-brand-secondary ml-1",children:"PLN"})]})]}),l.jsxs("div",{className:"mt-4",children:[l.jsx("p",{className:"text-xs text-brand-secondary mb-1",children:"Zaplanowany budżet"}),l.jsxs("p",{className:"font-bold text-xl text-brand-neutral-light",children:[d.toFixed(0)," PLN"]})]})]})})}function B({type:t,amount:d}){return l.jsxs(v.div,{initial:{opacity:0,x:-20},animate:{opacity:1,x:0},transition:{delay:.1},className:"bg-brand-neutral-dark p-4 border border-brand-depth rounded-xl",children:[l.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[l.jsx("div",{className:"w-2 h-2 rounded-full",style:{backgroundColor:t==="income"?"var(--color-brand-positive-lighter)":"var(--color-brand-negative)"}}),l.jsx("p",{className:"text-xs text-brand-neutral-light/70 uppercase tracking-wide",children:t==="income"?"Przychody":"Wydatki"})]}),l.jsxs("p",{className:`text-2xl font-bold ${t==="income"?"text-brand-positive-lighter":"text-brand-negative"}`,children:[t==="income"?"+":"-",d.toFixed(2),l.jsx("span",{className:"text-lg font-normal text-brand-secondary ml-1",children:"PLN"})]})]})}export{z as F,B as a,S as u};
