import{j as e,f as I,g as M,h as T,r as c,i as C,k as F,l as E,z as P,D as $,K as B,O as S,Q as G,s as _,a as A}from"./index-DagVn5ui.js";import{C as W,L as w,u as O}from"./LinearMacroProgress-C8ANORAx.js";import{m as y}from"./proxy-DGw4AqAz.js";import{A as k,C as U}from"./ConfirmDeleteDialog-B4nz53wp.js";import{D as q}from"./DateSelector-BUXDpxUc.js";function K({isLoading:a,goalCalories:l,goalProtein:n,goalFat:t,goalCarbs:r,setGoalCalories:o,setGoalProtein:s,setGoalFat:i,setGoalCarbs:x,onClose:m}){return e.jsxs(y.div,{initial:{opacity:0,scale:.95},animate:{opacity:1,scale:1},exit:{opacity:0,scale:.95},transition:{duration:.2},className:"flex flex-col gap-4 sm:gap-2",children:[e.jsx("h3",{className:"text-lg font-semibold text-brand-neutral-light",children:"Edytuj cele"}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-2",children:[e.jsxs("label",{className:"flex flex-col gap-1",children:[e.jsx("span",{className:"text-sm text-brand-secondary",children:"Cel kalorii (kcal)"}),e.jsx("input",{type:"number",min:1,disabled:a,className:`rounded-xl border border-brand-depth bg-brand-neutral-dark px-4 py-3 text-brand-neutral-light focus:ring-2 \r
                    focus:ring-brand-accent-1/40 focus:outline-none disabled:opacity-50`,value:l,onChange:b=>{const u=Number(b.target.value);o(u>0?u:0)}})]}),e.jsxs("label",{className:"flex flex-col gap-1",children:[e.jsx("span",{className:"text-sm text-brand-secondary",children:"Białko (g)"}),e.jsx("input",{type:"number",min:0,disabled:a,className:`rounded-xl border border-brand-depth bg-brand-neutral-dark px-4 py-3 text-brand-neutral-light focus:ring-2 \r
                    focus:ring-brand-accent-1/40 focus:outline-none disabled:opacity-50`,value:n,onChange:b=>s(Number(b.target.value)||0)})]}),e.jsxs("label",{className:"flex flex-col gap-1",children:[e.jsx("span",{className:"text-sm text-brand-secondary",children:"Tłuszcz (g)"}),e.jsx("input",{type:"number",min:0,disabled:a,className:`rounded-xl border border-brand-depth bg-brand-neutral-dark px-4 py-3 text-brand-neutral-light focus:ring-2 \r
                    focus:ring-brand-accent-1/40 focus:outline-none disabled:opacity-50`,value:t,onChange:b=>i(Number(b.target.value)||0)})]}),e.jsxs("label",{className:"flex flex-col gap-1",children:[e.jsx("span",{className:"text-sm text-brand-secondary",children:"Węglowodany (g)"}),e.jsx("input",{type:"number",min:0,disabled:a,className:`rounded-xl border border-brand-depth bg-brand-neutral-dark px-4 py-3 text-brand-neutral-light focus:ring-2 \r
                    focus:ring-brand-accent-1/40 focus:outline-none disabled:opacity-50`,value:r,onChange:b=>x(Number(b.target.value)||0)})]})]}),e.jsx("div",{className:"flex justify-end sm:mt-3",children:e.jsxs("button",{onClick:m,className:"flex items-center gap-2 px-6 py-2 bg-brand-accent-1 text-white rounded-full hover:bg-brand-accent-1/90 transition-colors cursor-pointer",children:[e.jsx(I,{})," Gotowe"]})})]},"edit-form")}function z({label:a,value:l,unit:n,icon:t,type:r}){let o="text-brand-neutral-light",s="bg-brand-neutral-dark";return r==="positive"&&(o="text-brand-positive-lighter"),r==="negative"&&(o="text-brand-negative"),e.jsxs(y.div,{initial:{opacity:0,x:-20},animate:{opacity:1,x:0},transition:{delay:.1},className:`${s} p-4 border border-brand-depth rounded-xl w-full`,children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsx("div",{className:"text-brand-secondary/70 transform scale-83",children:t}),e.jsx("p",{className:"text-xs text-brand-neutral-light/70 uppercase tracking-wide",children:a})]}),e.jsxs("p",{className:`text-2xl font-bold ${o}`,children:[l.toFixed(0),e.jsx("span",{className:"text-lg font-normal text-brand-secondary ml-1",children:n})]})]})}function L({goalCalories:a,totalCalories:l,goalProtein:n,goalFat:t,goalCarbs:r}){return e.jsxs(y.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},transition:{duration:.2},className:"grid grid-cols-1 lg:grid-cols-3 gap-6 lg:gap-0",children:[e.jsxs("div",{className:"flex flex-col gap-4 order-2 lg:order-1 justify-center",children:[e.jsx(z,{label:"Cel dzienny",value:a,unit:"kcal",icon:e.jsx(M,{}),type:"neutral"}),e.jsx(z,{label:"Spożyto",value:l.kcal,unit:"kcal",icon:e.jsx(T,{}),type:l.kcal>a?"negative":"positive"})]}),e.jsx(y.div,{initial:{scale:.9,opacity:0},animate:{scale:1,opacity:1},transition:{type:"spring",duration:.8},className:"order-1 lg:order-2 lg:-mt-16 overflow-visible flex items-center justify-center pointer-events-none",children:e.jsx(W,{consumed:l.kcal,goal:a})}),e.jsx(y.div,{initial:{opacity:0,x:20},animate:{opacity:1,x:0},transition:{delay:.3},className:"h-full order-3 flex flex-col justify-center",children:e.jsxs("div",{className:"bg-brand-neutral-dark rounded-xl p-4 border border-brand-depth flex flex-col gap-3.5",children:[e.jsx("p",{className:"text-xs text-brand-secondary uppercase tracking-wider mb-2",children:"Makroskladniki"}),e.jsx(w,{label:"Białko",value:l.protein,goal:n,color:"var(--color-brand-primary)"}),e.jsx(w,{label:"Tłuszcz",value:l.fat,goal:t,color:"var(--color-brand-accent-1)"}),e.jsx(w,{label:"Węgle",value:l.carbs,goal:r,color:"var(--color-brand-accent-2)"})]})})]},"stats-view")}const R=({goalCalories:a,totalCalories:l,goalProtein:n,goalFat:t,goalCarbs:r,setGoalCalories:o,setGoalProtein:s,setGoalFat:i,setGoalCarbs:x,isLoading:m})=>{const[b,u]=c.useState(!1);return e.jsxs("div",{className:"bg-brand-neutral-dark/40 border border-brand-depth rounded-2xl p-6 relative",children:[e.jsx("div",{className:"absolute top-4 right-4 z-10",children:e.jsx("button",{onClick:()=>u(!b),className:"p-2 rounded-full hover:bg-brand-neutral-dark/80 text-brand-secondary hover:text-brand-accent-1 transition-colors flex items-center justify-center cursor-pointer",title:b?"Zamknij edycję":"Edytuj cele",disabled:m,children:b?e.jsx(C,{}):e.jsx(F,{})})}),e.jsx(k,{mode:"wait",children:b?e.jsx(K,{isLoading:m,goalCalories:a,goalProtein:n,goalFat:t,goalCarbs:r,setGoalCalories:o,setGoalProtein:s,setGoalFat:i,setGoalCarbs:x,onClose:()=>u(!1)}):e.jsx(L,{goalCalories:a,totalCalories:l,goalProtein:n,goalFat:t,goalCarbs:r})})]})};function Q({protein:a,fat:l,carbs:n}){const t=a*4,r=l*9,o=n*4,s=Math.max(1e-6,t+r+o),i=t/s*100,x=r/s*100,m=o/s*100;return e.jsxs("div",{className:"h-4 w-full rounded-full bg-brand-neutral-dark overflow-hidden flex",children:[e.jsx("div",{className:"h-full bg-brand-primary",style:{width:`${i}%`},title:`Białko ${a.toFixed(1)}g`}),e.jsx("div",{className:"h-full bg-brand-accent-1",style:{width:`${x}%`},title:`Tłuszcz ${l.toFixed(1)}g`}),e.jsx("div",{className:"h-full bg-brand-accent-2",style:{width:`${m}%`},title:`Węglowodany ${n.toFixed(1)}g`})]})}const Z=({isOpen:a,onClose:l,entry:n,onSave:t})=>{const[r,o]=c.useState(n.name),[s,i]=c.useState(n.kcal),[x,m]=c.useState(n.protein),[b,u]=c.useState(n.fat),[d,j]=c.useState(n.carbs),[p,v]=c.useState(n.grams);c.useEffect(()=>{a&&(o(n.name),i(n.kcal),m(n.protein),u(n.fat),j(n.carbs),v(n.grams))},[n,a]);const f=g=>{g.preventDefault(),t(n.id,{name:r,kcal:Number(s),protein:Number(x),fat:Number(b),carbs:Number(d),grams:Number(p)}),l()};return e.jsxs(E,{open:a,onClose:l,className:"relative z-50",children:[e.jsx("div",{className:"fixed inset-0 bg-brand-neutral-darker/70 backdrop-blur-sm","aria-hidden":"true"}),e.jsx("div",{className:"fixed inset-0 flex items-center justify-center p-4",children:e.jsxs(P,{className:"w-full max-w-sm rounded-2xl bg-brand-neutral-dark border border-brand-depth p-6 shadow-xl",children:[e.jsxs("div",{className:"flex justify-between items-center mb-4",children:[e.jsx("h3",{className:"text-lg font-bold text-brand-neutral-light",children:"Edytuj wpis"}),e.jsx("button",{onClick:l,className:`flex items-center justify-center text-brand-neutral-light/60 hover:text-brand-neutral-light \r
                  hover:bg-brand-neutral-light/10 rounded-full p-1 transition-colors cursor-pointer`,children:e.jsx(C,{})})]}),e.jsxs("form",{onSubmit:f,className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-brand-neutral-light/80 mb-1",children:"Nazwa"}),e.jsx("input",{type:"text",value:r,onChange:g=>o(g.target.value),className:"w-full px-3 py-2 bg-brand-neutral-dark/40 border border-brand-depth rounded-xl text-brand-neutral-light focus:outline-none focus:border-brand-primary",required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-brand-neutral-light/80 mb-1",children:"Ilość"}),e.jsx("input",{type:"number",value:p,onChange:g=>{const N=Number(g.target.value);if(v(N),n.grams>0){const h=N/n.grams;i(Math.round(n.kcal*h)),m(Math.round(n.protein*h*10)/10),u(Math.round(n.fat*h*10)/10),j(Math.round(n.carbs*h*10)/10)}},className:"w-full px-3 py-2 bg-brand-neutral-dark/40 border border-brand-depth rounded-xl text-brand-neutral-light focus:outline-none focus:border-brand-primary",required:!0})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-brand-neutral-light/80 mb-1",children:"Kcal"}),e.jsx("input",{type:"number",value:s,onChange:g=>i(Number(g.target.value)),className:"w-full px-3 py-2 bg-brand-neutral-dark/40 border border-brand-depth rounded-xl text-brand-neutral-light focus:outline-none focus:border-brand-primary"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-brand-neutral-light/80 mb-1",children:"Białko (g)"}),e.jsx("input",{type:"number",value:x,onChange:g=>m(Number(g.target.value)),className:"w-full px-3 py-2 bg-brand-neutral-dark/40 border border-brand-depth rounded-xl text-brand-neutral-light focus:outline-none focus:border-brand-primary"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-brand-neutral-light/80 mb-1",children:"Tłuszcz (g)"}),e.jsx("input",{type:"number",value:b,onChange:g=>u(Number(g.target.value)),className:"w-full px-3 py-2 bg-brand-neutral-dark/40 border border-brand-depth rounded-xl text-brand-neutral-light focus:outline-none focus:border-brand-primary"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-brand-neutral-light/80 mb-1",children:"Węgle (g)"}),e.jsx("input",{type:"number",value:d,onChange:g=>j(Number(g.target.value)),className:"w-full px-3 py-2 bg-brand-neutral-dark/40 border border-brand-depth rounded-xl text-brand-neutral-light focus:outline-none focus:border-brand-primary"})]})]}),e.jsx("div",{className:"pt-2",children:e.jsx("button",{type:"submit",className:"w-full py-2 bg-brand-accent-2 rounded-xl text-brand-neutral-light font-bold hover:bg-brand-accent-2/70 transition-all cursor-pointer",children:"Zapisz"})})]})]})})]})},J=({entry:a,removeEntry:l,onEdit:n})=>{const[t,r]=c.useState(!1),[o,s]=c.useState(!1);return e.jsxs(e.Fragment,{children:[e.jsx(y.li,{layout:!0,initial:{opacity:0,y:-10},animate:{opacity:1,y:0},exit:{opacity:0,x:-20},transition:{duration:.2},className:"flex flex-col sm:flex-row sm:items-start sm:justify-between p-3 gap-3 bg-brand-neutral-dark/40 rounded-lg group",children:e.jsxs("div",{className:"min-w-0 flex-1",children:[e.jsxs("div",{className:"flex justify-between gap-2",children:[e.jsx("p",{className:"text-brand-neutral-light",children:a.name}),e.jsxs("div",{className:"flex gap-1 opacity-100 sm:opacity-0 group-hover:opacity-100 transition-opacity",children:[e.jsx("button",{onClick:()=>s(!0),className:`flex sm:w-auto h-fit items-center justify-center rounded-full p-0.5 text-sm text-brand-neutral-light/60\r
                        hover:text-brand-neutral-light hover:bg-brand-neutral-light/10\r
                        transition-colors duration-200 cursor-pointer`,title:"Edytuj",children:e.jsx(F,{className:"scale-75"})}),e.jsx("button",{onClick:()=>r(!0),className:`flex sm:w-auto h-fit items-center justify-center rounded-full p-0.5 text-sm text-brand-neutral-light \r
                        hover:bg-red-800/20 hover:border-red-500/30 hover:text-red-400\r
                        transition-colors duration-200 cursor-pointer`,title:"Usuń",children:e.jsx($,{className:"scale-75"})})]})]}),e.jsx("div",{className:"mt-2 w-full",children:e.jsx(Q,{protein:a.protein,fat:a.fat,carbs:a.carbs})}),e.jsx("div",{className:"h-px bg-brand-neutral-light/20 mt-2"}),e.jsxs("div",{className:"mt-2 grid grid-cols-2 gap-2 text-sm text-brand-secondary",children:[e.jsxs("span",{className:"font-semibold bg-brand-accent-3/90 text-brand-neutral-light px-2 rounded-xl text-center",children:[a.kcal," kcal"]}),e.jsxs("span",{className:"font-semibold bg-brand-primary/90 text-brand-neutral-light px-2 rounded-xl text-center",children:["B: ",a.protein.toFixed(1),"g"]}),e.jsxs("span",{className:"font-semibold bg-brand-accent-1/90 text-brand-neutral-light px-2 rounded-xl text-center",children:["T: ",a.fat.toFixed(1),"g"]}),e.jsxs("span",{className:"font-semibold bg-brand-accent-2/90 text-brand-neutral-light px-2 rounded-xl text-center",children:["W: ",a.carbs.toFixed(1),"g"]})]})]})}),e.jsx(U,{isOpen:t,onClose:()=>r(!1),onConfirm:()=>l(a.id),description:e.jsxs("p",{children:["Czy na pewno chcesz usunąć"," ",e.jsx("strong",{className:"text-brand-neutral-light",children:a.name}),"? Tej akcji nie można cofnąć."]})}),e.jsx(Z,{isOpen:o,onClose:()=>s(!1),entry:a,onSave:n})]})},V=({entries:a,removeEntry:l,isLoading:n,onEdit:t})=>e.jsxs("div",{className:"flex flex-col flex-1 min-h-0",children:[e.jsx("div",{className:"flex items-end lg:justify-end",children:e.jsx("h2",{className:"glass-header text-lg rounded-t-xl py-2 px-4",children:"Historia posiłków"})}),e.jsx(y.section,{layout:!0,className:"glass-panel rounded-b-2xl rounded-tr-2xl lg:rounded-tr-none lg:rounded-tl-2xl p-4 flex-1 min-h-0 overflow-y-auto",children:e.jsx("div",{className:"h-full flex flex-col",children:n?e.jsx(y.div,{animate:{rotate:360},transition:{repeat:1/0,duration:1.3,ease:"linear"},className:"w-5 h-5 border-2 border-white/30 border-t-white rounded-full"}):a.length===0?e.jsx("p",{className:"mt-4 text-brand-secondary",children:"Nic dziś jeszcze nie dodano. Dodaj pierwszy produkt na panelu obok."}):e.jsx("ul",{className:"divide-y divide-brand-depth/70 space-y-2",children:e.jsx(k,{children:a.map(r=>e.jsx(J,{entry:r,removeEntry:l,onEdit:t},r.id))})})})})]}),D=({isOpen:a,onClose:l,onSubmit:n,foodHit:t,onGramsChange:r})=>{const[o,s]=c.useState(1),[i,x]=c.useState("grams");c.useEffect(()=>{a&&t&&(t.servingSize?(x("serving"),s(1),r(t.servingSize)):(x("grams"),s(100),r(100)))},[a,t?.id]);const m=u=>{s(u),i==="serving"&&t?.servingSize?r(u*t.servingSize):r(u)},b=()=>{i==="grams"&&t?.servingSize?(x("serving"),s(1),r(t.servingSize)):(x("grams"),s(100),r(100))};return e.jsx(B,{show:a,as:c.Fragment,children:e.jsxs(E,{as:"div",className:"relative z-40",onClose:l,children:[e.jsx(S,{as:c.Fragment,enter:"transition-opacity ease-linear duration-300",enterFrom:"opacity-0",enterTo:"opacity-100",leave:"transition-opacity ease-linear duration-300",leaveFrom:"opacity-100",leaveTo:"opacity-0",children:e.jsx("div",{className:"fixed inset-0 bg-brand-neutral-dark/80"})}),e.jsx("div",{className:"fixed inset-0 flex items-end justify-center",children:e.jsx(S,{as:c.Fragment,enter:"transition ease-in-out duration-300 transform",enterFrom:"translate-y-full",enterTo:"translate-y-0",leave:"transition ease-in-out duration-300 transform",leaveFrom:"translate-y-0",leaveTo:"translate-y-full",children:e.jsx(P,{className:`w-full max-w-md transform overflow-hidden rounded-t-xl bg-brand-neutral-dark p-6 text-left \r
                          align-middle shadow-xl transition-all border-t border-brand-depth`,children:t&&e.jsxs(e.Fragment,{children:[e.jsx(G,{as:"h3",className:"text-lg font-medium leading-6 text-brand-neutral-light",children:"Dodaj produkt"}),e.jsxs("form",{onSubmit:n,className:"mt-4",children:[e.jsxs("div",{className:"rounded-lg border border-brand-depth p-3",children:[e.jsx("p",{className:"text-brand-neutral-light truncate",children:t.name}),e.jsxs("p",{className:"text-sm text-brand-secondary",children:[t.brand??"—"," • ",t.kcalPer100g," kcal / 100g"]})]}),e.jsxs("div",{className:"mt-4",children:[e.jsxs("div",{className:"flex justify-between items-center mb-2",children:[e.jsxs("label",{htmlFor:"amount",className:"block text-sm font-medium text-brand-secondary",children:["Ilość"," ",i==="serving"?`(${t.servingUnit||"porcji"})`:"(g)"]}),t.servingSize&&e.jsx("button",{type:"button",onClick:b,className:"text-xs text-brand-accent-1 hover:underline hover:cursor-pointer",children:i==="grams"?"Przełącz na porcje":"Przełącz na gramy"})]}),e.jsx("input",{id:"amount",type:"number",min:1,step:i==="serving"?.5:1,className:`mt-1 w-full rounded-md border border-brand-depth bg-brand-neutral-dark px-3 py-2 \r
                                text-brand-neutral-light focus:outline-none focus:ring-2 focus:ring-brand-accent-1/40\r
                                transition-focus duration-300`,value:o,onChange:u=>m(Number(u.target.value))}),i==="serving"&&t.servingSize&&e.jsxs("p",{className:"text-xs text-brand-secondary mt-1 text-left",children:[o," x ",t.servingSize,"g ="," ",Math.round(o*t.servingSize),"g"]})]}),e.jsxs("div",{className:"mt-6 flex gap-3",children:[e.jsx("button",{type:"button",className:`flex-1 justify-center rounded-md border border-brand-secondary px-4 py-2 text-sm font-medium \r
                                text-brand-secondary hover:bg-brand-secondary/10 focus:outline-none focus-visible:ring-2 focus-visible:ring-brand-accent-1/40`,onClick:l,children:"Anuluj"}),e.jsx("button",{type:"submit",disabled:t.grams<=0,className:`flex-1 justify-center rounded-md bg-brand-accent-1 px-4 py-2 text-sm font-semibold \r
                                text-brand-neutral-dark hover:bg-brand-accent-1/80 focus:outline-none focus-visible:ring-2 focus-visible:ring-brand-accent-1/40 disabled:bg-brand-secondary`,children:"Dodaj"})]})]})]})})})})]})})},X=({query:a,setQuery:l,loading:n,error:t,localHits:r,addEntryFromFood:o})=>{const[s,i]=c.useState(null),x=d=>i({...d,grams:d.grams>0?d.grams:100}),m=()=>{i(null)},b=d=>{d.preventDefault(),s&&s.grams>0&&(o(s,s.grams),m())},u=d=>{s&&i({...s,grams:d})};return e.jsxs(e.Fragment,{children:[e.jsxs(y.div,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},exit:{opacity:0,y:-10},transition:{duration:.2},className:"bg-brand-neutral-dark/40 rounded-xl rounded-tl-none",children:[e.jsx("div",{className:"px-3 pt-4 pb-4",children:e.jsx("input",{type:"text",placeholder:"Szukaj produktu...",value:a,onChange:d=>l(d.target.value),className:`w-full border border-brand-depth bg-brand-neutral-dark px-3 py-2 text-brand-neutral-light\r
                  placeholder-brand-secondary focus:ring-2 focus:ring-brand-accent-1/40 focus:outline-none rounded-lg`})}),e.jsx(k,{children:r.length>0&&e.jsx(y.ul,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:"divide-y divide-white/10 rounded-lg border border-white/10 max-h-94 overflow-y-scroll",children:r.map(d=>d.kcalPer100g!=null&&e.jsxs(y.li,{layout:!0,initial:{opacity:0,y:-10},animate:{opacity:1,y:0},exit:{opacity:0,x:-20},transition:{duration:.2},onClick:()=>x(d),className:"group p-3 flex items-center gap-3 hover:bg-brand-depth/20 transition cursor-pointer",children:[d.imageUrl&&e.jsx("img",{src:d.imageUrl,alt:d.name,className:"h-10 w-10 rounded object-cover"}),e.jsxs("div",{className:"min-w-0 flex-1",children:[e.jsxs("p",{className:"text-brand-neutral-light",children:[d.brand&&e.jsxs("span",{children:[e.jsx("span",{className:"text-brand-secondary",children:d.brand}),e.jsx("span",{className:"text-brand-neutral-light mx-1",children:"•"})]}),d.name]}),e.jsxs("p",{className:"text-sm text-brand-secondary",children:[d.kcalPer100g?`${d.kcalPer100g} kcal / 100g`:"brak danych"," ",d.proteinPer100g!=null&&`| ${d.proteinPer100g}g białka`," ",d.fatPer100g!=null&&`| ${d.fatPer100g}g tłuszczu`," ",d.carbsPer100g!=null&&`| ${d.carbsPer100g}g węglowodanów`]})]})]},d.listId))})}),r.length===0&&n===!1&&a!==""&&t===null&&e.jsx("p",{className:"m-2 text-brand-secondary",children:"Brak wyników"}),n&&e.jsx("p",{className:"m-2 text-brand-secondary",children:"Szukam w internecie..."}),t&&e.jsxs("p",{className:"m-2 text-brand-warning",children:["Błąd: ",t]})]},"search"),e.jsx(D,{isOpen:s!==null,onClose:m,onSubmit:b,foodHit:s,onGramsChange:u})]})},Y=({customEntry:a,handleCustomEntryChange:l,handleCustomEntrySubmit:n})=>{const[t,r]=c.useState("grams"),[o,s]=c.useState(!1),[i,x]=c.useState(""),[m,b]=c.useState(0),[u,d]=c.useState(100);c.useEffect(()=>{if(t==="grams")l({target:{name:"grams",value:u.toString()}});else{const p=u*m;l({target:{name:"grams",value:p.toString()}})}},[t,u,m]);const j=p=>{p.preventDefault(),n(p,o?{servingName:i,servingWeight:m}:void 0)};return e.jsx(y.div,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},exit:{opacity:0,y:-10},transition:{duration:.2},className:"overflow-y-auto",children:e.jsxs("form",{onSubmit:j,className:"p-4 bg-brand-neutral-dark/50 rounded-b-xl",children:[e.jsxs("div",{className:"flex gap-2 mb-4 p-1 bg-brand-neutral-dark rounded-lg border border-brand-depth",children:[e.jsx("button",{type:"button",onClick:()=>r("grams"),className:`flex-1 py-1 px-3 rounded-md text-sm font-medium transition-colors ${t==="grams"?"bg-brand-accent-1 text-brand-neutral-dark":"text-brand-secondary hover:text-brand-neutral-light hover:cursor-pointer"}`,children:"Na 100g"}),e.jsx("button",{type:"button",onClick:()=>r("serving"),className:`flex-1 py-1 px-3 rounded-md text-sm font-medium transition-colors ${t==="serving"?"bg-brand-accent-1 text-brand-neutral-dark":"text-brand-secondary hover:text-brand-neutral-light hover:cursor-pointer"}`,children:"Na porcję"})]}),e.jsxs("div",{className:"grid gap-3 sm:grid-cols-2",children:[e.jsx("input",{name:"name",className:`rounded-md border border-brand-depth bg-brand-neutral-dark px-3 py-2 text-brand-neutral-light \r
                    placeholder-brand-secondary focus:outline-none focus:ring-2 focus:ring-brand-accent-1/40 sm:col-span-2\r
                      transition-outline duration-300`,placeholder:"Nazwa produktu*",value:a.name,onChange:l,required:!0}),t==="serving"&&e.jsxs("div",{className:"sm:col-span-2 grid grid-cols-2 gap-3 p-3 rounded-lg border border-brand-depth/50 bg-brand-neutral-dark/30",children:[e.jsxs("label",{className:"flex flex-col text-sm text-brand-neutral-light",children:["Nazwa porcji*",e.jsx("input",{type:"text",placeholder:"porcja",className:`mt-1 rounded-md border border-brand-depth bg-brand-neutral-dark px-2 py-1 text-brand-neutral-light focus:ring-2 \r
                          focus:ring-brand-accent-1/40 focus:outline-none transition-outline duration-300`,value:i,onChange:p=>x(p.target.value),required:!0})]}),e.jsxs("label",{className:"flex flex-col text-sm text-brand-neutral-light",children:["Waga porcji (g)*",e.jsx("input",{type:"number",min:1,className:`mt-1 rounded-md border border-brand-depth bg-brand-neutral-dark px-2 py-1 text-brand-neutral-light focus:ring-2 \r
                          focus:ring-brand-accent-1/40 focus:outline-none transition-outline duration-300`,value:m||"100",onChange:p=>b(Number(p.target.value)),required:!0})]})]}),e.jsxs("div",{className:"sm:col-span-2",children:[e.jsxs("label",{className:"flex flex-col text-sm text-brand-neutral-light",children:[t==="grams"?"Ilość (g)":`Ilość (${i||"porcji"})`,e.jsx("input",{type:"number",min:0,step:t==="serving"?.5:1,className:`mt-1 w-full rounded-md border border-brand-depth bg-brand-neutral-dark px-3 py-2 text-brand-neutral-light focus:ring-2 \r
                        focus:ring-brand-accent-1/40 focus:outline-none transition-outline duration-300`,value:u,onChange:p=>d(Number(p.target.value))})]}),t==="serving"&&m>0&&e.jsxs("p",{className:"text-xs text-brand-secondary mt-1 text-left",children:[u," x ",m,"g = ",u*m,"g"]})]}),e.jsxs("div",{className:"",children:[e.jsxs("label",{className:"flex flex-col text-sm text-brand-neutral-light",children:["Węglowodany (na 100g)",e.jsx("input",{name:"carbs",type:"number",min:0,className:`mt-1 rounded-md border border-brand-depth bg-brand-neutral-dark px-2 py-1 text-brand-neutral-light focus:ring-2 \r
                        focus:ring-brand-accent-1/40 focus:outline-none transition-outline duration-300`,value:a.carbs,onChange:l})]}),e.jsxs("label",{className:"flex flex-col text-sm text-brand-neutral-light",children:["Białko (na 100g)",e.jsx("input",{name:"protein",type:"number",min:0,className:`mt-1 rounded-md border border-brand-depth bg-brand-neutral-dark px-2 py-1 text-brand-neutral-light focus:ring-2 \r
                        focus:ring-brand-accent-1/40 focus:outline-none transition-outline duration-300`,value:a.protein,onChange:l})]}),e.jsxs("label",{className:"flex flex-col text-sm text-brand-neutral-light",children:["Tłuszcz (na 100g)",e.jsx("input",{name:"fat",type:"number",min:0,className:`mt-1 rounded-md border border-brand-depth bg-brand-neutral-dark px-2 py-1 text-brand-neutral-light focus:ring-2 \r
                        focus:ring-brand-accent-1/40 focus:outline-none transition-outline duration-300`,value:a.fat,onChange:l})]})]}),e.jsx("div",{className:"",children:e.jsxs("label",{className:"flex flex-col text-sm text-brand-neutral-light",children:["Kalorie (na 100g)",e.jsx("input",{name:"kcal",type:"number",min:0,className:`mt-1 rounded-md border border-brand-depth bg-brand-neutral-dark px-2 py-1 text-brand-neutral-light focus:ring-2 \r
                        focus:ring-brand-accent-1/40 focus:outline-none transition-outline duration-300`,value:a.kcal,onChange:l})]})})]}),e.jsxs("div",{className:"mt-4 flex items-center gap-2",children:[e.jsx("input",{type:"checkbox",id:"saveToMyFoods",checked:o,onChange:p=>s(p.target.checked),className:"rounded border-brand-depth bg-brand-neutral-dark text-brand-accent-1 focus:ring-brand-accent-1/40"}),e.jsx("label",{htmlFor:"saveToMyFoods",className:"text-sm text-brand-neutral-light select-none cursor-pointer",children:"Zapisz do moich produktów"})]}),e.jsx("div",{className:"mt-4",children:e.jsx("button",{type:"submit",className:`w-full rounded-md bg-brand-accent-1 px-4 py-2 font-semibold text-brand-neutral-dark hover:bg-brand-accent-1/80 \r
                      transition duration-300 cursor-pointer`,children:"Dodaj"})})]})},"custom")};function H(a){const[l,n]=c.useState(!1),[t,r]=c.useState([]),[o,s]=c.useState(null);return c.useEffect(()=>{let i=!1;async function x(){if(!a){r([]),s(null);return}n(!0),s(null);try{const m="https://uknexpaqqpakwbwpbhpz.supabase.co/functions",b=new URL(`${m}/v1/get-food-by-barcode`);b.searchParams.set("barcode",a);const u=await fetch(b.toString());if(!u.ok){const j=await u.json();throw new Error(j.error||`HTTP ${u.status}`)}const d=await u.json();i||r(d.items??[])}catch(m){i||s(m.message)}finally{i||n(!1)}}return x(),()=>{i=!0}},[a]),{loading:l,hits:t,error:o,setHits:r}}const ee=({addEntryFromFood:a})=>{const[l,n]=c.useState(""),[t,r]=c.useState(""),[o,s]=c.useState(null),[i,x]=c.useState(!1),{loading:m,hits:b,error:u,setHits:d}=H(t),[j,p]=c.useState(null);c.useEffect(()=>{if(u){p(u),s(null);return}if(b.length>0){const h=b[0];h.kcalPer100g!=null?(s({...h,id:h.sourceId||"result",listId:"scanner",grams:100}),x(!0),p(null)):(s(null),p(`"${h.name}" nie zawiera danych o kaloriach.`))}else s(null),t&&!m&&p("Nie znaleziono produktu o podanym kodzie.")},[b,u,t,m]);const v=()=>{r(""),n(""),s(null),d([]),x(!1),p(null)},f=h=>{h.preventDefault(),p(null),l&&r(l)},g=h=>{h.preventDefault(),o&&o.grams>0&&(a(o,o.grams),v())},N=h=>{o&&s({...o,grams:h})};return e.jsxs(e.Fragment,{children:[e.jsxs(y.div,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},exit:{opacity:0,y:-10},transition:{duration:.2},className:"pt-4 px-4 bg-brand-neutral-dark/50 rounded-xl rounded-tl-none",children:[m?e.jsx("p",{className:"text-center text-brand-secondary",children:"Szukam..."}):e.jsxs("form",{onSubmit:f,children:[e.jsx("input",{type:"text",placeholder:"Wpisz numer kodu kreskowego...",value:l,onChange:h=>n(h.target.value),className:`mt-1 w-full rounded-md border border-brand-depth bg-brand-neutral-dark px-3 py-2 text-brand-neutral-light \r
                         placeholder-brand-secondary focus:ring-2 focus:ring-brand-accent-1/40 focus:outline-none`}),e.jsx("button",{type:"submit",className:`mt-3 w-full rounded-md bg-brand-primary px-4 py-2 font-semibold text-brand-neutral-light\r
                         hover:bg-brand-primary/80 transition duration-300 cursor-pointer disabled:bg-brand-secondary`,disabled:!l||m,children:"Szukaj ręcznie"})]}),j&&e.jsx("p",{className:"mt-4 text-center text-brand-warning font-semibold T",children:j}),e.jsx("div",{className:"h-4"})]},"scan"),e.jsx(D,{isOpen:i,onClose:v,onSubmit:g,foodHit:o,onGramsChange:N})]})};function ae(a){const[l,n]=c.useState(!1),[t,r]=c.useState([]),[o,s]=c.useState(null);return c.useEffect(()=>{let i=!1;async function x(){if(!a||a.length<2){r([]);return}n(!0),s(null);try{const{data:b,error:u}=await _.from("foods").select("*").ilike("name",`%${a}%`).limit(15);if(u)throw u;const d=(b||[]).map(g=>({id:g.id,name:g.name,brand:g.brand,kcalPer100g:g.kcal_per_100g,proteinPer100g:g.protein_g_per_100g,fatPer100g:g.fat_g_per_100g,carbsPer100g:g.carbs_g_per_100g,imageUrl:g.image_url,sourceId:g.source_id,servingSize:g.serving_size_g,servingUnit:g.serving_unit}));i||r(d);const j="https://uknexpaqqpakwbwpbhpz.supabase.co/functions",p=new URL(`${j}/v1/search-food`);p.searchParams.set("q",a);const v=await fetch(p);let f=[];if(v.ok?f=(await v.json()).items??[]:console.warn("OFF search failed",v.status),!i){const g=new Set(d.map(h=>h.sourceId).filter(Boolean)),N=f.filter(h=>!h.sourceId||!g.has(h.sourceId));r([...d,...N])}}catch(b){i||s(b.message)}finally{i||n(!1)}}const m=setTimeout(x,333);return()=>{i=!0,clearTimeout(m)}},[a]),{loading:l,hits:t,error:o}}function te(a,l){const[n,t]=c.useState(a);function r(s){const{name:i,value:x}=s.target;t(m=>({...m,[i]:i==="name"?x:Number(x)}))}async function o(s,i){s.preventDefault(),await l(n,i)&&t({name:"",kcal:0,grams:100,protein:0,fat:0,carbs:0})}return{customEntry:n,handleCustomEntryChange:r,handleCustomEntrySubmit:o}}function ne({addEntryFromFood:a,addCustomEntry:l}){const[n,t]=c.useState("custom"),[r,o]=c.useState(""),{loading:s,hits:i,error:x}=ae(r),m=c.useMemo(()=>i.map(f=>({...f,listId:(f.sourceId??"")+f.name+(f.id??""),grams:100})),[i]),[b,u]=c.useState(m);c.useEffect(()=>{u(m)},[m]);const{customEntry:d,handleCustomEntryChange:j,handleCustomEntrySubmit:p}=te({name:"",kcal:0,grams:100,protein:0,fat:0,carbs:0},l),v=f=>`glass-header text-sm sm:text-base py-2 px-4 rounded-t-xl transition-all relative ${n===f?"bg-brand-neutral-dark/70 z-11 border-b-0":"opacity-70 hover:opacity-100 hover:bg-brand-neutral-dark/60"}`;return e.jsxs("div",{className:"flex-1 flex flex-col min-h-0",children:[e.jsxs("div",{className:"flex items-end gap-2",children:[e.jsx("button",{onClick:()=>t("search"),className:v("search"),children:"Wyszukaj"}),e.jsx("button",{onClick:()=>t("custom"),className:v("custom"),children:"Dodaj własny"}),e.jsx("button",{onClick:()=>t("scan"),className:v("scan"),children:"Skanuj"})]}),e.jsx(y.div,{className:`glass-panel rounded-xl rounded-tl-none flex-1 \r
              flex flex-col min-h-0 relative z-0`,children:e.jsx(k,{mode:"wait",children:n==="search"?e.jsx(X,{query:r,setQuery:o,loading:s,error:x,localHits:b,addEntryFromFood:a},"search"):n==="custom"?e.jsx(Y,{customEntry:d,handleCustomEntryChange:j,handleCustomEntrySubmit:p},"custom"):e.jsx(ee,{addEntryFromFood:a},"scan")})})]})}function de(){const{user:a}=A(),[l,n]=c.useState(new Date),{entries:t,isLoading:r,goals:o,totalCalories:s,addEntryFromFood:i,addCustomEntry:x,removeEntry:m,editEntry:b,updateGoal:u}=O(a,l),d=f=>u("calories",f),j=f=>u("protein",f),p=f=>u("fat",f),v=f=>u("carbs",f);return e.jsxs(y.div,{initial:{opacity:0},animate:{opacity:1},transition:{duration:.5},className:"py-6 lg:p-8 mx-auto space-y-3 lg:h-[calc(100vh)] flex flex-col",children:[e.jsx("div",{className:"flex flex-col sm:flex-row items-center justify-between gap-3",children:e.jsx(q,{selectedDate:l,onDateChange:n,format:"day"})}),e.jsx(R,{goalCalories:o.calories,totalCalories:s,goalProtein:o.protein,goalFat:o.fat,goalCarbs:o.carbs,setGoalCalories:d,setGoalProtein:j,setGoalFat:p,setGoalCarbs:v,isLoading:r}),e.jsxs("div",{className:"flex-1 grid grid-cols-1 lg:grid-cols-2 gap-8 min-h-0",children:[e.jsx(V,{entries:t,removeEntry:m,isLoading:r,onEdit:b}),e.jsx(ne,{addEntryFromFood:i,addCustomEntry:x})]})]})}export{de as default};
