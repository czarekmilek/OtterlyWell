import{j as e,n as D,r as o,i as S,R as z,D as M,S as _,o as I}from"./index-DagVn5ui.js";import{T as O,u as A,A as $}from"./TaskColumn-CGZ9R5S6.js";import{m}from"./proxy-DGw4AqAz.js";import{A as C}from"./ConfirmDeleteDialog-B4nz53wp.js";import{C as E}from"./CustomSelect-DHJIQ-aN.js";import{D as R}from"./DateSelector-BUXDpxUc.js";function F({tasks:r,categories:a,onComplete:l,currentDate:n,onDismiss:d,onEdit:u}){const h=()=>{const c=a.length,s="grid gap-4 auto-rows-fr grid-cols-1 sm:grid-cols-2";return c===1?`${s} xl:grid-cols-3 xl:h-full`:c===2?`${s} xl:grid-cols-2 xl:h-full`:c===3?`${s} xl:grid-cols-3 xl:h-full`:c>=7?`${s} xl:grid-cols-3 2xl:grid-cols-4`:`${s} xl:grid-cols-3 2xl:grid-cols-4 xl:h-full`};return e.jsx("div",{className:"h-full overflow-y-auto",children:e.jsx("div",{className:h(),children:a.map(c=>{const s=r.filter(x=>x.category_id===c.id),b=a.length===1?"h-full xl:col-span-2":"h-full";return e.jsx("div",{className:b,children:e.jsx(O,{category:c,tasks:s,allCategories:a,onComplete:l,onDismiss:d,onEdit:u,currentDate:n})},c.id)})})})}function H({name:r,isActive:a,isDeleteMode:l,onToggle:n,onDelete:d}){return e.jsxs("div",{className:"flex items-center justify-between p-3 bg-brand-neutral-dark/30 rounded-xl border border-brand-depth/50",children:[e.jsx("div",{className:"flex items-center gap-3",children:e.jsx("span",{className:"font-medium text-sm md:text-base text-brand-neutral-light",children:r})}),e.jsx("div",{className:"flex items-center gap-3",children:l?e.jsx("button",{onClick:d,className:`p-3 h-4 text-brand-negative hover:text-brand-negative/80 transition-colors flex items-center justify-center \r
                    rounded-md hover:bg-brand-negative/10 cursor-pointer`,title:"Delete Category",children:e.jsx(D,{className:"!text-[20px]"})}):e.jsx("button",{onClick:()=>n(!a),className:`relative w-12 h-6 rounded-full transition-colors duration-200 ease-in-out cursor-pointer ${a?"bg-brand-accent-1":"bg-brand-neutral-dark"}`,children:e.jsx(m.div,{initial:!1,animate:{x:a?26:7},className:"absolute top-1 w-4 h-4 rounded-full bg-white shadow-sm"})})})]})}function B({onAdd:r,onCancel:a}){const[l,n]=o.useState(""),d=u=>{u.preventDefault(),l.trim()&&(r(l),n(""))};return e.jsxs("form",{onSubmit:d,className:"mt-2 flex flex-col sm:flex-row gap-2",children:[e.jsx("input",{value:l,onChange:u=>n(u.target.value),placeholder:"Nazwa kategorii...",className:`flex-1 px-4 py-2 bg-brand-neutral-dark/40 border border-brand-depth rounded-xl \r
                       text-brand-neutral-light focus:outline-none focus:border-brand-primary`,autoFocus:!0}),e.jsx("button",{type:"submit",className:`bg-brand-primary px-4 py-2 rounded-xl text-brand-neutral-light font-bold\r
                  hover:bg-brand-primary/80 transition-all cursor-pointer`,children:"Dodaj"}),e.jsx("button",{type:"button",onClick:a,className:`bg-brand-neutral-dark px-4 py-2 rounded-xl text-brand-neutral-light \r
                  hover:bg-brand-neutral-dark/80 transition-all cursor-pointer`,children:"Anuluj"})]})}function L({isOpen:r,onClose:a,categories:l,onToggleCategory:n,onAddCategory:d,onDeleteCategory:u}){const[h,c]=o.useState(!1),[s,b]=o.useState(!1);return e.jsx(C,{children:r&&e.jsxs(e.Fragment,{children:[e.jsx(m.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},onClick:a,className:"fixed inset-0 bg-brand-neutral-darker/70 backdrop-blur-xs z-55"}),e.jsx(m.div,{initial:{opacity:0,scale:.95,y:20},animate:{opacity:1,scale:1,y:0},exit:{opacity:0,scale:.95,y:20},className:"fixed inset-0 flex items-center justify-center z-55 pointer-events-none",children:e.jsxs("div",{className:`overflow-hidden flex flex-col w-full max-w-lg max-h-[85vh] bg-brand-neutral-darker border border-brand-depth \r
                          rounded-2xl shadow-2xl pointer-events-auto mx-4`,children:[e.jsxs("div",{className:"p-6 border-b border-brand-depth flex justify-between items-center bg-brand-neutral-dark/50",children:[e.jsx("h2",{className:"text-xl font-bold text-brand-neutral-light",children:"Aktywne kategorie"}),e.jsx("button",{onClick:a,className:`text-brand-secondary hover:text-brand-neutral-dark hover:bg-brand-neutral-light/70 rounded-full \r
                  p-1 flex items-center justify-center cursor-pointer transition-all`,children:e.jsx(S,{})})]}),e.jsxs("div",{className:"flex-1 overflow-y-auto p-6 space-y-4",children:[e.jsx("div",{className:"space-y-2",children:l.map(x=>e.jsx(H,{name:x.name,isActive:x.is_active,isDeleteMode:s,onToggle:()=>n(x.id),onDelete:()=>u(x.id)},x.id))}),h?e.jsx(B,{onAdd:x=>{d(x),c(!1)},onCancel:()=>c(!1)}):e.jsx("button",{onClick:()=>c(!0),className:`w-full mt-2  py-2 border border-dashed border-brand-neutral-light/30 rounded-xl\r
                                 text-brand-neutral-light/60 hover:text-brand-neutral-light hover:border-brand-neutral-light/60\r
                                 transition-all cursor-pointer`,children:"+ Dodaj nową kategorię"}),e.jsx("button",{onClick:()=>b(!s),className:"w-full px-4 rounded-lg transition-all duration-200 cursor-pointer text-brand-accent-1 hover:text-brand-accent-1/80 hover:underline",title:s?"Zarządzaj kategoriami":"Usuń kategorie",children:e.jsx("span",{children:s?"Tryb zarządzania":"Tryb usuwania"})})]})]})})]})})}function P({task:r,category:a,onClick:l,onRestore:n,onDelete:d,isExpanded:u}){return e.jsxs(m.div,{layout:!0,onClick:l,className:`relative overflow-hidden p-3 bg-brand-neutral-dark/30 rounded-xl border border-brand-depth/50 cursor-pointer 
              hover:bg-brand-neutral-dark/50 transition-colors
                  ${u?"border-brand-primary/30 bg-brand-neutral-dark/50":""}`,children:[e.jsxs(m.div,{layout:"position",className:"flex items-center justify-between gap-3",children:[e.jsx("div",{className:"flex items-center gap-3 min-w-0 flex-1",children:e.jsxs("div",{className:"flex flex-col min-w-0 flex-1",children:[e.jsx("span",{className:"font-medium text-brand-neutral-light truncate",children:r.description}),e.jsxs("div",{className:"flex items-center gap-2 text-xs text-brand-neutral-light/50",children:[e.jsx("span",{children:a?.name||"Brak kategorii"}),e.jsx("span",{children:"•"}),e.jsx("span",{children:r.completed_at?new Date(r.completed_at).toLocaleDateString():"---"})]})]})}),e.jsxs("div",{className:"text-right flex-shrink-0 flex items-center gap-2",children:[e.jsxs("div",{className:"hidden sm:flex text-xs text-brand-neutral-light/40 flex-col items-end",children:[e.jsx("span",{children:"Termin:"}),e.jsx("span",{children:r.deadline?new Date(r.deadline).toLocaleDateString():"Brak"})]}),e.jsx("button",{onClick:h=>{h.stopPropagation(),n(r.id)},className:`flex items-center justify-center p-1 rounded-full hover:bg-brand-accent-1/20 \r
                    text-brand-neutral-light/60 hover:text-brand-accent-1 \r
                      transition-colors cursor-pointer`,title:"Przywróć zadanie",children:e.jsx(z,{className:"scale-90"})}),e.jsx("button",{onClick:h=>{h.stopPropagation(),d(r.id)},className:`flex items-center justify-center p-1 rounded-full hover:bg-brand-negative/20 \r
                    text-brand-neutral-light/60 hover:text-brand-negative \r
                      transition-colors cursor-pointer`,title:"Usuń zadanie",children:e.jsx(M,{className:"scale-90"})})]})]}),u&&e.jsx(m.div,{layout:"position",initial:{opacity:0,height:0},animate:{opacity:1,height:"auto"},transition:{duration:.3,opacity:{delay:.2}},className:"mt-3 pt-3 border-t border-brand-neutral-light/10",children:e.jsx("p",{className:"text-sm text-brand-neutral-light/80 ",children:r.description})})]})}function U({isOpen:r,onClose:a,tasks:l,categories:n,onRestore:d,onDelete:u}){const[h,c]=o.useState(null),[s,b]=o.useState(""),[x,v]=o.useState("all"),[p,N]=o.useState(new Date),[g,y]=o.useState(!1),j=o.useRef(null);o.useEffect(()=>{const t=i=>{j.current&&!j.current.contains(i.target)&&y(!1)};return document.addEventListener("mousedown",t),()=>{document.removeEventListener("mousedown",t)}},[]);const f=o.useMemo(()=>l.filter(t=>{if(!t.is_completed&&!t.is_dismissed||!t.is_dismissed)return!1;const i=t.completed_at?new Date(t.completed_at):null;return!(!i||!(i.getMonth()===p.getMonth()&&i.getFullYear()===p.getFullYear())||x!=="all"&&t.category_id!==x||s&&!t.description.toLowerCase().includes(s.toLowerCase()))}).sort((t,i)=>{const T=t.completed_at?new Date(t.completed_at).getTime():0;return(i.completed_at?new Date(i.completed_at).getTime():0)-T}),[l,p,x,s]),w=t=>{c(i=>i===t?null:t)},k=[{label:"Wszystkie kategorie",value:"all"},...n.map(t=>({label:t.name,value:t.id}))];return e.jsx(C,{children:r&&e.jsxs(e.Fragment,{children:[e.jsx(m.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},onClick:a,className:"fixed inset-0 bg-brand-neutral-darker/70 h-full backdrop-blur-xs z-55"}),e.jsx(m.div,{initial:{opacity:0,scale:.95,y:20},animate:{opacity:1,scale:1,y:0},exit:{opacity:0,scale:.95,y:20},className:"fixed inset-0 flex items-center justify-center z-55 pointer-events-none",children:e.jsxs("div",{className:`overflow-hidden flex flex-col w-full max-w-4xl max-h-[85vh] bg-brand-neutral-darker border border-brand-depth \r
                          rounded-2xl shadow-2xl pointer-events-auto mx-4`,children:[e.jsxs("div",{className:"p-6 border-b border-brand-depth flex justify-between items-center bg-brand-neutral-dark/50",children:[e.jsx("h2",{className:"text-xl font-bold text-brand-neutral-light",children:"Historia zadań"}),e.jsx("button",{onClick:a,className:`text-brand-secondary hover:text-brand-neutral-dark hover:bg-brand-neutral-light/70 rounded-full \r
                  p-1 flex items-center justify-center cursor-pointer transition-all`,children:e.jsx(S,{className:"w-6 h-6"})})]}),e.jsxs("div",{className:"p-4 border-b border-brand-depth/50 bg-brand-neutral-dark/20 flex flex-col md:flex-row gap-4",ref:j,children:[e.jsx("div",{className:"flex-1",children:e.jsxs("div",{className:"relative",children:[e.jsx("div",{className:"absolute inset-y-0 left-0 pl-2 flex items-center pointer-events-none text-brand-neutral-light/50",children:e.jsx(_,{className:"scale-88"})}),e.jsx("input",{type:"text",value:s,onChange:t=>b(t.target.value),placeholder:"Szukaj zadania...",className:`block w-full pl-10 pr-3 py-2.5 border border-brand-depth rounded-lg bg-brand-neutral-dark \r
                                text-brand-neutral-light placeholder-brand-neutral-light/30 focus:outline-none focus:ring-1\r
                                focus:ring-brand-accent-1`})]})}),e.jsx(C,{mode:"wait",children:g?e.jsx(m.div,{initial:{opacity:0,scale:.95},animate:{opacity:1,scale:1},exit:{opacity:0,scale:.95},transition:{duration:.2},children:e.jsx(R,{selectedDate:p,onDateChange:N,format:"month"})},"date-selector"):e.jsxs(m.div,{initial:{opacity:0,scale:.95},animate:{opacity:1,scale:1},exit:{opacity:0,scale:.95},transition:{duration:.2},className:"w-full md:w-77 flex gap-2 items-start relative",children:[e.jsx("div",{className:"flex-1",children:e.jsx(E,{value:x,onChange:v,options:k,placeholder:"Kategoria"})}),e.jsx("button",{onClick:()=>y(!g),className:`p-3 rounded-lg border transition-colors flex items-center justify-center shrink-0
                             ${g?"bg-brand-neutral-dark border-brand-accent-1 text-brand-accent-1":"bg-brand-neutral-dark border-brand-depth text-brand-neutral-light hover:border-brand-neutral-light/30"}`,children:e.jsx(I,{})})]},"category-selector")})]}),e.jsx("div",{className:"flex-1 overflow-y-auto md:p-6 p-4 space-y-4",children:f.length===0?e.jsxs("div",{className:"text-center text-brand-neutral-light/40 py-10 flex flex-col items-center gap-2",children:[e.jsx("span",{className:"material-symbols-sharp text-4xl opacity-50",children:"inbox"}),e.jsx("span",{children:"Brak zadań w historii dla wybranych kryteriów."})]}):f.map(t=>e.jsx(P,{task:t,category:n.find(i=>i.id===t.category_id),isExpanded:h===t.id,onClick:()=>w(t.id),onRestore:d,onDelete:u},t.id))}),e.jsx("div",{className:"p-4 border-t border-brand-depth bg-brand-neutral-dark/30 text-center",children:e.jsx("p",{className:"text-xs text-brand-neutral-light/50",children:"Historyczne zadania można przywrócić do listy aktywnych za pomocą przycisku."})})]})})]})})}function Q({currentMode:r,onModeChange:a}){const l=[{id:"active",label:"Nieukończone"},{id:"all",label:"Wszystkie"},{id:"completed",label:"Ukończone"}];return e.jsx("div",{className:"flex w-full sm:w-auto bg-brand-neutral-dark/50 p-1 rounded-xl border border-brand-depth",children:l.map(n=>{const d=r===n.id;return e.jsxs("button",{onClick:()=>a(n.id),className:`relative flex-1 sm:flex-none px-2 sm:px-4 py-1.5 rounded-lg text-sm font-medium transition-colors ${d?"text-brand-neutral-light":"text-brand-neutral-light/60 hover:text-brand-neutral-light cursor-pointer"}`,children:[d&&e.jsx(m.div,{layoutId:"viewModeIndicator",className:"absolute inset-0 bg-brand-secondary/80 rounded-lg shadow-sm z-10",transition:{type:"spring",stiffness:300,damping:30}}),e.jsx("span",{className:"relative z-20",children:n.label})]},n.id)})})}function J(){const{tasks:r,categories:a,addTask:l,toggleTaskCompletion:n,deleteTask:d,toggleCategory:u,addCategory:h,dismissTask:c,deleteCategory:s,restoreTask:b,editTask:x}=A(),[v,p]=o.useState(!1),[N,g]=o.useState(!1),[y,j]=o.useState(!1),[f,w]=o.useState("all"),k=o.useMemo(()=>r.filter(i=>i.is_dismissed?!1:f==="active"?!i.is_completed:f==="completed"?i.is_completed:!0),[r,f]),t=o.useMemo(()=>a.filter(i=>i.is_active),[a]);return e.jsxs(m.div,{initial:{opacity:0},animate:{opacity:1},transition:{duration:.42},className:"py-6 lg:p-8 mx-auto space-y-3 xl:h-[calc(100vh)] flex flex-col",children:[e.jsxs("div",{className:"flex flex-col xl:flex-row items-center justify-between gap-3",children:[e.jsx("div",{className:"flex-1 flex flex-col sm:flex-row items-center gap-4 w-auto xl:w-full",children:e.jsx(Q,{currentMode:f,onModeChange:w})}),e.jsx("div",{className:"flex flex-col md:flex-row w-full xl:w-auto items-center gap-3",children:e.jsxs("div",{className:"flex gap-2 w-full xl:w-auto justify-center overflow-x-auto text-sm",children:[e.jsxs("button",{onClick:()=>p(!0),className:`flex items-center bg-brand-accent-1/80 text-brand-neutral-light/70 px-2 sm:px-3 py-2 rounded-xl\r
                      hover:bg-brand-accent-1 hover:text-brand-neutral-light transition-colors cursor-pointer`,children:[e.jsx("span",{className:"material-symbols-sharp",children:"add"}),e.jsx("span",{className:"font-semibold text-center ml-2",children:"Dodaj"})]}),e.jsxs("button",{onClick:()=>g(!0),className:`flex items-center bg-brand-accent-2/80 text-brand-neutral-light/70 px-2 sm:px-3 py-2 rounded-xl\r
                      hover:bg-brand-accent-2 hover:text-brand-neutral-light transition-colors  cursor-pointer`,children:[e.jsx("span",{className:"material-symbols-sharp",children:"filter_list"}),e.jsx("span",{className:"font-semibold text-center ml-2",children:"Filtruj"})]}),e.jsxs("button",{onClick:()=>j(!0),className:`flex items-center bg-brand-accent-3/80 text-brand-neutral-light/70 px-2 sm:px-3 py-2 rounded-xl\r
                      hover:bg-brand-accent-3 hover:text-brand-neutral-light transition-colors cursor-pointer`,children:[e.jsx("span",{className:"material-symbols-sharp",children:"history"}),e.jsx("span",{className:"font-semibold text-center ml-2",children:"Historia"})]})]})})]}),e.jsx("div",{className:"flex-grow overflow-hidden",children:e.jsx(F,{tasks:k,categories:t,onComplete:n,currentDate:new Date,onDismiss:c,onEdit:x})}),e.jsx($,{isOpen:v,onClose:()=>p(!1),onSubmit:l,categories:t}),e.jsx(L,{isOpen:N,onClose:()=>g(!1),categories:a,onToggleCategory:u,onAddCategory:h,onDeleteCategory:s}),e.jsx(U,{isOpen:y,onClose:()=>j(!1),categories:a,tasks:r,onRestore:b,onDelete:d})]})}export{J as default};
