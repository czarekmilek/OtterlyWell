import{v as L,w as k,x as V,r as c,M as $,y as F,B as H,G as B,H as D,J as U,N as P,m as b,j as e,P as G,T as W,R as Q,o as Y,k as _,U as Z,q,S as J,V as K}from"./index-CbrNP7Z6.js";import{T as X,u as ee,A as te}from"./TaskColumn-DCSfuebF.js";import{A as S,C as ne}from"./ConfirmDeleteDialog-QRNexnPa.js";import{C as re}from"./CustomSelect-BaiIlwLE.js";import{D as ae}from"./DateSelector-DDtFM2BJ.js";function se(...t){const n=!Array.isArray(t[0]),r=n?0:-1,a=t[0+r],s=t[1+r],o=t[2+r],d=t[3+r],u=L(s,o,d);return n?u(a):u}function O(t){const n=k(()=>V(t)),{isStatic:r}=c.useContext($);if(r){const[,a]=c.useState(t);c.useEffect(()=>n.on("change",a),[])}return n}function A(t,n){const r=O(n()),a=()=>r.set(n());return a(),F(()=>{const s=()=>H.preRender(a,!1,!0),o=t.map(d=>d.on("change",s));return()=>{o.forEach(d=>d()),B(a)}}),r}function le(t){D.current=[],t();const n=A(D.current,t);return D.current=void 0,n}function oe(t,n,r,a){if(typeof t=="function")return le(t);const s=typeof n=="function"?n:se(n,r,a);return Array.isArray(t)?I(t,s):I([t],([o])=>s(o))}function I(t,n){const r=k(()=>[]);return A(t,()=>{r.length=0;const a=t.length;for(let s=0;s<a;s++)r[s]=t[s].get();return n(r)})}class ie{constructor(){this.componentControls=new Set}subscribe(n){return this.componentControls.add(n),()=>this.componentControls.delete(n)}start(n,r){this.componentControls.forEach(a=>{a.start(n.nativeEvent||n,r)})}cancel(){this.componentControls.forEach(n=>{n.cancel()})}stop(){this.componentControls.forEach(n=>{n.stop()})}}const ce=()=>new ie;function de(){return k(ce)}const E=c.createContext(null);function ue(t,n,r,a){if(!a)return t;const s=t.findIndex(m=>m.value===n);if(s===-1)return t;const o=a>0?1:-1,d=t[s+o];if(!d)return t;const u=t[s],i=d.layout,x=U(i.min,i.max,.5);return o===1&&u.layout.max+r>x||o===-1&&u.layout.min+r<x?P(t,s,s+o):t}function xe({children:t,as:n="ul",axis:r="y",onReorder:a,values:s,...o},d){const u=k(()=>b[n]),i=[],x=c.useRef(!1),m={axis:r,registerItem:(h,f)=>{const y=i.findIndex(j=>h===j.value);y!==-1?i[y].layout=f[r]:i.push({value:h,layout:f[r]}),i.sort(fe)},updateOrder:(h,f,y)=>{if(x.current)return;const j=ue(i,h,f,y);i!==j&&(x.current=!0,a(j.map(he).filter(g=>s.indexOf(g)!==-1)))}};return c.useEffect(()=>{x.current=!1}),e.jsx(u,{...o,ref:d,ignoreStrict:!0,children:e.jsx(E.Provider,{value:m,children:t})})}const me=c.forwardRef(xe);function he(t){return t.value}function fe(t,n){return t.layout.min-n.layout.min}function R(t,n=0){return G(t)?t:O(n)}function pe({children:t,style:n={},value:r,as:a="li",onDrag:s,layout:o=!0,...d},u){const i=k(()=>b[a]),x=c.useContext(E),m={x:R(n.x),y:R(n.y)},h=oe([m.x,m.y],([g,v])=>g||v?1:"unset"),{axis:f,registerItem:y,updateOrder:j}=x;return e.jsx(i,{drag:f,...d,dragSnapToOrigin:!0,style:{...n,x:m.x,y:m.y,zIndex:h},layout:o,onDrag:(g,v)=>{const{velocity:w}=v;w[f]&&j(r,m[f].get(),w[f]),s&&s(g,v)},onLayoutMeasure:g=>y(r,g),ref:u,ignoreStrict:!0,children:t})}const be=c.forwardRef(pe);function ge({tasks:t,categories:n,onComplete:r,currentDate:a,onDismiss:s,onEdit:o}){const d=()=>{const u=n.length,i="grid gap-4 auto-rows-fr grid-cols-1 sm:grid-cols-2";return u===1?`${i} xl:grid-cols-3 xl:h-full`:u===2?`${i} xl:grid-cols-2 xl:h-full`:u===3?`${i} xl:grid-cols-3 xl:h-full`:u>=7?`${i} xl:grid-cols-3 2xl:grid-cols-4`:`${i} xl:grid-cols-3 2xl:grid-cols-4 xl:h-full`};return n.length===0?e.jsxs("div",{className:"flex flex-col items-center justify-center h-full text-brand-neutral-light/70 p-8 text-center bg-brand-neutral-dark/20 rounded-2xl border border-brand-depth border-dashed",children:[e.jsx(W,{className:"opacity-50 mb-2"}),e.jsx("h3",{className:"text-xl font-bold mb-2 text-brand-neutral-light",children:"Witaj w Zadaniach!"}),e.jsxs("p",{className:"max-w-md",children:["Twoja tablica jest pusta. Rozpocznij od stworzenia nowej kategorii klikając przycisk ",e.jsx("strong",{children:'"Filtruj"'}),", a następnie dodaj nowe zadania do tej kategorii przyciskiem ",e.jsx("strong",{children:'"Dodaj"'}),"."]})]}):e.jsx("div",{className:"h-full overflow-y-auto",children:e.jsx("div",{className:d(),children:n.map(u=>{const i=t.filter(m=>m.category_id===u.id),x=n.length===1?"h-full xl:col-span-2":"h-full";return e.jsx("div",{className:x,children:e.jsx(X,{category:u,tasks:i,allCategories:n,onComplete:r,onDismiss:s,onEdit:o,currentDate:a})},u.id)})})})}function je({category:t,isActive:n,isDeleteMode:r,onToggle:a,onDelete:s}){const o=de();return e.jsx(be,{value:t,dragListener:!1,dragControls:o,children:e.jsxs("div",{className:"flex items-center justify-between p-3 bg-brand-neutral-dark/30 rounded-xl border border-brand-depth/50",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"cursor-grab active:cursor-grabbing text-brand-neutral-light/50 hover:text-brand-neutral-light transition-colors",onPointerDown:d=>o.start(d),children:e.jsx(Q,{})}),e.jsx("span",{className:"font-medium text-sm md:text-base text-brand-neutral-light",children:t.name})]}),e.jsx("div",{className:"flex items-center gap-3",children:r?e.jsx("button",{onClick:s,className:`p-3 h-4 text-brand-negative hover:text-brand-negative/80 transition-colors flex items-center justify-center \r
                      rounded-md hover:bg-brand-negative/10 cursor-pointer`,title:"Delete Category",children:e.jsx(Y,{className:"!text-[20px]"})}):e.jsx("button",{onClick:()=>a(!n),className:`relative w-12 h-6 rounded-full transition-colors duration-200 ease-in-out cursor-pointer ${n?"bg-brand-accent-1":"bg-brand-neutral-dark"}`,children:e.jsx(b.div,{initial:!1,animate:{x:n?26:7},className:"absolute top-1 w-4 h-4 rounded-full bg-white shadow-sm"})})})]})})}function ye({onAdd:t,onCancel:n}){const[r,a]=c.useState(""),s=o=>{o.preventDefault(),r.trim()&&(t(r),a(""))};return e.jsxs("form",{onSubmit:s,className:"mt-2 flex flex-col sm:flex-row gap-2",children:[e.jsx("input",{value:r,onChange:o=>a(o.target.value),placeholder:"Nazwa kategorii...",className:`flex-1 px-4 py-2 bg-brand-neutral-dark/40 border border-brand-depth rounded-xl \r
                       text-brand-neutral-light focus:outline-none focus:border-brand-primary`,autoFocus:!0}),e.jsx("button",{type:"submit",className:`bg-brand-primary px-4 py-2 rounded-xl text-brand-neutral-light font-bold\r
                  hover:bg-brand-primary/80 transition-all cursor-pointer`,children:"Dodaj"}),e.jsx("button",{type:"button",onClick:n,className:`bg-brand-neutral-dark px-4 py-2 rounded-xl text-brand-neutral-light \r
                  hover:bg-brand-neutral-dark/80 transition-all cursor-pointer`,children:"Anuluj"})]})}function ve({isOpen:t,onClose:n,categories:r,onToggleCategory:a,onAddCategory:s,onDeleteCategory:o,onReorder:d}){const[u,i]=c.useState(!1),[x,m]=c.useState(!1);return e.jsx(S,{children:t&&e.jsxs(e.Fragment,{children:[e.jsx(b.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},onClick:n,className:"fixed inset-0 bg-brand-neutral-darker/70 backdrop-blur-xs z-55"}),e.jsx(b.div,{initial:{opacity:0,scale:.95,y:20},animate:{opacity:1,scale:1,y:0},exit:{opacity:0,scale:.95,y:20},className:"fixed inset-0 flex items-center justify-center z-55 pointer-events-none",children:e.jsxs("div",{className:`overflow-hidden flex flex-col w-full max-w-lg max-h-[85vh] bg-brand-neutral-darker border border-brand-depth \r
                          rounded-2xl shadow-2xl pointer-events-auto mx-4`,children:[e.jsxs("div",{className:"p-6 border-b border-brand-depth flex justify-between items-center bg-brand-neutral-dark/50",children:[e.jsx("h2",{className:"text-xl font-bold text-brand-neutral-light",children:"Aktywne kategorie"}),e.jsx("button",{onClick:n,className:`text-brand-secondary hover:text-brand-neutral-dark hover:bg-brand-neutral-light/70 rounded-full \r
                  p-1 flex items-center justify-center cursor-pointer transition-all`,children:e.jsx(_,{})})]}),e.jsxs("div",{className:"flex-1 overflow-y-auto p-6 space-y-4",children:[e.jsx("div",{className:"space-y-2",children:e.jsx(me,{axis:"y",values:r,onReorder:d,className:"space-y-2",children:r.map(h=>e.jsx(je,{category:h,isActive:h.is_active,isDeleteMode:x,onToggle:()=>a(h.id),onDelete:()=>o(h.id)},h.id))})}),u?e.jsx(ye,{onAdd:h=>{s(h),i(!1)},onCancel:()=>i(!1)}):e.jsx("button",{onClick:()=>i(!0),className:`w-full mt-2  py-2 border border-dashed border-brand-neutral-light/30 rounded-xl\r
                                 text-brand-neutral-light/60 hover:text-brand-neutral-light hover:border-brand-neutral-light/60\r
                                 transition-all cursor-pointer`,children:"+ Dodaj nową kategorię"}),e.jsx("button",{onClick:()=>m(!x),className:"w-full px-4 rounded-lg transition-all duration-200 cursor-pointer text-brand-accent-1 hover:text-brand-accent-1/80 hover:underline",title:x?"Zarządzaj kategoriami":"Usuń kategorie",children:e.jsx("span",{children:x?"Tryb zarządzania":"Tryb usuwania"})})]})]})})]})})}function we({task:t,category:n,onClick:r,onRestore:a,onDelete:s,isExpanded:o}){return e.jsxs(b.div,{layout:!0,onClick:r,className:`relative overflow-hidden p-3 bg-brand-neutral-dark/30 rounded-xl border border-brand-depth/50 cursor-pointer 
              hover:bg-brand-neutral-dark/50 transition-colors
                  ${o?"border-brand-primary/30 bg-brand-neutral-dark/50":""}`,children:[e.jsxs(b.div,{layout:"position",className:"flex items-center justify-between gap-3",children:[e.jsx("div",{className:"flex items-center gap-3 min-w-0 flex-1",children:e.jsxs("div",{className:"flex flex-col min-w-0 flex-1",children:[e.jsx("span",{className:"font-medium text-brand-neutral-light truncate",children:t.description}),e.jsxs("div",{className:"flex items-center gap-2 text-xs text-brand-neutral-light/50",children:[e.jsx("span",{children:n?.name||"Brak kategorii"}),e.jsx("span",{children:"•"}),e.jsx("span",{children:t.completed_at?new Date(t.completed_at).toLocaleDateString():"---"})]})]})}),e.jsxs("div",{className:"text-right flex-shrink-0 flex items-center gap-2",children:[e.jsxs("div",{className:"hidden sm:flex text-xs text-brand-neutral-light/40 flex-col items-end",children:[e.jsx("span",{children:"Termin:"}),e.jsx("span",{children:t.deadline?new Date(t.deadline).toLocaleDateString():"Brak"})]}),e.jsx("button",{onClick:d=>{d.stopPropagation(),a(t.id)},className:`flex items-center justify-center p-1 rounded-full hover:bg-brand-accent-1/20 \r
                    text-brand-neutral-light/60 hover:text-brand-accent-1 \r
                      transition-colors cursor-pointer`,title:"Przywróć zadanie",children:e.jsx(Z,{className:"scale-90"})}),e.jsx("button",{onClick:d=>{d.stopPropagation(),s(t.id)},className:`flex items-center justify-center p-1 rounded-full hover:bg-brand-negative/20 \r
                    text-brand-neutral-light/60 hover:text-brand-negative \r
                      transition-colors cursor-pointer`,title:"Usuń zadanie",children:e.jsx(q,{className:"scale-90"})})]})]}),o&&e.jsx(b.div,{layout:"position",initial:{opacity:0,height:0},animate:{opacity:1,height:"auto"},transition:{duration:.3,opacity:{delay:.2}},className:"mt-3 pt-3 border-t border-brand-neutral-light/10",children:e.jsx("p",{className:"text-sm text-brand-neutral-light/80 ",children:t.description})})]})}function Ne({isOpen:t,onClose:n,tasks:r,categories:a,onRestore:s,onDelete:o}){const[d,u]=c.useState(null),[i,x]=c.useState(""),[m,h]=c.useState("all"),[f,y]=c.useState(new Date),[j,g]=c.useState(!1),v=c.useRef(null),[w,N]=c.useState(null);c.useEffect(()=>{const l=p=>{v.current&&!v.current.contains(p.target)&&g(!1)};return document.addEventListener("mousedown",l),()=>{document.removeEventListener("mousedown",l)}},[]);const C=c.useMemo(()=>r.filter(l=>{if(!l.is_completed&&!l.is_dismissed||!l.is_dismissed)return!1;const p=l.completed_at?new Date(l.completed_at):null;return!(!p||!(p.getMonth()===f.getMonth()&&p.getFullYear()===f.getFullYear())||m!=="all"&&l.category_id!==m||i&&!l.description.toLowerCase().includes(i.toLowerCase()))}).sort((l,p)=>{const M=l.completed_at?new Date(l.completed_at).getTime():0;return(p.completed_at?new Date(p.completed_at).getTime():0)-M}),[r,f,m,i]),z=l=>{u(p=>p===l?null:l)},T=[{label:"Wszystkie kategorie",value:"all"},...a.map(l=>({label:l.name,value:l.id}))];return e.jsx(S,{children:t&&e.jsxs(e.Fragment,{children:[e.jsx(b.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},onClick:n,className:"fixed inset-0 bg-brand-neutral-darker/70 h-full backdrop-blur-xs z-55"}),e.jsx(b.div,{initial:{opacity:0,scale:.95,y:20},animate:{opacity:1,scale:1,y:0},exit:{opacity:0,scale:.95,y:20},className:"fixed inset-0 flex items-center justify-center z-55 pointer-events-none",children:e.jsxs("div",{className:`overflow-hidden flex flex-col w-full max-w-4xl max-h-[85vh] bg-brand-neutral-darker border border-brand-depth \r
                          rounded-2xl shadow-2xl pointer-events-auto mx-4`,children:[e.jsxs("div",{className:"p-6 border-b border-brand-depth flex justify-between items-center bg-brand-neutral-dark/50",children:[e.jsx("h2",{className:"text-xl font-bold text-brand-neutral-light",children:"Historia zadań"}),e.jsx("button",{onClick:n,className:`text-brand-secondary hover:text-brand-neutral-dark hover:bg-brand-neutral-light/70 rounded-full \r
                  p-1 flex items-center justify-center cursor-pointer transition-all`,children:e.jsx(_,{className:"w-6 h-6"})})]}),e.jsxs("div",{className:"p-4 border-b border-brand-depth/50 bg-brand-neutral-dark/20 flex flex-col md:flex-row gap-4",ref:v,children:[e.jsx("div",{className:"flex-1",children:e.jsxs("div",{className:"relative",children:[e.jsx("div",{className:"absolute inset-y-0 left-0 pl-2 flex items-center pointer-events-none text-brand-neutral-light/50",children:e.jsx(J,{className:"scale-88"})}),e.jsx("input",{type:"text",value:i,onChange:l=>x(l.target.value),placeholder:"Szukaj zadania...",className:`block w-full pl-10 pr-3 py-2.5 border border-brand-depth rounded-lg bg-brand-neutral-dark \r
                                text-brand-neutral-light placeholder-brand-neutral-light/30 focus:outline-none focus:ring-1\r
                                focus:ring-brand-accent-1`})]})}),e.jsx(S,{mode:"wait",children:j?e.jsx(b.div,{initial:{opacity:0,scale:.95},animate:{opacity:1,scale:1},exit:{opacity:0,scale:.95},transition:{duration:.2},children:e.jsx(ae,{selectedDate:f,onDateChange:y,format:"month"})},"date-selector"):e.jsxs(b.div,{initial:{opacity:0,scale:.95},animate:{opacity:1,scale:1},exit:{opacity:0,scale:.95},transition:{duration:.2},className:"w-full md:w-77 flex gap-2 items-start relative",children:[e.jsx("div",{className:"flex-1",children:e.jsx(re,{value:m,onChange:h,options:T,placeholder:"Kategoria"})}),e.jsx("button",{onClick:()=>g(!j),className:`p-3 rounded-lg border transition-colors flex items-center justify-center shrink-0
                             ${j?"bg-brand-neutral-dark border-brand-accent-1 text-brand-accent-1":"bg-brand-neutral-dark border-brand-depth text-brand-neutral-light hover:border-brand-neutral-light/30"}`,children:e.jsx(K,{})})]},"category-selector")})]}),e.jsx("div",{className:"flex-1 overflow-y-auto md:p-6 p-4 space-y-4",children:C.length===0?e.jsxs("div",{className:"text-center text-brand-neutral-light/40 py-10 flex flex-col items-center gap-2",children:[e.jsx("span",{className:"material-symbols-sharp text-4xl opacity-50",children:"inbox"}),e.jsx("span",{children:"Brak zadań w historii dla wybranych kryteriów."})]}):C.map(l=>e.jsx(we,{task:l,category:a.find(p=>p.id===l.category_id),isExpanded:d===l.id,onClick:()=>z(l.id),onRestore:s,onDelete:p=>N(p)},l.id))}),e.jsx("div",{className:"p-4 border-t border-brand-depth bg-brand-neutral-dark/30 text-center",children:e.jsx("p",{className:"text-xs text-brand-neutral-light/50",children:"Historyczne zadania można przywrócić do listy aktywnych za pomocą przycisku."})})]})}),e.jsx(ne,{isOpen:!!w,onClose:()=>N(null),onConfirm:()=>{w&&(o(w),N(null))},title:"Usuń zadanie",description:"Czy na pewno chcesz trwale usunąć to zadanie? Tej operacji nie można cofnąć.",confirmLabel:"Usuń zadanie"})]})})}function ke({currentMode:t,onModeChange:n}){const r=[{id:"active",label:"Nieukończone"},{id:"all",label:"Wszystkie"},{id:"completed",label:"Ukończone"}];return e.jsx("div",{className:"flex w-full sm:w-auto bg-brand-neutral-dark/50 p-1 rounded-xl border border-brand-depth",children:r.map(a=>{const s=t===a.id;return e.jsxs("button",{onClick:()=>n(a.id),className:`relative flex-1 sm:flex-none px-2 sm:px-4 py-1.5 rounded-lg text-sm font-medium transition-colors ${s?"text-brand-neutral-light":"text-brand-neutral-light/60 hover:text-brand-neutral-light cursor-pointer"}`,children:[s&&e.jsx(b.div,{layoutId:"viewModeIndicator",className:"absolute inset-0 bg-brand-secondary/80 rounded-lg shadow-sm z-10",transition:{type:"spring",stiffness:300,damping:30}}),e.jsx("span",{className:"relative z-20",children:a.label})]},a.id)})})}function Ie(){const{tasks:t,categories:n,addTask:r,toggleTaskCompletion:a,deleteTask:s,toggleCategory:o,addCategory:d,dismissTask:u,deleteCategory:i,restoreTask:x,editTask:m,reorderCategories:h}=ee(),[f,y]=c.useState(!1),[j,g]=c.useState(!1),[v,w]=c.useState(!1),[N,C]=c.useState("all"),z=c.useMemo(()=>t.filter(l=>l.is_dismissed?!1:N==="active"?!l.is_completed:N==="completed"?l.is_completed:!0),[t,N]),T=c.useMemo(()=>n.filter(l=>l.is_active),[n]);return e.jsxs(b.div,{initial:{opacity:0},animate:{opacity:1},transition:{duration:.42},className:"py-6 lg:p-8 mx-auto space-y-3 xl:h-[calc(100vh)] flex flex-col",children:[e.jsxs("div",{className:"flex flex-col xl:flex-row items-center justify-between gap-3",children:[e.jsx("div",{className:"flex-1 flex flex-col sm:flex-row items-center gap-4 w-auto xl:w-full",children:e.jsx(ke,{currentMode:N,onModeChange:C})}),e.jsx("div",{className:"flex flex-col md:flex-row w-full xl:w-auto items-center gap-3",children:e.jsxs("div",{className:"flex gap-2 w-full xl:w-auto justify-center overflow-x-auto text-sm",children:[e.jsxs("button",{onClick:()=>y(!0),className:`flex items-center bg-brand-accent-1/80 text-brand-neutral-light/70 px-2 sm:px-3 py-2 rounded-xl\r
                      hover:bg-brand-accent-1 hover:text-brand-neutral-light transition-colors cursor-pointer`,children:[e.jsx("span",{className:"material-symbols-sharp",children:"add"}),e.jsx("span",{className:"font-semibold text-center ml-2",children:"Dodaj"})]}),e.jsxs("button",{onClick:()=>g(!0),className:`flex items-center bg-brand-accent-2/80 text-brand-neutral-light/70 px-2 sm:px-3 py-2 rounded-xl\r
                      hover:bg-brand-accent-2 hover:text-brand-neutral-light transition-colors  cursor-pointer`,children:[e.jsx("span",{className:"material-symbols-sharp",children:"filter_list"}),e.jsx("span",{className:"font-semibold text-center ml-2",children:"Filtruj"})]}),e.jsxs("button",{onClick:()=>w(!0),className:`flex items-center bg-brand-accent-3/80 text-brand-neutral-light/70 px-2 sm:px-3 py-2 rounded-xl\r
                      hover:bg-brand-accent-3 hover:text-brand-neutral-light transition-colors cursor-pointer`,children:[e.jsx("span",{className:"material-symbols-sharp",children:"history"}),e.jsx("span",{className:"font-semibold text-center ml-2",children:"Historia"})]})]})})]}),e.jsx("div",{className:"flex-grow overflow-hidden",children:e.jsx(ge,{tasks:z,categories:T,onComplete:a,currentDate:new Date,onDismiss:u,onEdit:m})}),e.jsx(te,{isOpen:f,onClose:()=>y(!1),onSubmit:r,categories:T}),e.jsx(ve,{isOpen:j,onClose:()=>g(!1),categories:n,onToggleCategory:o,onAddCategory:d,onDeleteCategory:i,onReorder:h}),e.jsx(Ne,{isOpen:v,onClose:()=>w(!1),categories:n,tasks:t,onRestore:x,onDelete:s})]})}export{Ie as default};
